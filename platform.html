<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì°½ì—…ì§€ë„ í”Œë«í¼ â€” AI ê¸°ë°˜ ì°½ì—… ì‹¤í–‰ ì§€ì›</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c455de3afef5b566b5fb09a4e2e038cd&libraries=services"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{
  --navy:#1b2a4a;--navy-dark:#111d36;--navy-light:#243656;
  --blue:#2563eb;--blue-light:#dbeafe;--blue-bg:#eff6ff;
  --teal:#0d9488;--teal-light:#ccfbf1;
  --red:#dc2626;--red-light:#fef2f2;
  --orange:#ea580c;--orange-light:#fff7ed;
  --green:#16a34a;--green-light:#f0fdf4;
  --yellow:#ca8a04;--yellow-light:#fefce8;
  --bg:#f1f5f9;--surface:#fff;--surface2:#f8fafc;
  --border:#e2e8f0;--border2:#cbd5e1;
  --text:#1e293b;--text2:#334155;--muted:#64748b;--light:#94a3b8;
  --r:8px;--r-lg:12px;
  --shadow:0 1px 3px rgba(0,0,0,.06);--shadow-md:0 4px 12px rgba(0,0,0,.08);--shadow-lg:0 10px 30px rgba(0,0,0,.1);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{font-family:'Noto Sans KR',-apple-system,sans-serif;font-size:14px;line-height:1.6;color:var(--text);background:var(--navy-dark);-webkit-font-smoothing:antialiased}

/* NAV */
.nav{background:var(--navy);height:52px;display:flex;align-items:center;padding:0 20px;gap:16px;border-bottom:1px solid rgba(255,255,255,.08);position:relative;z-index:200;flex-shrink:0}
.nav-logo{display:flex;align-items:center;gap:8px;text-decoration:none}
.nav-logo-icon{width:28px;height:28px;background:linear-gradient(135deg,var(--teal),var(--blue));border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:14px}
.nav-logo-text{font-size:15px;font-weight:700;color:#fff}
.nav-badge{font-size:10px;background:rgba(255,255,255,.1);color:rgba(255,255,255,.7);padding:2px 8px;border-radius:20px;font-weight:500}
.nav-right{margin-left:auto;display:flex;align-items:center;gap:10px}
.nav-link{color:rgba(255,255,255,.65);font-size:13px;text-decoration:none;padding:4px 10px;border-radius:6px;transition:all .15s}
.nav-link:hover{color:#fff;background:rgba(255,255,255,.08)}
.nav-btn{background:var(--blue);color:#fff;border:none;padding:6px 14px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.nav-btn:hover{background:#1d4ed8}

/* ===== LANDING ===== */
#landing{height:calc(100vh - 52px);overflow-y:auto;background:linear-gradient(160deg,var(--navy-dark) 0%,#0f1f38 40%,#0d1a30 100%)}
.land-hero{text-align:center;padding:48px 20px 32px}
.land-tag{display:inline-flex;align-items:center;gap:6px;background:rgba(45,212,191,.12);border:1px solid rgba(45,212,191,.25);color:#2dd4bf;font-size:11px;font-weight:600;padding:4px 12px;border-radius:20px;margin-bottom:18px;letter-spacing:.04em}
.land-tag::before{content:'';width:6px;height:6px;background:#2dd4bf;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.land-title{font-size:clamp(24px,4vw,38px);font-weight:800;color:#fff;line-height:1.25;margin-bottom:12px}
.land-title span{background:linear-gradient(135deg,#38bdf8,#818cf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.land-sub{font-size:15px;color:rgba(255,255,255,.55);max-width:500px;margin:0 auto 36px}

/* STEP INDICATOR */
.land-steps{display:flex;align-items:center;justify-content:center;gap:0;margin-bottom:32px}
.step-item{display:flex;align-items:center;gap:8px}
.step-num{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}
.step-num.active{background:var(--blue);color:#fff}
.step-num.done{background:var(--teal);color:#fff}
.step-num.inactive{background:rgba(255,255,255,.12);color:rgba(255,255,255,.4)}
.step-label{font-size:12px;font-weight:600}
.step-label.active{color:#fff}
.step-label.done{color:var(--teal)}
.step-label.inactive{color:rgba(255,255,255,.35)}
.step-line{width:40px;height:1px;background:rgba(255,255,255,.12);margin:0 8px}

/* CATEGORY TABS */
.cat-scroll{overflow-x:auto;padding:0 20px 2px;margin-bottom:20px;-webkit-overflow-scrolling:touch}
.cat-scroll::-webkit-scrollbar{height:3px}
.cat-scroll::-webkit-scrollbar-track{background:transparent}
.cat-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:2px}
.cat-tabs{display:flex;gap:8px;min-width:max-content;margin:0 auto;justify-content:center}
.cat-tab{display:flex;align-items:center;gap:6px;padding:8px 16px;border-radius:24px;border:1.5px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);color:rgba(255,255,255,.6);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit}
.cat-tab:hover{border-color:rgba(255,255,255,.25);color:#fff;background:rgba(255,255,255,.08)}
.cat-tab.active{color:#fff;border-color:transparent}

/* BIZ GRID */
.biz-section{max-width:960px;margin:0 auto;padding:0 20px}
.biz-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;max-height:280px;overflow-y:auto;padding:4px 2px;margin-bottom:20px}
.biz-grid::-webkit-scrollbar{width:4px}
.biz-grid::-webkit-scrollbar-track{background:transparent}
.biz-grid::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:2px}
.biz-card{display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;background:rgba(255,255,255,.06);border:1.5px solid rgba(255,255,255,.08);border-radius:var(--r-lg);cursor:pointer;transition:all .2s;text-align:center}
.biz-card:hover{background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2);transform:translateY(-2px)}
.biz-card.selected{border-color:var(--teal);background:rgba(13,148,136,.15);box-shadow:0 0 0 2px rgba(13,148,136,.3)}
.biz-card-icon{font-size:24px;line-height:1}
.biz-card-name{font-size:11px;font-weight:600;color:rgba(255,255,255,.8);line-height:1.3}
.biz-card.selected .biz-card-name{color:#2dd4bf}
.biz-count{font-size:11px;color:rgba(255,255,255,.3);margin-bottom:4px;text-align:center}

/* AREA SEARCH */
.area-box{background:rgba(255,255,255,.06);border:1.5px solid rgba(255,255,255,.1);border-radius:var(--r-lg);padding:20px;max-width:540px;margin:0 auto 20px}
.area-label{font-size:12px;font-weight:700;color:rgba(255,255,255,.5);letter-spacing:.06em;margin-bottom:10px;text-transform:uppercase}
.area-input-row{display:flex;gap:8px}
.area-input{flex:1;background:rgba(255,255,255,.08);border:1.5px solid rgba(255,255,255,.12);border-radius:var(--r);padding:10px 14px;color:#fff;font-size:14px;font-family:inherit;outline:none;transition:all .2s}
.area-input::placeholder{color:rgba(255,255,255,.3)}
.area-input:focus{border-color:var(--teal);background:rgba(255,255,255,.1)}
.area-search-btn{background:var(--teal);color:#fff;border:none;padding:10px 18px;border-radius:var(--r);font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;white-space:nowrap;transition:all .15s}
.area-search-btn:hover{background:#0f766e}

/* START BUTTON */
.start-wrap{text-align:center;padding-bottom:40px}
.start-btn{background:linear-gradient(135deg,var(--blue),#7c3aed);color:#fff;border:none;padding:14px 48px;border-radius:30px;font-size:16px;font-weight:800;cursor:pointer;font-family:inherit;transition:all .2s;box-shadow:0 4px 20px rgba(37,99,235,.4)}
.start-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(37,99,235,.5)}
.start-btn:disabled{opacity:.4;cursor:not-allowed;transform:none}
.sel-status{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:16px;flex-wrap:wrap}
.sel-chip{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:20px;padding:5px 12px;font-size:12px;color:rgba(255,255,255,.7)}
.sel-chip.active{background:rgba(13,148,136,.2);border-color:var(--teal);color:#2dd4bf}
.sel-chip-x{cursor:pointer;opacity:.6;margin-left:2px}
.sel-chip-x:hover{opacity:1}

/* ===== DASHBOARD ===== */
#dashboard{display:none;height:calc(100vh - 52px);flex-direction:column}
.dash-header{background:var(--navy);border-bottom:1px solid rgba(255,255,255,.08);padding:8px 16px;display:flex;align-items:center;gap:12px;flex-shrink:0}
.dash-biz-badge{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:6px;padding:4px 10px;font-size:13px;font-weight:700;color:#fff}
.dash-area-badge{font-size:12px;color:rgba(255,255,255,.55);display:flex;align-items:center;gap:4px}
.dash-back{margin-left:auto;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.7);padding:5px 12px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.dash-back:hover{background:rgba(255,255,255,.14);color:#fff}
.dash-body{display:flex;flex:1;overflow:hidden}

/* MAP PANEL */
#mapPanel{flex:0 0 60%;position:relative;background:#1a2535}
#platformMap{width:100%;height:100%}
.map-overlay{position:absolute;top:12px;left:12px;display:flex;flex-direction:column;gap:8px;z-index:10}
.map-ctrl-group{background:rgba(17,29,54,.88);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1);border-radius:var(--r);padding:6px;display:flex;gap:4px}
.map-ctrl-btn{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.75);padding:5px 10px;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.map-ctrl-btn:hover{background:rgba(255,255,255,.15);color:#fff}
.map-ctrl-btn.active{background:var(--teal);border-color:var(--teal);color:#fff}
.map-nearby-badge{position:absolute;bottom:16px;left:12px;background:rgba(17,29,54,.92);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.1);border-radius:var(--r);padding:8px 14px;font-size:12px;color:rgba(255,255,255,.8);max-width:280px}

/* ANALYSIS PANEL */
#analysisPanel{flex:1;display:flex;flex-direction:column;background:var(--surface2);overflow:hidden}
.tab-nav{display:flex;background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;overflow-x:auto}
.tab-nav::-webkit-scrollbar{display:none}
.tab-btn{flex:1;min-width:72px;padding:10px 4px;border:none;background:transparent;font-size:11px;font-weight:700;color:var(--muted);cursor:pointer;font-family:inherit;border-bottom:2px solid transparent;transition:all .15s;white-space:nowrap}
.tab-btn:hover{color:var(--text);background:var(--surface2)}
.tab-btn.active{color:var(--blue);border-bottom-color:var(--blue);background:var(--surface)}
.tab-content{display:none;flex:1;overflow-y:auto;padding:16px}
.tab-content.active{display:block}
.tab-content::-webkit-scrollbar{width:4px}
.tab-content::-webkit-scrollbar-track{background:transparent}
.tab-content::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}

/* SECTION CARDS */
.sec-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;margin-bottom:12px}
.sec-title{font-size:12px;font-weight:700;color:var(--muted);letter-spacing:.05em;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.score-ring{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.score-circle{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:20px;font-weight:800;flex-shrink:0}
.score-circle.green{background:var(--green-light);color:var(--green)}
.score-circle.yellow{background:var(--yellow-light);color:var(--yellow)}
.score-circle.red{background:var(--red-light);color:var(--red)}
.score-meta{flex:1}
.score-grade{font-size:16px;font-weight:800;color:var(--text)}
.score-desc{font-size:11px;color:var(--muted);margin-top:2px}
.stat-row{display:flex;gap:8px;margin-bottom:8px}
.stat-box{flex:1;background:var(--surface2);border-radius:var(--r);padding:10px;text-align:center}
.stat-val{font-size:16px;font-weight:800;color:var(--text)}
.stat-label{font-size:10px;color:var(--muted);margin-top:2px}
.chart-wrap{position:relative;height:140px;margin-bottom:4px}
.risk-item{display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-top:1px solid var(--border)}
.risk-item:first-child{border-top:none;padding-top:0}
.risk-icon{font-size:16px;flex-shrink:0;margin-top:1px}
.risk-body{flex:1}
.risk-title{font-size:12px;font-weight:700;color:var(--text);margin-bottom:2px}
.risk-desc{font-size:11px;color:var(--muted);line-height:1.5}

/* PROFIT TAB */
.profit-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.input-group{display:flex;flex-direction:column;gap:4px}
.input-label{font-size:11px;font-weight:600;color:var(--muted)}
.input-field{border:1.5px solid var(--border);border-radius:var(--r);padding:8px 10px;font-size:13px;font-weight:600;color:var(--text);font-family:inherit;outline:none;transition:all .15s;background:var(--surface)}
.input-field:focus{border-color:var(--blue)}
.input-unit{font-size:11px;color:var(--muted);margin-top:2px}
.autofill-btn{background:var(--blue-bg);color:var(--blue);border:1px solid var(--blue-light);border-radius:var(--r);padding:7px 14px;font-size:12px;font-weight:700;cursor:pointer;font-family:inherit;width:100%;margin-bottom:10px;transition:all .15s}
.autofill-btn:hover{background:var(--blue-light)}
.result-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.result-box{background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-lg);padding:12px;text-align:center}
.result-val{font-size:18px;font-weight:800;color:var(--text)}
.result-label{font-size:10px;color:var(--muted);margin-top:3px}
.result-box.highlight{background:linear-gradient(135deg,var(--blue-bg),#f0fdf4);border-color:var(--blue-light)}
.result-box.highlight .result-val{color:var(--blue)}
.risk-bar-wrap{margin-bottom:12px}
.risk-bar-label{display:flex;justify-content:space-between;font-size:11px;font-weight:600;margin-bottom:4px}
.risk-bar-track{height:8px;background:var(--border);border-radius:4px;overflow:hidden}
.risk-bar-fill{height:100%;border-radius:4px;transition:width .6s ease}
.risk-score-total{text-align:center;padding:12px;background:var(--surface2);border-radius:var(--r-lg);margin-top:8px}
.risk-score-val{font-size:28px;font-weight:800}
.risk-score-val.green{color:var(--green)}
.risk-score-val.yellow{color:var(--yellow)}
.risk-score-val.red{color:var(--red)}
.risk-score-label{font-size:12px;color:var(--muted)}

/* AI TAB */
.ai-summary{background:linear-gradient(135deg,#f0f9ff,#f0fdf4);border:1px solid #bae6fd;border-radius:var(--r-lg);padding:16px;font-size:13px;line-height:1.7;color:var(--text2)}
.ai-summary h3{font-size:14px;font-weight:800;color:var(--navy);margin:12px 0 6px}
.ai-summary h3:first-child{margin-top:0}
.ai-summary ul{padding-left:16px;margin:4px 0}
.ai-summary li{margin-bottom:4px}
.ai-btn{background:linear-gradient(135deg,var(--blue),#7c3aed);color:#fff;border:none;padding:10px 20px;border-radius:var(--r);font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;width:100%;margin-bottom:12px;transition:all .15s}
.ai-btn:hover{opacity:.9}
.ai-badge{display:inline-flex;align-items:center;gap:4px;background:rgba(124,58,237,.1);color:#7c3aed;border:1px solid rgba(124,58,237,.2);border-radius:20px;padding:3px 10px;font-size:10px;font-weight:700;margin-bottom:10px}

/* ADMIN TAB */
.flow-step{display:flex;gap:12px;padding:10px 0;border-top:1px solid var(--border)}
.flow-step:first-child{border-top:none;padding-top:0}
.flow-num{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0;margin-top:2px}
.flow-num.done{background:var(--teal-light);color:var(--teal)}
.flow-num.todo{background:var(--blue-bg);color:var(--blue)}
.flow-num.warn{background:var(--yellow-light);color:var(--yellow)}
.flow-body{flex:1}
.flow-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:3px}
.flow-desc{font-size:11px;color:var(--muted);line-height:1.5}
.flow-law{font-size:10px;color:var(--blue);margin-top:4px;font-weight:600}
.permit-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.permit-item{background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);padding:8px 6px;text-align:center;font-size:10px}
.permit-icon{font-size:16px;margin-bottom:3px}
.permit-status{font-size:10px;font-weight:700}
.permit-status.pass{color:var(--green)}
.permit-status.warn{color:var(--yellow)}
.permit-status.fail{color:var(--red)}

/* BROKER TAB */
.broker-card{display:flex;align-items:center;gap:10px;padding:10px 0;border-top:1px solid var(--border)}
.broker-card:first-child{border-top:none;padding-top:0}
.broker-icon{width:36px;height:36px;background:var(--blue-bg);border-radius:var(--r);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.broker-body{flex:1}
.broker-name{font-size:13px;font-weight:700;color:var(--text)}
.broker-addr{font-size:11px;color:var(--muted)}
.broker-dist{font-size:10px;color:var(--blue);font-weight:600;margin-top:1px}
.broker-tel{background:var(--green-light);color:var(--green);border:1px solid #bbf7d0;border-radius:6px;padding:5px 10px;font-size:11px;font-weight:700;text-decoration:none;white-space:nowrap}

/* TOAST */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--navy);color:#fff;padding:10px 20px;border-radius:30px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* LOADING */
.loading-spin{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite;margin:20px auto}
@keyframes spin{to{transform:rotate(360deg)}}
.empty-state{text-align:center;padding:32px 16px;color:var(--muted)}
.empty-state .empty-icon{font-size:32px;margin-bottom:8px}

/* CUSTOM MAP OVERLAYS */
.comp-marker{background:rgba(220,38,38,.9);color:#fff;border-radius:6px;padding:3px 7px;font-size:11px;font-weight:700;white-space:nowrap;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.3)}
.comp-marker:hover{background:#b91c1c}
.poi-marker{background:rgba(17,29,54,.9);color:#fff;border-radius:6px;padding:3px 7px;font-size:11px;white-space:nowrap;box-shadow:0 2px 6px rgba(0,0,0,.3)}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <a href="index.html" class="nav-logo">
    <div class="nav-logo-icon">ğŸ—º</div>
    <span class="nav-logo-text">ì°½ì—…ì§€ë„</span>
  </a>
  <span class="nav-badge">AI í”Œë«í¼ BETA</span>
  <div class="nav-right">
    <a href="index.html" class="nav-link">â† ê¸°ì¡´ ë„êµ¬</a>
    <button class="nav-btn" onclick="showToast('ë¡œê·¸ì¸ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤')">ë¡œê·¸ì¸</button>
  </div>
</nav>

<!-- LANDING -->
<section id="landing">
  <div class="land-hero">
    <div class="land-tag">ğŸ¤– AI ê¸°ë°˜ ì°½ì—… ì‹¤í–‰ ì§€ì› í”Œë«í¼</div>
    <h1 class="land-title">ì—…ì¢… ì„ íƒë¶€í„° <span>ìˆ˜ìµ ê³„ì‚°</span>ê¹Œì§€<br>í•œ í™”ë©´ì—ì„œ ëë‚´ì„¸ìš”</h1>
    <p class="land-sub">ìƒê¶Œ ë¶„ì„ Â· ìˆ˜ìµì„± ê³„ì‚° Â· AI ìš”ì•½ Â· í–‰ì • ê°€ì´ë“œ Â· ì¤‘ê°œì‚¬ ì—°ê²°</p>
    <div class="land-steps">
      <div class="step-item"><div class="step-num active" id="s1">1</div><span class="step-label active">ì—…ì¢… ì„ íƒ</span></div>
      <div class="step-line"></div>
      <div class="step-item"><div class="step-num inactive" id="s2">2</div><span class="step-label inactive">ì§€ì—­ ì…ë ¥</span></div>
      <div class="step-line"></div>
      <div class="step-item"><div class="step-num inactive" id="s3">3</div><span class="step-label inactive">ë¶„ì„ ì‹œì‘</span></div>
    </div>
  </div>

  <!-- CATEGORY TABS -->
  <div class="cat-scroll">
    <div class="cat-tabs" id="catTabs"></div>
  </div>

  <!-- BIZ GRID -->
  <div class="biz-section">
    <div class="biz-count" id="bizCount"></div>
    <div class="biz-grid" id="bizGrid"></div>

    <!-- AREA SEARCH -->
    <div class="area-box">
      <div class="area-label">ğŸ“ Step 2 Â· ì°½ì—… í¬ë§ ì§€ì—­</div>
      <div class="area-input-row">
        <input type="text" class="area-input" id="areaInput" placeholder="ì˜ˆ: ê°•ë‚¨êµ¬ ì—­ì‚¼ë™, í™ëŒ€ì…êµ¬ì—­ ì¸ê·¼" oninput="onAreaInput()" onkeydown="if(event.key==='Enter')searchArea()">
        <button class="area-search-btn" onclick="searchArea()">ì§€ë„ í™•ì¸</button>
      </div>
    </div>

    <!-- STATUS + START -->
    <div class="sel-status" id="selStatus">
      <div class="sel-chip" id="chipBiz">ğŸª ì—…ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      <div class="sel-chip" id="chipArea">ğŸ“ ì§€ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
    </div>
    <div class="start-wrap">
      <button class="start-btn" id="startBtn" onclick="startAnalysis()" disabled>ë¶„ì„ ì‹œì‘í•˜ê¸° â†’</button>
    </div>
  </div>
</section>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none;height:calc(100vh - 52px);flex-direction:column">
  <div class="dash-header">
    <div class="dash-biz-badge" id="dashBiz">â˜• ì¹´í˜</div>
    <div class="dash-area-badge">ğŸ“ <span id="dashArea">ê°•ë‚¨êµ¬</span></div>
    <button class="dash-back" onclick="backToLanding()">â† ì¬ì„ íƒ</button>
  </div>
  <div class="dash-body">
    <!-- MAP -->
    <div id="mapPanel">
      <div id="platformMap"></div>
      <div class="map-overlay">
        <div class="map-ctrl-group">
          <button class="map-ctrl-btn" id="r500" onclick="toggleRadius(500)">500m</button>
          <button class="map-ctrl-btn" id="r1000" onclick="toggleRadius(1000)">1km</button>
          <button class="map-ctrl-btn" id="r1500" onclick="toggleRadius(1500)">1.5km</button>
        </div>
        <div class="map-ctrl-group">
          <button class="map-ctrl-btn" id="poi-subway" onclick="togglePOI('subway')">ğŸš‡</button>
          <button class="map-ctrl-btn" id="poi-school" onclick="togglePOI('school')">ğŸ«</button>
          <button class="map-ctrl-btn" id="poi-gov" onclick="togglePOI('gov')">ğŸ›ï¸</button>
          <button class="map-ctrl-btn" id="poi-comp" onclick="togglePOI('comp')">ğŸª</button>
        </div>
      </div>
      <div class="map-nearby-badge" id="nearbyBadge" style="display:none"></div>
    </div>

    <!-- ANALYSIS PANEL -->
    <div id="analysisPanel">
      <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('market')">ğŸ“Š ìƒê¶Œë¶„ì„</button>
        <button class="tab-btn" onclick="switchTab('profit')">ğŸ’° ìˆ˜ìµë¶„ì„</button>
        <button class="tab-btn" onclick="switchTab('ai')">ğŸ¤– AIìš”ì•½</button>
        <button class="tab-btn" onclick="switchTab('admin')">ğŸ“‹ í–‰ì •ê°€ì´ë“œ</button>
        <button class="tab-btn" onclick="switchTab('broker')">ğŸ¢ ì¤‘ê°œì‚¬</button>
      </div>
      <div id="tab-market" class="tab-content active"></div>
      <div id="tab-profit" class="tab-content"></div>
      <div id="tab-ai" class="tab-content"></div>
      <div id="tab-admin" class="tab-content"></div>
      <div id="tab-broker" class="tab-content"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// DATA
// ============================================================
const CATEGORIES = [
  { id:'all',     label:'ì „ì²´',       icon:'ğŸ”', color:'#64748b' },
  { id:'food',    label:'ìŒì‹Â·ì™¸ì‹',  icon:'ğŸ½ï¸', color:'#e85d04' },
  { id:'retail',  label:'ì†Œë§¤Â·ìœ í†µ',  icon:'ğŸ›ï¸', color:'#7c3aed' },
  { id:'beauty',  label:'ë·°í‹°Â·ë¯¸ìš©',  icon:'ğŸ’„', color:'#db2777' },
  { id:'health',  label:'ê±´ê°•Â·ìŠ¤í¬ì¸ ',icon:'ğŸ’ª', color:'#0284c7' },
  { id:'edu',     label:'êµìœ¡',       icon:'ğŸ“š', color:'#16a34a' },
  { id:'leisure', label:'ì—¬ê°€Â·ì—”í„°',  icon:'ğŸ®', color:'#f59e0b' },
  { id:'service', label:'ìƒí™œì„œë¹„ìŠ¤', icon:'ğŸ”§', color:'#475569' },
];

// vc=ë³€ë™ë¹„ìœ¨, pc=ì¸í…Œë¦¬ì–´ë¹„(ë§Œì›/í‰), lb=ì¸ê±´ë¹„ê¸°ë³¸, rb=ì›”ë§¤ì¶œì¤‘ê°„ê°’, rp=ë¹„ê´€, ro=ë‚™ê´€
// cm=ìµœì†Œì°½ì—…ë¹„ìš©, bp=ê¸°ì¤€í‰ìˆ˜, bm=BEPì›”, mc=ì›”ê³ ì •ë¹„, pk=í”¼í¬ì‹œê°„, kw=ì¹´ì¹´ì˜¤ê²€ìƒ‰ì–´
const BIZ = {
  // â”€â”€ ìŒì‹Â·ì™¸ì‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'ì¹´í˜':      {cat:'food',   icon:'â˜•', nm:'ì¹´í˜Â·ì»¤í”¼ìˆ',     kw:'ì¹´í˜',     vc:.35,pc:200,lb:250,rb:520, rp:280,ro:840, cm:3500, bp:15,bm:8, mc:350,pk:[8,9,12,13,15,16]},
  'ê³ ê¹ƒì§‘':    {cat:'food',   icon:'ğŸ¥©', nm:'ê³ ê¹ƒì§‘Â·êµ¬ì´ì§‘',   kw:'ê³ ê¹ƒì§‘',   vc:.45,pc:250,lb:400,rb:850, rp:450,ro:1400,cm:6500, bp:30,bm:10,mc:600,pk:[18,19,20,21]},
  'ì¹˜í‚¨ì§‘':    {cat:'food',   icon:'ğŸ—', nm:'ì¹˜í‚¨ì§‘',          kw:'ì¹˜í‚¨',     vc:.42,pc:180,lb:200,rb:650, rp:350,ro:1050,cm:4500, bp:18,bm:9, mc:420,pk:[18,19,20,21,22]},
  'ì¤‘êµ­ì§‘':    {cat:'food',   icon:'ğŸ¥¡', nm:'ì¤‘êµ­ì§‘Â·ì¤‘ì‹ë‹¹',   kw:'ì¤‘êµ­ì§‘',   vc:.42,pc:180,lb:250,rb:600, rp:320,ro:950, cm:3500, bp:25,bm:8, mc:380,pk:[11,12,13,18,19]},
  'ë¶„ì‹ì§‘':    {cat:'food',   icon:'ğŸœ', nm:'ë¶„ì‹ì§‘Â·ê¹€ë°¥ì§‘',   kw:'ë¶„ì‹',     vc:.40,pc:150,lb:150,rb:420, rp:220,ro:680, cm:2000, bp:15,bm:6, mc:220,pk:[11,12,13,17,18]},
  'ë² ì´ì»¤ë¦¬':  {cat:'food',   icon:'ğŸ¥', nm:'ë² ì´ì»¤ë¦¬Â·ì œê³¼ì ', kw:'ë² ì´ì»¤ë¦¬', vc:.38,pc:220,lb:230,rb:580, rp:300,ro:920, cm:5000, bp:20,bm:10,mc:380,pk:[7,8,9,12,13]},
  'ìˆ ì§‘':      {cat:'food',   icon:'ğŸº', nm:'ìˆ ì§‘Â·í˜¸í”„Â·í¬ì°¨',  kw:'ìˆ ì§‘',     vc:.35,pc:200,lb:280,rb:700, rp:350,ro:1200,cm:4000, bp:30,bm:9, mc:480,pk:[18,19,20,21,22,23]},
  'ì¼ì‹':      {cat:'food',   icon:'ğŸ±', nm:'ì¼ì‹Â·ì´ˆë°¥ì§‘',     kw:'ì¼ì‹ë‹¹',   vc:.40,pc:220,lb:300,rb:700, rp:380,ro:1100,cm:5500, bp:25,bm:10,mc:480,pk:[12,13,18,19,20]},
  'í”¼ìì–‘ì‹':  {cat:'food',   icon:'ğŸ•', nm:'í”¼ìÂ·ì–‘ì‹ë‹¹',     kw:'í”¼ì',     vc:.38,pc:180,lb:250,rb:560, rp:300,ro:900, cm:4000, bp:20,bm:9, mc:380,pk:[12,13,18,19,20]},
  'í¬ì°¨':      {cat:'food',   icon:'ğŸ®', nm:'í¬ì¥ë§ˆì°¨Â·í¬ì°¨',   kw:'í¬ì°¨',     vc:.35,pc:80, lb:100,rb:380, rp:180,ro:650, cm:1000, bp:8, bm:5, mc:200,pk:[17,18,19,20,21,22,23]},
  'íšŸì§‘':      {cat:'food',   icon:'ğŸŸ', nm:'íšŸì§‘Â·í•´ì‚°ë¬¼',     kw:'íšŸì§‘',     vc:.50,pc:280,lb:400,rb:900, rp:500,ro:1500,cm:8000, bp:40,bm:12,mc:700,pk:[12,13,18,19,20,21]},
  'ë²„ê±°':      {cat:'food',   icon:'ğŸ”', nm:'ë²„ê±°Â·íŒ¨ìŠ¤íŠ¸í‘¸ë“œ', kw:'ë²„ê±°',     vc:.40,pc:160,lb:200,rb:480, rp:250,ro:800, cm:3000, bp:15,bm:8, mc:320,pk:[11,12,13,17,18,19]},
  'ìŒ€êµ­ìˆ˜':    {cat:'food',   icon:'ğŸ›', nm:'ìŒ€êµ­ìˆ˜Â·ì•„ì‹œì•ˆ',   kw:'ìŒ€êµ­ìˆ˜',   vc:.38,pc:160,lb:200,rb:480, rp:250,ro:780, cm:3000, bp:18,bm:8, mc:320,pk:[11,12,13,18,19]},
  'í•œì •ì‹':    {cat:'food',   icon:'ğŸš', nm:'í•œì •ì‹Â·ì •ì‹ì§‘',   kw:'í•œì •ì‹',   vc:.40,pc:200,lb:350,rb:800, rp:450,ro:1300,cm:6000, bp:35,bm:11,mc:600,pk:[12,13,18,19,20]},
  // â”€â”€ ì†Œë§¤Â·ìœ í†µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'í¸ì˜ì ':    {cat:'retail', icon:'ğŸª', nm:'í¸ì˜ì ',          kw:'í¸ì˜ì ',   vc:.65,pc:150,lb:180,rb:320, rp:180,ro:480, cm:3500, bp:20,bm:12,mc:250,pk:[7,8,12,13,18,19,22,23]},
  'ìŠˆí¼ë§ˆì¼“':  {cat:'retail', icon:'ğŸ›’', nm:'ìŠˆí¼ë§ˆì¼“Â·ë§ˆíŠ¸',  kw:'ìŠˆí¼',     vc:.70,pc:120,lb:280,rb:900, rp:550,ro:1500,cm:6000, bp:60,bm:14,mc:600,pk:[9,10,11,16,17,18]},
  'ì˜ë¥˜ì ':    {cat:'retail', icon:'ğŸ‘—', nm:'ì˜ë¥˜ì Â·ì˜·ê°€ê²Œ',   kw:'ì˜·ê°€ê²Œ',   vc:.50,pc:180,lb:180,rb:500, rp:250,ro:850, cm:4000, bp:25,bm:10,mc:320,pk:[12,13,14,15,16,17]},
  'ì•½êµ­':      {cat:'retail', icon:'ğŸ’Š', nm:'ì•½êµ­Â·ë“œëŸ­ìŠ¤í† ì–´', kw:'ì•½êµ­',     vc:.55,pc:200,lb:350,rb:800, rp:450,ro:1200,cm:8000, bp:25,bm:10,mc:550,pk:[9,10,11,14,15,16]},
  'í™”ì¥í’ˆ':    {cat:'retail', icon:'ğŸ§´', nm:'í™”ì¥í’ˆìƒµ',        kw:'í™”ì¥í’ˆ',   vc:.45,pc:200,lb:200,rb:480, rp:250,ro:800, cm:4000, bp:20,bm:10,mc:320,pk:[12,13,14,15,16,17]},
  'ê½ƒì§‘':      {cat:'retail', icon:'ğŸ’', nm:'ê½ƒì§‘Â·í”Œë¼ì›Œìƒµ',  kw:'ê½ƒì§‘',     vc:.55,pc:100,lb:150,rb:320, rp:150,ro:550, cm:2000, bp:12,bm:8, mc:200,pk:[9,10,14,15]},
  'ì•ˆê²½ì ':    {cat:'retail', icon:'ğŸ‘“', nm:'ì•ˆê²½ì Â·ë Œì¦ˆìƒµ',  kw:'ì•ˆê²½ì ',   vc:.40,pc:180,lb:200,rb:600, rp:300,ro:1000,cm:5000, bp:20,bm:9, mc:380,pk:[12,13,14,15,16,17]},
  'ë¬¸êµ¬ì¡í™”':  {cat:'retail', icon:'âœï¸', nm:'ë¬¸êµ¬Â·ì¡í™”ì ',    kw:'ë¬¸êµ¬ì ',   vc:.60,pc:100,lb:150,rb:280, rp:150,ro:450, cm:2000, bp:15,bm:10,mc:200,pk:[13,14,15,16,17]},
  // â”€â”€ ë·°í‹°Â·ë¯¸ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'ë¯¸ìš©ì‹¤':    {cat:'beauty', icon:'ğŸ’‡', nm:'ë¯¸ìš©ì‹¤Â·í—¤ì–´ìƒµ',  kw:'ë¯¸ìš©ì‹¤',   vc:.30,pc:180,lb:250,rb:520, rp:280,ro:850, cm:3000, bp:20,bm:8, mc:320,pk:[11,12,14,15,16]},
  'ë„¤ì¼ìƒµ':    {cat:'beauty', icon:'ğŸ’…', nm:'ë„¤ì¼ìƒµ',          kw:'ë„¤ì¼ìƒµ',   vc:.25,pc:160,lb:200,rb:480, rp:260,ro:760, cm:2000, bp:15,bm:7, mc:280,pk:[13,14,15,16,17]},
  'í”¼ë¶€ê´€ë¦¬':  {cat:'beauty', icon:'âœ¨', nm:'í”¼ë¶€ê´€ë¦¬ì‹¤',      kw:'í”¼ë¶€ê´€ë¦¬', vc:.25,pc:200,lb:250,rb:600, rp:300,ro:1000,cm:5000, bp:20,bm:10,mc:400,pk:[11,12,14,15,16]},
  'ì™ì‹±':      {cat:'beauty', icon:'ğŸŒ¸', nm:'ì™ì‹±ìƒµ',          kw:'ì™ì‹±',     vc:.20,pc:150,lb:180,rb:400, rp:200,ro:650, cm:2500, bp:10,bm:7, mc:260,pk:[12,13,14,15,16]},
  'ëˆˆì¹':      {cat:'beauty', icon:'ğŸ‘ï¸', nm:'ëˆˆì¹Â·ì†ëˆˆì¹ìƒµ', kw:'ëˆˆì¹',     vc:.15,pc:130,lb:150,rb:350, rp:180,ro:580, cm:1500, bp:8, bm:6, mc:220,pk:[12,13,14,15,16]},
  'íƒ€íˆ¬':      {cat:'beauty', icon:'ğŸ¨', nm:'íƒ€íˆ¬Â·ë°˜ì˜êµ¬',     kw:'íƒ€íˆ¬',     vc:.15,pc:150,lb:150,rb:450, rp:220,ro:750, cm:2000, bp:10,bm:7, mc:250,pk:[13,14,15,16,17]},
  // â”€â”€ ê±´ê°•Â·ìŠ¤í¬ì¸  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'í—¬ìŠ¤ì¥':    {cat:'health', icon:'ğŸ‹ï¸', nm:'í—¬ìŠ¤ì¥Â·í”¼íŠ¸ë‹ˆìŠ¤',kw:'í—¬ìŠ¤ì¥',   vc:.15,pc:180,lb:350,rb:800, rp:400,ro:1400,cm:8000, bp:80,bm:14,mc:700,pk:[6,7,18,19,20]},
  'í•„ë¼í…ŒìŠ¤':  {cat:'health', icon:'ğŸ¤¸', nm:'í•„ë¼í…ŒìŠ¤',        kw:'í•„ë¼í…ŒìŠ¤', vc:.15,pc:220,lb:280,rb:700, rp:350,ro:1200,cm:6000, bp:40,bm:10,mc:550,pk:[7,8,10,11,19,20]},
  'ìš”ê°€ì›':    {cat:'health', icon:'ğŸ§˜', nm:'ìš”ê°€ì›',          kw:'ìš”ê°€',     vc:.12,pc:180,lb:250,rb:600, rp:300,ro:1000,cm:4500, bp:30,bm:9, mc:450,pk:[7,8,10,11,19,20]},
  'ê³¨í”„ì—°ìŠµì¥':{cat:'health', icon:'â›³', nm:'ê³¨í”„ì—°ìŠµì¥',      kw:'ê³¨í”„ì—°ìŠµì¥',vc:.10,pc:250,lb:300,rb:1000,rp:550,ro:1800,cm:12000,bp:100,bm:16,mc:750,pk:[8,9,10,16,17,18]},
  'ë¬´ë„ì¥':    {cat:'health', icon:'ğŸ¥‹', nm:'íƒœê¶Œë„Â·ë¬´ë„ì¥',   kw:'íƒœê¶Œë„',   vc:.12,pc:150,lb:200,rb:500, rp:250,ro:850, cm:3500, bp:50,bm:9, mc:380,pk:[16,17,18,19,20]},
  'í´ë¼ì´ë°':  {cat:'health', icon:'ğŸ§—', nm:'í´ë¼ì´ë°Â·ë³¼ë”ë§',kw:'í´ë¼ì´ë°', vc:.12,pc:300,lb:250,rb:650, rp:350,ro:1100,cm:8000, bp:80,bm:13,mc:500,pk:[18,19,20,21]},
  // â”€â”€ êµìœ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'ë³´ìŠµí•™ì›':  {cat:'edu',    icon:'ğŸ“–', nm:'ë³´ìŠµÂ·ì…ì‹œí•™ì›',   kw:'í•™ì›',     vc:.15,pc:120,lb:400,rb:900, rp:500,ro:1500,cm:5000, bp:60,bm:8, mc:700,pk:[15,16,17,18,19,20]},
  'ì˜ì–´í•™ì›':  {cat:'edu',    icon:'ğŸ”¤', nm:'ì˜ì–´í•™ì›',        kw:'ì˜ì–´í•™ì›', vc:.15,pc:130,lb:450,rb:1000,rp:550,ro:1800,cm:6000, bp:50,bm:8, mc:750,pk:[15,16,17,18,19,20]},
  'ìŒì•…í•™ì›':  {cat:'edu',    icon:'ğŸ¹', nm:'í”¼ì•„ë…¸Â·ìŒì•…í•™ì›', kw:'ìŒì•…í•™ì›', vc:.10,pc:200,lb:300,rb:600, rp:300,ro:1000,cm:4000, bp:40,bm:9, mc:500,pk:[15,16,17,18,19,20]},
  'ë¯¸ìˆ í•™ì›':  {cat:'edu',    icon:'ğŸ–Œï¸', nm:'ë¯¸ìˆ í•™ì›',        kw:'ë¯¸ìˆ í•™ì›', vc:.15,pc:150,lb:280,rb:550, rp:280,ro:900, cm:3500, bp:40,bm:8, mc:450,pk:[15,16,17,18,19]},
  'ì–´ë¦°ì´ì§‘':  {cat:'edu',    icon:'ğŸ§’', nm:'ì–´ë¦°ì´ì§‘Â·ìœ ì¹˜ì›', kw:'ì–´ë¦°ì´ì§‘', vc:.20,pc:200,lb:600,rb:1200,rp:800,ro:1800,cm:10000,bp:80,bm:12,mc:1000,pk:[8,9,16,17]},
  'ìˆ˜í•™í•™ì›':  {cat:'edu',    icon:'ğŸ”¢', nm:'ìˆ˜í•™í•™ì›',        kw:'ìˆ˜í•™í•™ì›', vc:.15,pc:120,lb:350,rb:800, rp:450,ro:1400,cm:4500, bp:50,bm:8, mc:650,pk:[15,16,17,18,19,20]},
  // â”€â”€ ì—¬ê°€Â·ì—”í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'ë…¸ë˜ë°©':    {cat:'leisure',icon:'ğŸ¤', nm:'ë…¸ë˜ë°©Â·ì½”ì¸ë…¸ë˜ë°©',kw:'ë…¸ë˜ë°©',  vc:.20,pc:200,lb:300,rb:520, rp:280,ro:820, cm:6000, bp:50,bm:12,mc:500,pk:[19,20,21,22,23]},
  'PCë°©':      {cat:'leisure',icon:'ğŸ–¥ï¸', nm:'PCë°©',            kw:'PCë°©',    vc:.25,pc:200,lb:200,rb:480, rp:250,ro:780, cm:8000, bp:60,bm:14,mc:520,pk:[14,15,16,17,18,19,20,21,22]},
  'ë‹¹êµ¬ì¥':    {cat:'leisure',icon:'ğŸ±', nm:'ë‹¹êµ¬ì¥Â·í¬ì¼“ë³¼',   kw:'ë‹¹êµ¬ì¥',  vc:.10,pc:150,lb:200,rb:400, rp:200,ro:650, cm:3000, bp:60,bm:10,mc:300,pk:[14,15,16,17,18,19,20,21]},
  'ìŠ¤í¬ë¦°ê³¨í”„':{cat:'leisure',icon:'ğŸŒï¸', nm:'ìŠ¤í¬ë¦°ê³¨í”„',      kw:'ìŠ¤í¬ë¦°ê³¨í”„',vc:.12,pc:250,lb:200,rb:700,rp:380,ro:1200,cm:7000, bp:60,bm:12,mc:500,pk:[7,8,17,18,19,20,21]},
  'ë°©íƒˆì¶œ':    {cat:'leisure',icon:'ğŸ”', nm:'ë°©íƒˆì¶œÂ·í…Œë§ˆì¹´í˜', kw:'ë°©íƒˆì¶œ',  vc:.20,pc:300,lb:200,rb:600, rp:300,ro:1000,cm:5000, bp:40,bm:10,mc:400,pk:[14,15,16,17,18,19,20,21]},
  'ë³´ë“œê²Œì„':  {cat:'leisure',icon:'ğŸ²', nm:'ë³´ë“œê²Œì„ì¹´í˜',    kw:'ë³´ë“œê²Œì„ì¹´í˜',vc:.20,pc:200,lb:150,rb:420,rp:200,ro:700, cm:3000, bp:40,bm:9, mc:300,pk:[14,15,16,17,18,19,20,21]},
  // â”€â”€ ìƒí™œì„œë¹„ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'ì„¸íƒì†Œ':    {cat:'service',icon:'ğŸ‘”', nm:'ì„¸íƒì†ŒÂ·ì½”ì¸ë¹¨ë˜ë°©',kw:'ì„¸íƒì†Œ',  vc:.35,pc:100,lb:200,rb:350, rp:180,ro:600, cm:3000, bp:20,bm:10,mc:280,pk:[9,10,11,16,17,18]},
  'ë°˜ë ¤ë™ë¬¼':  {cat:'service',icon:'ğŸ¾', nm:'ë°˜ë ¤ë™ë¬¼ìƒµÂ·ë¯¸ìš©', kw:'ë™ë¬¼ë³‘ì›', vc:.40,pc:180,lb:200,rb:480, rp:250,ro:800, cm:3500, bp:20,bm:9, mc:340,pk:[11,12,13,14,15,16,17]},
  'ì¸í…Œë¦¬ì–´':  {cat:'service',icon:'ğŸ”¨', nm:'ì¸í…Œë¦¬ì–´Â·ìˆ˜ì„ ì ', kw:'ì¸í…Œë¦¬ì–´', vc:.45,pc:100,lb:300,rb:600, rp:300,ro:1000,cm:3000, bp:30,bm:8, mc:450,pk:[9,10,11,14,15,16]},
  'ìë™ì°¨':    {cat:'service',icon:'ğŸš—', nm:'ìë™ì°¨ìš©í’ˆÂ·ì„¸ì°¨',  kw:'ìë™ì°¨ì„¸ì°¨',vc:.40,pc:120,lb:200,rb:500,rp:280,ro:850, cm:4000, bp:40,bm:9, mc:360,pk:[10,11,14,15,16,17]},
};

// ============================================================
// STATE
// ============================================================
let state = {
  biz: null, bizKey: null, area: '', coords: null,
  activeCat: 'all', rendered: {}, activeTab: 'market',
  radiusCircles: {}, radiusActive: new Set(),
  poiMarkers: {}, poiActive: new Set(),
  compMarkers: [], compInfoWins: [],
  kakaoMap: null, mapCenterMarker: null,
  hourChart: null, dayChart: null,
  geocoder: null,
};

// ============================================================
// LANDING INIT
// ============================================================
function initLanding() {
  renderCatTabs();
  renderBizGrid('all');
}

function renderCatTabs() {
  const el = document.getElementById('catTabs');
  el.innerHTML = CATEGORIES.map(c => `
    <button class="cat-tab ${c.id==='all'?'active':''}"
      style="${c.id==='all'?'background:'+c.color+';border-color:'+c.color+';color:#fff':''}"
      onclick="setCat('${c.id}','${c.color}')" id="ct-${c.id}">
      ${c.icon} ${c.label}
    </button>`).join('');
}

function setCat(id, color) {
  state.activeCat = id;
  document.querySelectorAll('.cat-tab').forEach(t => {
    t.classList.remove('active');
    t.style.background = ''; t.style.borderColor = ''; t.style.color = '';
  });
  const btn = document.getElementById('ct-' + id);
  btn.classList.add('active');
  btn.style.background = color; btn.style.borderColor = color; btn.style.color = '#fff';
  renderBizGrid(id);
}

function renderBizGrid(cat) {
  const keys = Object.keys(BIZ).filter(k => cat === 'all' || BIZ[k].cat === cat);
  document.getElementById('bizCount').textContent = `${keys.length}ê°œ ì—…ì¢…`;
  document.getElementById('bizGrid').innerHTML = keys.map(k => {
    const b = BIZ[k];
    return `<div class="biz-card ${state.bizKey===k?'selected':''}" onclick="selectBiz('${k}')" id="bc-${k}">
      <span class="biz-card-icon">${b.icon}</span>
      <span class="biz-card-name">${b.nm || k}</span>
    </div>`;
  }).join('');
}

function selectBiz(key) {
  state.bizKey = key;
  state.biz = BIZ[key];
  document.querySelectorAll('.biz-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById('bc-' + key);
  if (card) card.classList.add('selected');
  const chip = document.getElementById('chipBiz');
  chip.textContent = state.biz.icon + ' ' + (state.biz.nm || key);
  chip.classList.add('active');
  updateStepUI();
  checkStart();
}

function onAreaInput() {
  state.area = document.getElementById('areaInput').value.trim();
  checkStart();
}

function searchArea() {
  const q = document.getElementById('areaInput').value.trim();
  if (!q) { showToast('ì§€ì—­ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  state.area = q;
  // Kakao SDK ë¯¸ë¡œë“œ(ë¡œì»¬ ê°œë°œí™˜ê²½) ì‹œ í…ìŠ¤íŠ¸ë§Œ ì €ì¥í•˜ê³  ì§„í–‰
  if (typeof kakao === 'undefined' || !kakao.maps) {
    state.coords = state.coords || { lat: 37.5665, lng: 126.9780 };
    document.getElementById('chipArea').textContent = 'ğŸ“ ' + q;
    document.getElementById('chipArea').classList.add('active');
    showToast('ğŸ“ ì§€ì—­ ì…ë ¥ ì™„ë£Œ (ì§€ë„ëŠ” ë°°í¬ í›„ í™œì„±í™”)');
    updateStepUI();
    checkStart();
    return;
  }
  if (!state.geocoder) state.geocoder = new kakao.maps.services.Geocoder();
  state.geocoder.addressSearch(q, function(result, status) {
    if (status === kakao.maps.services.Status.OK) {
      state.coords = { lat: parseFloat(result[0].y), lng: parseFloat(result[0].x) };
      document.getElementById('chipArea').textContent = 'ğŸ“ ' + q;
      document.getElementById('chipArea').classList.add('active');
      showToast('ğŸ“ ìœ„ì¹˜ í™•ì¸: ' + q);
      updateStepUI();
      checkStart();
    } else {
      const ps = new kakao.maps.services.Places();
      ps.keywordSearch(q, function(r2, s2) {
        if (s2 === kakao.maps.services.Status.OK) {
          state.coords = { lat: parseFloat(r2[0].y), lng: parseFloat(r2[0].x) };
          document.getElementById('chipArea').textContent = 'ğŸ“ ' + r2[0].place_name;
          document.getElementById('chipArea').classList.add('active');
          state.area = r2[0].place_name;
          showToast('ğŸ“ ìœ„ì¹˜ í™•ì¸: ' + r2[0].place_name);
          updateStepUI();
          checkStart();
        } else {
          showToast('ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }
      });
    }
  });
}

function updateStepUI() {
  const hasBiz = !!state.bizKey;
  const hasArea = !!state.area;
  ['s1','s2','s3'].forEach(id => {
    const el = document.getElementById(id);
    el.className = 'step-num inactive';
    el.parentElement.querySelector('.step-label').className = 'step-label inactive';
  });
  document.getElementById('s1').className = 'step-num ' + (hasBiz ? 'done' : 'active');
  document.getElementById('s1').parentElement.querySelector('.step-label').className = 'step-label ' + (hasBiz ? 'done' : 'active');
  document.getElementById('s2').className = 'step-num ' + (hasArea ? 'done' : hasBiz ? 'active' : 'inactive');
  document.getElementById('s2').parentElement.querySelector('.step-label').className = 'step-label ' + (hasArea ? 'done' : hasBiz ? 'active' : 'inactive');
  document.getElementById('s3').className = 'step-num ' + (hasBiz && hasArea ? 'active' : 'inactive');
  document.getElementById('s3').parentElement.querySelector('.step-label').className = 'step-label ' + (hasBiz && hasArea ? 'active' : 'inactive');
}

function checkStart() {
  document.getElementById('startBtn').disabled = !(state.bizKey && state.area);
}

// ============================================================
// DASHBOARD
// ============================================================
function startAnalysis() {
  if (!state.bizKey || !state.area) return;
  if (!state.coords) {
    // Use default Seoul coords and search in dashboard
    state.coords = { lat: 37.5665, lng: 126.9780 };
  }
  document.getElementById('landing').style.display = 'none';
  const dash = document.getElementById('dashboard');
  dash.style.display = 'flex';
  document.getElementById('dashBiz').textContent = state.biz.icon + ' ' + (state.biz.nm || state.bizKey);
  document.getElementById('dashArea').textContent = state.area;
  state.rendered = {};
  state.apiResult = null;

  // ë°±ê·¸ë¼ìš´ë“œë¡œ /api/analyze í˜¸ì¶œ (Netlify ë°°í¬ í™˜ê²½ì—ì„œ í™œì„±í™”)
  fetch(`/api/analyze?lat=${state.coords.lat}&lng=${state.coords.lng}&bizType=${encodeURIComponent(state.bizKey)}&radius=500`)
    .then(r => r.ok ? r.json() : null)
    .then(data => { if (data?.success) state.apiResult = data; })
    .catch(() => {});

  if (!state.kakaoMap) {
    setTimeout(initKakaoMap, 100);
  } else {
    centerMap(state.coords.lat, state.coords.lng);
    loadCompetitors();
  }
  switchTab('market');
}

function backToLanding() {
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('landing').style.display = 'block';
}

// ============================================================
// KAKAO MAP
// ============================================================
function initKakaoMap() {
  if (typeof kakao === 'undefined' || !kakao.maps) {
    document.getElementById('platformMap').innerHTML =
      `<div style="height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:rgba(255,255,255,.4);gap:10px;background:#0f1a2e">
        <div style="font-size:40px">ğŸ—º</div>
        <div style="font-size:13px;font-weight:600">ì§€ë„ëŠ” ë°°í¬ í™˜ê²½ì—ì„œ í™œì„±í™”ë©ë‹ˆë‹¤</div>
        <div style="font-size:11px;opacity:.6">Kakao ê°œë°œì ì½˜ì†”ì— 127.0.0.1 ë„ë©”ì¸ ë“±ë¡ í•„ìš”</div>
        <a href="https://developers.kakao.com" target="_blank" style="color:#38bdf8;font-size:11px">developers.kakao.com â†’</a>
      </div>`;
    return;
  }
  const container = document.getElementById('platformMap');
  const options = { center: new kakao.maps.LatLng(state.coords.lat, state.coords.lng), level: 4 };
  state.kakaoMap = new kakao.maps.Map(container, options);
  state.mapCenterMarker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(state.coords.lat, state.coords.lng), map: state.kakaoMap });
  kakao.maps.event.addListener(state.kakaoMap, 'click', function(e) {
    const lat = e.latLng.getLat(), lng = e.latLng.getLng();
    state.coords = { lat, lng };
    state.mapCenterMarker.setPosition(new kakao.maps.LatLng(lat, lng));
    Object.values(state.radiusCircles).forEach(c => c.setCenter(new kakao.maps.LatLng(lat, lng)));
    clearCompetitors();
    if (state.poiActive.has('comp')) loadCompetitors();
  });
  loadCompetitors();
}

function centerMap(lat, lng) {
  if (!state.kakaoMap) return;
  const pos = new kakao.maps.LatLng(lat, lng);
  state.kakaoMap.setCenter(pos);
  state.mapCenterMarker.setPosition(pos);
}

function toggleRadius(r) {
  if (!state.kakaoMap) { showToast('ì§€ë„ê°€ ë¡œë“œëœ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤'); return; }
  const btn = document.getElementById('r' + r);
  if (state.radiusActive.has(r)) {
    state.radiusActive.delete(r);
    btn.classList.remove('active');
    if (state.radiusCircles[r]) { state.radiusCircles[r].setMap(null); delete state.radiusCircles[r]; }
  } else {
    state.radiusActive.add(r);
    btn.classList.add('active');
    const colors = { 500: '#2563eb', 1000: '#16a34a', 1500: '#ea580c' };
    const circle = new kakao.maps.Circle({
      center: new kakao.maps.LatLng(state.coords.lat, state.coords.lng),
      radius: r, map: state.kakaoMap,
      strokeWeight: 2, strokeColor: colors[r], strokeOpacity: .7, strokeStyle: 'dashed',
      fillColor: colors[r], fillOpacity: .04
    });
    state.radiusCircles[r] = circle;
  }
}

const POI_CONFIG = {
  subway: { kw: 'ì§€í•˜ì² ì—­',  icon: 'ğŸš‡', cat: 'SW8' },
  school: { kw: 'í•™êµ',      icon: 'ğŸ«', cat: 'SC4' },
  gov:    { kw: 'ê´€ê³µì„œ',    icon: 'ğŸ›ï¸', cat: 'PO3' },
  comp:   { kw: null,        icon: null, cat: null },
};

function togglePOI(type) {
  if (!state.kakaoMap) { showToast('ì§€ë„ê°€ ë¡œë“œëœ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤'); return; }
  const btn = document.getElementById('poi-' + type);
  if (type === 'comp') {
    if (state.poiActive.has('comp')) {
      state.poiActive.delete('comp');
      btn.classList.remove('active');
      clearCompetitors();
      document.getElementById('nearbyBadge').style.display = 'none';
    } else {
      state.poiActive.add('comp');
      btn.classList.add('active');
      loadCompetitors();
    }
    return;
  }
  if (state.poiActive.has(type)) {
    state.poiActive.delete(type);
    btn.classList.remove('active');
    (state.poiMarkers[type] || []).forEach(m => m.setMap(null));
    state.poiMarkers[type] = [];
  } else {
    state.poiActive.add(type);
    btn.classList.add('active');
    const cfg = POI_CONFIG[type];
    const ps = new kakao.maps.services.Places();
    ps.categorySearch(cfg.cat, function(data, status) {
      if (status !== kakao.maps.services.Status.OK) return;
      state.poiMarkers[type] = [];
      (data || []).forEach(place => {
        const pos = new kakao.maps.LatLng(place.y, place.x);
        const content = `<div class="poi-marker">${cfg.icon} ${place.place_name}</div>`;
        const ov = new kakao.maps.CustomOverlay({ position: pos, content, yAnchor: 1.4, zIndex: 3 });
        ov.setMap(state.kakaoMap);
        state.poiMarkers[type].push(ov);
      });
    }, { location: new kakao.maps.LatLng(state.coords.lat, state.coords.lng), radius: 1000 });
  }
}

function loadCompetitors() {
  if (!state.kakaoMap || !state.biz) return;
  clearCompetitors();
  const ps = new kakao.maps.services.Places();
  const kw = state.biz.kw || state.bizKey;
  const loc = new kakao.maps.LatLng(state.coords.lat, state.coords.lng);
  ps.keywordSearch(kw, function(data, status) {
    const badge = document.getElementById('nearbyBadge');
    if (status === kakao.maps.services.Status.ZERO_RESULT || !data || !data.length) {
      badge.textContent = `ë°˜ê²½ 500m ë‚´ ${kw} 0ê³³ ğŸŸ¢ ì–‘í˜¸`;
      badge.style.display = 'block'; return;
    }
    badge.textContent = `ë°˜ê²½ 500m ë‚´ ë™ì¢…ì—…ì†Œ ${data.length}ê³³ ${data.length>7?'ğŸ”´ ê³¼ë°€':data.length>4?'ğŸŸ¡ ë³´í†µ':'ğŸŸ¢ ì–‘í˜¸'}`;
    badge.style.display = 'block';
    data.forEach(place => {
      const pos = new kakao.maps.LatLng(place.y, place.x);
      const dist = Math.round(parseFloat(place.distance || 0));
      const content = `<div class="comp-marker" title="${place.place_name}">${state.biz.icon} ${place.place_name.slice(0,8)}${dist?` (${dist}m)`:''}</div>`;
      const ov = new kakao.maps.CustomOverlay({ position: pos, content, yAnchor: 1.4, zIndex: 5 });
      ov.setMap(state.kakaoMap);
      state.compMarkers.push(ov);
    });
  }, { location: loc, radius: 500, sort: kakao.maps.services.SortBy.DISTANCE });
}

function clearCompetitors() {
  state.compMarkers.forEach(m => m.setMap(null));
  state.compMarkers = [];
}

// ============================================================
// TAB SWITCHING
// ============================================================
function switchTab(name) {
  state.activeTab = name;
  document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  const tabs = ['market','profit','ai','admin','broker'];
  const idx = tabs.indexOf(name);
  if (idx >= 0) document.querySelectorAll('.tab-btn')[idx].classList.add('active');
  document.getElementById('tab-' + name).classList.add('active');
  if (!state.rendered[name]) {
    state.rendered[name] = true;
    const renders = { market: renderMarket, profit: renderProfit, ai: renderAI, admin: renderAdmin, broker: renderBroker };
    if (renders[name]) renders[name]();
  }
}

// ============================================================
// TAB: ìƒê¶Œë¶„ì„
// ============================================================
function renderMarket() {
  const b = state.biz;
  const score = Math.round(b.rb / (b.ro) * 100);
  const gradeColor = score >= 65 ? 'green' : score >= 45 ? 'yellow' : 'red';
  const grade = score >= 65 ? 'ì–‘í˜¸' : score >= 45 ? 'ë³´í†µ' : 'ìœ„í—˜';
  const compScore = Math.min(100, Math.round((b.rb - b.rp) / (b.ro - b.rp) * 100));
  document.getElementById('tab-market').innerHTML = `
  <div class="sec-card">
    <div class="sec-title">ğŸ“Š ì¢…í•© ìƒê¶Œ ì ìˆ˜</div>
    <div class="score-ring">
      <div class="score-circle ${gradeColor}">${compScore}<span style="font-size:11px">ì </span></div>
      <div class="score-meta">
        <div class="score-grade">${grade} â€” ${b.nm || state.bizKey}</div>
        <div class="score-desc">ì›” ì˜ˆìƒ ë§¤ì¶œ: ${b.rp.toLocaleString()}~${b.ro.toLocaleString()}ë§Œì›</div>
        <div class="score-desc">ê¸°ì¤€ ì°½ì—…ë¹„: ${b.cm.toLocaleString()}ë§Œì›~ / BEP ${b.bm}ê°œì›”</div>
      </div>
    </div>
    <div class="stat-row">
      <div class="stat-box"><div class="stat-val">${b.rb.toLocaleString()}<span style="font-size:11px">ë§Œ</span></div><div class="stat-label">ì›” ê¸°ì¤€ ë§¤ì¶œ</div></div>
      <div class="stat-box"><div class="stat-val">${b.mc.toLocaleString()}<span style="font-size:11px">ë§Œ</span></div><div class="stat-label">ì›” ê¸°ì¤€ ê³ ì •ë¹„</div></div>
      <div class="stat-box"><div class="stat-val">${Math.round((1-b.vc)*100)}<span style="font-size:11px">%</span></div><div class="stat-label">ë§ˆì§„ìœ¨</div></div>
    </div>
  </div>
  <div class="sec-card">
    <div class="sec-title">â° ì‹œê°„ëŒ€ë³„ ë°©ë¬¸ íŒ¨í„´</div>
    <div class="chart-wrap"><canvas id="hourChart"></canvas></div>
  </div>
  <div class="sec-card">
    <div class="sec-title">ğŸ“… ìš”ì¼ë³„ ë§¤ì¶œ íŒ¨í„´</div>
    <div class="chart-wrap"><canvas id="dayChart"></canvas></div>
  </div>
  <div class="sec-card">
    <div class="sec-title">âš ï¸ ì£¼ìš” ë¦¬ìŠ¤í¬</div>
    ${getRiskHTML(b)}
  </div>`;
  setTimeout(() => {
    buildHourChart(b);
    buildDayChart(b);
  }, 50);
}

function getRiskHTML(b) {
  const risks = [
    { icon:'ğŸ”´', title:'ê²½ìŸ ë°€ë„ í™•ì¸ í•„ìš”', desc:`ë°˜ê²½ 500m ë‚´ ${b.kw} ì—…ì†Œ í˜„í™©ì„ ì§€ë„ì—ì„œ í™•ì¸í•˜ì„¸ìš”. ë™ì¢…ì—…ì†Œ 5ê³³ ì´ìƒ ì‹œ ê³¼ë°€ ì£¼ì˜.` },
    { icon:'âš ï¸', title:`ì´ˆê¸° íˆ¬ì ${b.cm.toLocaleString()}ë§Œì›~`, desc:`ì¸í…Œë¦¬ì–´(í‰ë‹¹ ${b.pc}ë§Œì›) + ë³´ì¦ê¸ˆ + ê¶Œë¦¬ê¸ˆ í•©ì‚°. ìˆ˜ìµë¶„ì„ íƒ­ì—ì„œ ì •ë°€ ê³„ì‚°í•˜ì„¸ìš”.` },
    { icon:'ğŸ”¶', title:`ë³€ë™ë¹„ìœ¨ ${Math.round(b.vc*100)}% â€” ì›ê°€ ê´€ë¦¬ ì¤‘ìš”`, desc:`ì¬ë£Œë¹„Â·ìˆ˜ìˆ˜ë£Œ ë“± ë³€ë™ë¹„ê°€ ë§¤ì¶œì˜ ${Math.round(b.vc*100)}%ë¥¼ ì°¨ì§€. ì›ê°€ìœ¨ ì ˆê°ì´ í•µì‹¬.` },
  ];
  return risks.map(r => `
    <div class="risk-item">
      <span class="risk-icon">${r.icon}</span>
      <div class="risk-body">
        <div class="risk-title">${r.title}</div>
        <div class="risk-desc">${r.desc}</div>
      </div>
    </div>`).join('');
}

function buildHourChart(b) {
  const ctx = document.getElementById('hourChart');
  if (!ctx) return;
  if (state.hourChart) { state.hourChart.destroy(); state.hourChart = null; }
  const hours = Array.from({length:24}, (_,i) => i);
  const data = hours.map(h => b.pk.includes(h) ? Math.round(60 + Math.random()*35) : Math.round(8 + Math.random()*20));
  state.hourChart = new Chart(ctx, {
    type: 'bar',
    data: { labels: hours.map(h => h+'ì‹œ'), datasets: [{ data, backgroundColor: hours.map(h => b.pk.includes(h) ? 'rgba(37,99,235,.75)' : 'rgba(148,163,184,.3)'), borderRadius: 3 }] },
    options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } }, scales:{ x:{ ticks:{ font:{size:9}, color:'#94a3b8' }, grid:{ display:false } }, y:{ ticks:{ font:{size:9}, color:'#94a3b8' }, grid:{ color:'rgba(0,0,0,.05)' } } } }
  });
}

function buildDayChart(b) {
  const ctx = document.getElementById('dayChart');
  if (!ctx) return;
  if (state.dayChart) { state.dayChart.destroy(); state.dayChart = null; }
  const days = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
  const isWeekendBiz = ['ìˆ ì§‘','ë…¸ë˜ë°©','PCë°©','ë‹¹êµ¬ì¥','ìŠ¤í¬ë¦°ê³¨í”„','ë°©íƒˆì¶œ','ë³´ë“œê²Œì„','ê³ ê¹ƒì§‘','íšŸì§‘'].includes(state.bizKey);
  const base = [70,72,73,74,82,95,88];
  const data = isWeekendBiz ? [55,58,60,62,78,100,90] : base.map(v => Math.round(v + Math.random()*8 - 4));
  state.dayChart = new Chart(ctx, {
    type: 'line',
    data: { labels: days, datasets: [{ data, borderColor:'rgba(13,148,136,.8)', backgroundColor:'rgba(13,148,136,.1)', tension:.4, fill:true, pointBackgroundColor:'rgba(13,148,136,.9)', pointRadius:3 }] },
    options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } }, scales:{ x:{ ticks:{ font:{size:10}, color:'#94a3b8' }, grid:{ display:false } }, y:{ ticks:{ font:{size:9}, color:'#94a3b8' }, grid:{ color:'rgba(0,0,0,.05)' } } } }
  });
}

// ============================================================
// TAB: ìˆ˜ìµë¶„ì„
// ============================================================
function renderProfit() {
  const b = state.biz;
  document.getElementById('tab-profit').innerHTML = `
  <div class="sec-card">
    <div class="sec-title">ğŸ’° ì´ˆê¸° íˆ¬ì ê³„íš</div>
    <button class="autofill-btn" onclick="autofillProfit()">âœ¨ ì—…ì¢… í‰ê· ê°’ ìë™ ì…ë ¥</button>
    <div class="profit-grid">
      <div class="input-group">
        <div class="input-label">ë³´ì¦ê¸ˆ (ë§Œì›)</div>
        <input class="input-field" id="p-deposit" type="number" placeholder="0" oninput="calcProfit()">
        <div class="input-unit">ì „ì„¸ ë³´ì¦ê¸ˆ ë˜ëŠ” ì„ëŒ€ ë³´ì¦ê¸ˆ</div>
      </div>
      <div class="input-group">
        <div class="input-label">ê¶Œë¦¬ê¸ˆ (ë§Œì›)</div>
        <input class="input-field" id="p-key" type="number" placeholder="0" oninput="calcProfit()">
        <div class="input-unit">ìƒê°€ ê¶Œë¦¬ê¸ˆ (ì—†ìœ¼ë©´ 0)</div>
      </div>
      <div class="input-group">
        <div class="input-label">ë©´ì  (í‰)</div>
        <input class="input-field" id="p-pyung" type="number" placeholder="${b.bp}" oninput="calcProfit()">
        <div class="input-unit">ì¸í…Œë¦¬ì–´: í‰ë‹¹ ì•½ ${b.pc}ë§Œì›</div>
      </div>
      <div class="input-group">
        <div class="input-label">ì›” ì„ëŒ€ë£Œ (ë§Œì›)</div>
        <input class="input-field" id="p-rent" type="number" placeholder="0" oninput="calcProfit()">
        <div class="input-unit">ê´€ë¦¬ë¹„ ë³„ë„</div>
      </div>
    </div>
  </div>
  <div class="sec-card">
    <div class="sec-title">ğŸ“Š ì›”ë³„ ìˆ˜ìµ êµ¬ì¡°</div>
    <div class="profit-grid">
      <div class="input-group">
        <div class="input-label">ì›” ì˜ˆìƒ ë§¤ì¶œ (ë§Œì›)</div>
        <input class="input-field" id="p-rev" type="number" value="${b.rb}" oninput="calcProfit()">
        <div class="input-unit">ë¹„ê´€ ${b.rp}ë§Œ / ë‚™ê´€ ${b.ro}ë§Œ</div>
      </div>
      <div class="input-group">
        <div class="input-label">ì¸ê±´ë¹„ (ë§Œì›)</div>
        <input class="input-field" id="p-labor" type="number" value="${b.lb}" oninput="calcProfit()">
        <div class="input-unit">ë³¸ì¸ ì¸ê±´ë¹„ ì œì™¸</div>
      </div>
      <div class="input-group">
        <div class="input-label">ê´€ë¦¬ë¹„Â·ê³µê³¼ê¸ˆ (ë§Œì›)</div>
        <input class="input-field" id="p-util" type="number" value="50" oninput="calcProfit()">
      </div>
      <div class="input-group">
        <div class="input-label">ê¸°íƒ€ ê³ ì •ë¹„ (ë§Œì›)</div>
        <input class="input-field" id="p-etc" type="number" value="30" oninput="calcProfit()">
        <div class="input-unit">í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ, ê´‘ê³ ë¹„ ë“±</div>
      </div>
    </div>
  </div>
  <div class="sec-card">
    <div class="sec-title">ğŸ“ˆ ìˆ˜ìµì„± ë¶„ì„ ê²°ê³¼</div>
    <div class="result-grid" id="profitResults">
      <div class="result-box"><div class="result-val">â€”</div><div class="result-label">ì´ íˆ¬ìì•¡</div></div>
      <div class="result-box"><div class="result-val">â€”</div><div class="result-label">ì›” ê³ ì •ë¹„</div></div>
      <div class="result-box highlight"><div class="result-val">â€”</div><div class="result-label">ì›” ìˆœì´ìµ</div></div>
      <div class="result-box highlight"><div class="result-val">â€”</div><div class="result-label">ì—°ê°„ ROI</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px">
      <div class="result-box"><div class="result-val" id="res-bep">â€”</div><div class="result-label">BEP ë‹¬ì„± ì›”</div></div>
      <div class="result-box"><div class="result-val" id="res-risk">â€”</div><div class="result-label">ìœ„í—˜ë„ ì ìˆ˜</div></div>
    </div>
    <div id="riskBars"></div>
  </div>`;
}

function autofillProfit() {
  const b = state.biz;
  const deposit = Math.round(b.cm * 0.25 / 100) * 100;
  const pyung = b.bp;
  const rent = Math.round(b.mc * 0.35 / 10) * 10;
  const key = 0;
  document.getElementById('p-deposit').value = deposit;
  document.getElementById('p-key').value = key;
  document.getElementById('p-pyung').value = pyung;
  document.getElementById('p-rent').value = rent;
  document.getElementById('p-rev').value = b.rb;
  document.getElementById('p-labor').value = b.lb;
  document.getElementById('p-util').value = 50;
  document.getElementById('p-etc').value = 30;
  calcProfit();
  showToast('âœ¨ ì—…ì¢… í‰ê· ê°’ìœ¼ë¡œ ìë™ ì…ë ¥í–ˆìŠµë‹ˆë‹¤');
}

function calcProfit() {
  const v = id => parseFloat(document.getElementById(id)?.value) || 0;
  const b = state.biz;
  const deposit = v('p-deposit'), key = v('p-key'), pyung = v('p-pyung');
  const rent = v('p-rent'), rev = v('p-rev'), labor = v('p-labor');
  const util = v('p-util'), etc = v('p-etc');

  const interior = pyung * b.pc;
  const totalInvest = deposit + key + interior;
  const fixedCost = rent + labor + util + etc;
  const varCost = rev * b.vc;
  const netMonthly = rev - varCost - fixedCost;
  const roi = totalInvest > 0 ? (netMonthly * 12 / totalInvest * 100) : 0;
  const bep = netMonthly > 0 && totalInvest > 0 ? Math.ceil(totalInvest / netMonthly) : null;

  // Risk score
  const sameCount = state.compMarkers.length || 5;
  const compRisk = Math.min(30, sameCount * 3);
  const rentRatio = rev > 0 ? rent / rev : 0;
  const rentRisk = rentRatio > 0.25 ? 25 : rentRatio > 0.15 ? 14 : 6;
  const marginRisk = netMonthly < 100 ? 25 : netMonthly < 200 ? 14 : 5;
  const regRisk = state.bizKey === 'ë…¸ë˜ë°©' || state.bizKey === 'PCë°©' || state.bizKey === 'ë¯¸ìš©ì‹¤' ? 15 : 8;
  const totalRisk = compRisk + rentRisk + marginRisk + regRisk;
  const riskColor = totalRisk >= 56 ? 'red' : totalRisk >= 31 ? 'yellow' : 'green';
  const riskLabel = totalRisk >= 56 ? 'ğŸ”´ ìœ„í—˜' : totalRisk >= 31 ? 'ğŸŸ¡ ì£¼ì˜' : 'ğŸŸ¢ ì–‘í˜¸';

  const fmt = n => n > 0 ? n.toLocaleString() + 'ë§Œ' : n < 0 ? '-' + Math.abs(n).toLocaleString() + 'ë§Œ' : '0ë§Œ';
  const boxes = document.querySelectorAll('#profitResults .result-box');
  if (boxes.length >= 4) {
    boxes[0].querySelector('.result-val').textContent = totalInvest ? fmt(totalInvest) : 'â€”';
    boxes[1].querySelector('.result-val').textContent = fixedCost ? fmt(fixedCost) : 'â€”';
    boxes[2].querySelector('.result-val').textContent = rev ? fmt(Math.round(netMonthly)) : 'â€”';
    boxes[2].querySelector('.result-val').style.color = netMonthly < 0 ? 'var(--red)' : netMonthly < 100 ? 'var(--yellow)' : 'var(--green)';
    boxes[3].querySelector('.result-val').textContent = roi ? roi.toFixed(1) + '%' : 'â€”';
    boxes[3].querySelector('.result-val').style.color = roi < 0 ? 'var(--red)' : roi < 10 ? 'var(--yellow)' : 'var(--blue)';
  }
  const bepEl = document.getElementById('res-bep');
  if (bepEl) bepEl.textContent = bep ? bep + 'ê°œì›”' : bep === null ? 'âˆ' : 'â€”';
  const riskEl = document.getElementById('res-risk');
  if (riskEl) { riskEl.textContent = totalRisk + 'ì  ' + riskLabel; riskEl.className = 'result-val risk-score-val ' + riskColor; }

  const barsEl = document.getElementById('riskBars');
  if (barsEl) {
    barsEl.innerHTML = [
      { label:'ê²½ìŸ ìœ„í—˜', val: compRisk, max:30, color:'#dc2626' },
      { label:'ì„ëŒ€ ë¶€ë‹´', val: rentRisk, max:25, color:'#f59e0b' },
      { label:'ë§ˆì§„ ìœ„í—˜', val: marginRisk, max:25, color:'#f59e0b' },
      { label:'ê·œì œ ìœ„í—˜', val: regRisk, max:20, color:'#7c3aed' },
    ].map(item => `
      <div class="risk-bar-wrap">
        <div class="risk-bar-label"><span>${item.label}</span><span>${item.val}/${item.max}</span></div>
        <div class="risk-bar-track"><div class="risk-bar-fill" style="width:${(item.val/item.max*100).toFixed(0)}%;background:${item.color}"></div></div>
      </div>`).join('');
  }

  // AIìš”ì•½ íƒ­ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ ê³„ì‚° ê²°ê³¼ ì €ì¥
  state.profitCalc = {
    roi, bep, riskScore: totalRisk,
    competitionScore: Math.round(100 - compRisk / 30 * 100),
    closeRate: state.apiResult?.sales?.closeRate || null,
    survivalRate: state.apiResult?.trend?.survivalRate || null,
    regulationGrade: state.apiResult?.analysis?.regulationGrade || 'í™•ì¸í•„ìš”'
  };
}

// ============================================================
// TAB: AI ìš”ì•½
// ============================================================
function renderAI() {
  const el = document.getElementById('tab-ai');
  el.innerHTML = `
  <div class="ai-badge">ğŸ¤– Mock AI Â· ì‹¤ì œ LLM ì—°ê²° ì˜ˆì •</div>
  <button class="ai-btn" onclick="generateAI()">AI ì°½ì—… ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±</button>
  <div id="aiOutput" class="ai-summary" style="display:none"></div>`;
}

async function generateAI() {
  const b = state.biz; const area = state.area;
  const el = document.getElementById('aiOutput');
  el.style.display = 'block';
  el.innerHTML = '<div style="display:flex;align-items:center;gap:10px;padding:16px;color:#64748b"><div class="loading-spin"></div><span>AI ë¶„ì„ ìƒì„± ì¤‘...</span></div>';

  const pc = state.profitCalc || {};
  const payload = {
    bizType: state.bizKey,
    areaName: area,
    riskScore: pc.riskScore ?? null,
    roi: pc.roi ?? null,
    bep: pc.bep ?? null,
    competitionScore: pc.competitionScore ?? null,
    regulationGrade: pc.regulationGrade ?? 'í™•ì¸í•„ìš”',
    closeRate: pc.closeRate ?? null,
    survivalRate: pc.survivalRate ?? null
  };

  let data = null;
  try {
    const res = await fetch('/api/ai-summary', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (res.ok) data = await res.json();
  } catch (e) { /* fallback to local mock */ }

  if (data) {
    const riskHtml = (data.risks || []).map(r => {
      const color = r.level === 'high' ? '#dc2626' : r.level === 'mid' ? '#f59e0b' : '#16a34a';
      const icon  = r.level === 'high' ? 'ğŸ”´' : r.level === 'mid' ? 'ğŸŸ¡' : 'ğŸŸ¢';
      return `<li><span style="color:${color}">${icon} <strong>${r.title}</strong></span> â€” ${r.desc}</li>`;
    }).join('');
    const stratHtml = (data.strategies || []).map(s =>
      `<li><strong>${s.title}</strong><br><span style="color:#64748b">${s.desc}</span></li>`
    ).join('');
    const summaryMd = (data.summary || '').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    el.innerHTML = `
    <h3>ğŸ“ ${area} Ã— ${state.bizKey} AI ë¶„ì„</h3>
    <p>${summaryMd}</p>
    <h3>âš ï¸ ì£¼ìš” ë¦¬ìŠ¤í¬</h3><ul>${riskHtml}</ul>
    <h3>ğŸ’¡ ì¶”ì²œ ì „ëµ</h3><ul>${stratHtml}</ul>
    <h3>ğŸ“‹ ì¦‰ì‹œ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
    <ul>
      <li>â˜ ìƒê¶Œ ë‚´ ë™ì¢…ì—…ì†Œ 3~5ê³³ ì§ì ‘ ë°©ë¬¸ (ê°€ê²©Â·ì„œë¹„ìŠ¤Â·ê³ ê°ì¸µ ë¶„ì„)</li>
      <li>â˜ ì†Œìƒê³µì¸ ì •ì±…ìê¸ˆ ì‹ ì²­ (ì†Œìƒê³µì¸ì§„í¥ê³µë‹¨, ì‹œì¤‘ì€í–‰ íŠ¹ë³„ë³´ì¦)</li>
      <li>â˜ í–‰ì •ê°€ì´ë“œ íƒ­ì—ì„œ ì¸í—ˆê°€ ìš”ê±´ í™•ì¸</li>
      <li>â˜ ì¤‘ê°œì‚¬ íƒ­ì—ì„œ ì í•© ë§¤ë¬¼ ìƒë‹´</li>
    </ul>
    <p style="font-size:11px;color:#94a3b8;margin-top:12px">â€» ${data.note || 'ë³¸ ë¦¬í¬íŠ¸ëŠ” ê³µê³µ ë°ì´í„° ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.'}</p>`;
    return;
  }

  // â”€â”€ Local fallback (API ì—°ê²° ì „) â”€â”€
  const margin = Math.round((1 - b.vc) * 100);
  const netEst = Math.round(b.rb * (1 - b.vc) - b.mc);
  el.innerHTML = `
  <h3>ğŸ“ ${area} Ã— ${b.nm || state.bizKey} ì°½ì—… AI ë¶„ì„</h3>
  <p><strong>${area}</strong>ëŠ” ${state.bizKey} ì°½ì—…ì— <strong>${netEst > 150 ? 'ì í•©í•œ' : netEst > 50 ? 'ë³´í†µ ìˆ˜ì¤€ì˜' : 'ì‹ ì¤‘í•œ ê²€í† ê°€ í•„ìš”í•œ'}</strong> ìƒê¶Œì…ë‹ˆë‹¤.</p>
  <h3>ğŸ’¡ í•µì‹¬ ê¸°íšŒ ìš”ì¸</h3>
  <ul>
    <li>ë§ˆì§„ìœ¨ <strong>${margin}%</strong>ë¡œ ${margin >= 60 ? 'ì—…ê³„ ìƒìœ„ê¶Œ ìˆ˜ì¤€' : margin >= 40 ? 'ì—…ê³„ í‰ê·  ìˆ˜ì¤€' : 'ì›ê°€ ê´€ë¦¬ê°€ í•µì‹¬ ê³¼ì œ'}</li>
    <li>ì›” ê¸°ì¤€ ë§¤ì¶œ <strong>${b.rb.toLocaleString()}ë§Œì›</strong> ë‹¬ì„± ì‹œ ìˆœì´ìµ ì•½ <strong>${netEst.toLocaleString()}ë§Œì›</strong> ì˜ˆìƒ</li>
    <li>í”¼í¬ ì‹œê°„ëŒ€(${b.pk.slice(0,3).map(h=>h+'ì‹œ').join(', ')} ì™¸) ë§¤ì¶œ ë³´ì™„ ì „ëµ ë§ˆë ¨ ì‹œ ì¶”ê°€ ìˆ˜ìµ ê°€ëŠ¥</li>
  </ul>
  <h3>âš ï¸ ì£¼ìš” ë¦¬ìŠ¤í¬ & ëŒ€ì‘</h3>
  <ul>
    <li><strong>ê²½ìŸ ê³¼ë°€:</strong> ì§€ë„ íƒ­ì—ì„œ ë°˜ê²½ 500m ë™ì¢…ì—…ì†Œ í™•ì¸ â†’ ì°¨ë³„í™” í•„ìˆ˜</li>
    <li><strong>ì´ˆê¸°ë¹„ìš©:</strong> ìµœì†Œ ${b.cm.toLocaleString()}ë§Œì›~ í™•ë³´ í•„ìš”. ì†Œìƒê³µì¸ ì •ì±…ìê¸ˆ í™œìš© ê²€í† </li>
    <li><strong>ë³€ë™ë¹„ ${Math.round(b.vc*100)}%:</strong> ë§¤ì¶œ í•˜ë½ ì‹œ ê³ ì •ë¹„ ë¶€ë‹´ ê¸‰ì¦ ì£¼ì˜</li>
  </ul>
  <h3>ğŸ“‹ ì¦‰ì‹œ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
  <ul>
    <li>â˜ ìƒê¶Œ ë‚´ ë™ì¢…ì—…ì†Œ 3~5ê³³ ì§ì ‘ ë°©ë¬¸</li>
    <li>â˜ ì†Œìƒê³µì¸ ì •ì±…ìê¸ˆ ì‹ ì²­</li>
    <li>â˜ í–‰ì •ê°€ì´ë“œ íƒ­ì—ì„œ ì¸í—ˆê°€ ìš”ê±´ í™•ì¸</li>
    <li>â˜ ì¤‘ê°œì‚¬ íƒ­ì—ì„œ ì í•© ë§¤ë¬¼ ìƒë‹´</li>
  </ul>
  <p style="font-size:11px;color:#94a3b8;margin-top:12px">â€» ë³¸ ë¦¬í¬íŠ¸ëŠ” ê³µê³µ ë°ì´í„° ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.</p>`;
}

// ============================================================
// TAB: í–‰ì •ê°€ì´ë“œ
// ============================================================
const ADMIN_GUIDES = {
  food:    { law: 'ì‹í’ˆìœ„ìƒë²• ì œ36Â·37ì¡°', license: 'ìŒì‹ì  ì˜ì—…í—ˆê°€/ì‹ ê³ ', steps: ['ìŒì‹ì  ìœ í˜• í™•ì¸ (ì¼ë°˜/íœ´ê²Œ)', 'ìœ„ìƒêµìœ¡ ì´ìˆ˜ (6ì‹œê°„)', 'ì˜ì—…í—ˆê°€ ë˜ëŠ” ì‹ ê³  ì‹ ì²­', 'ìœ„ìƒÂ·ì†Œë°© í˜„ì¥ì ê²€', 'ì˜ì—… ê°œì‹œ'] },
  retail:  { law: 'ìœ í†µì‚°ì—…ë°œì „ë²• / ê°€ë§¹ì‚¬ì—…ë²•', license: 'ì˜ì—…ì‹ ê³  ë˜ëŠ” ê°€ë§¹ê³„ì•½', steps: ['ì—…ì¢…ë³„ ì¸í—ˆê°€ í™•ì¸', 'ê°€ë§¹ ê³„ì•½ ì‹œ ì •ë³´ê³µê°œì„œ 14ì¼ ì—´ëŒ', 'ì‚¬ì—…ìë“±ë¡ ì‹ ì²­', 'ì‹œì„¤ ê¸°ì¤€ í™•ì¸', 'ì˜ì—… ê°œì‹œ'] },
  beauty:  { law: 'ê³µì¤‘ìœ„ìƒê´€ë¦¬ë²• ì œ2Â·6ì¡°', license: 'ë¯¸ìš©ì—… ì˜ì—…ì‹ ê³ ', steps: ['ë¯¸ìš©ì‚¬ ë©´í—ˆ ì·¨ë“ í™•ì¸ (í•„ìˆ˜)', 'ìœ„ìƒêµìœ¡ ì´ìˆ˜ (3ì‹œê°„)', 'ë¯¸ìš©ì—… ì˜ì—…ì‹ ê³ ', 'ì‹œì„¤ ê¸°ì¤€ í™•ì¸ (í™˜ê¸° ë“±)', 'ì˜ì—… ê°œì‹œ'] },
  health:  { law: 'êµ­ë¯¼ì²´ìœ¡ì§„í¥ë²• / ì²´ìœ¡ì‹œì„¤ë²•', license: 'ì²´ìœ¡ì‹œì„¤ì—… ì‹ ê³ ', steps: ['ì‹œì„¤ ìœ í˜•ë³„ ì‹ ê³  ìš”ê±´ í™•ì¸', 'ë©´ì Â·ì‹œì„¤ ê¸°ì¤€ ì¶©ì¡±', 'ì²´ìœ¡ì‹œì„¤ì—… ì‹ ê³ ', 'ì†Œë°©Â·ì•ˆì „ ì ê²€', 'ì˜ì—… ê°œì‹œ'] },
  edu:     { law: 'í•™ì›ì˜ ì„¤ë¦½Â·ìš´ì˜ ë° ê³¼ì™¸êµìŠµì— ê´€í•œ ë²•ë¥ ', license: 'í•™ì› ì„¤ë¦½Â·ìš´ì˜ ë“±ë¡', steps: ['í•™ì› ì„¤ë¦½ ì‹ ì²­ (êµìœ¡ì²­)', 'ê°•ì‚¬ ìê²©ì¦ í™•ì¸', 'ì‹œì„¤ ê¸°ì¤€ ì¶©ì¡±', 'ì†Œë°©Â·ì•ˆì „ ì ê²€', 'ê°œì›'] },
  leisure: { law: 'ë‹¤ì¤‘ì´ìš©ì—…ì†Œ ì•ˆì „ê´€ë¦¬ë²•', license: 'ë‹¤ì¤‘ì´ìš©ì—… ì‹ ê³ ', steps: ['ì—…ì¢…ë³„ ì¸í—ˆê°€ í™•ì¸', 'ì†Œë°©ì•ˆì „êµìœ¡ ì´ìˆ˜', 'ë‹¤ì¤‘ì´ìš©ì—… ì‹ ê³ ', 'ì†Œë°©Â·ì•ˆì „ í˜„ì¥ì ê²€', 'ì˜ì—… ê°œì‹œ'] },
  service: { law: 'ê´€ë ¨ ê°œë³„ ë²•ë ¹', license: 'ì‚¬ì—…ìë“±ë¡ + ê°œë³„ ì‹ ê³ ', steps: ['ì—…ì¢…ë³„ ì¸í—ˆê°€ í™•ì¸', 'ì‚¬ì—…ìë“±ë¡', 'ê´€ë ¨ ì‹ ê³ Â·í—ˆê°€ ì·¨ë“', 'ì‹œì„¤ ê¸°ì¤€ í™•ì¸', 'ì˜ì—… ê°œì‹œ'] },
};

function renderAdmin() {
  const cat = state.biz?.cat || 'food';
  const guide = ADMIN_GUIDES[cat] || ADMIN_GUIDES.food;
  const numColors = ['done','done','todo','todo','warn'];
  document.getElementById('tab-admin').innerHTML = `
  <div class="sec-card">
    <div class="sec-title">ğŸ“‹ ì¸í—ˆê°€ ê°œìš”</div>
    <div style="background:var(--blue-bg);border:1px solid var(--blue-light);border-radius:var(--r);padding:10px 12px;margin-bottom:10px;font-size:12px">
      <div style="font-weight:700;color:var(--blue);margin-bottom:3px">ğŸ“Œ í•µì‹¬ ì¸í—ˆê°€</div>
      <div style="color:var(--text2)">${guide.license}</div>
      <div style="font-size:11px;color:var(--muted);margin-top:3px">ê·¼ê±°: ${guide.law}</div>
    </div>
  </div>
  <div class="sec-card">
    <div class="sec-title">ğŸ—º ì°½ì—… ì ˆì°¨ íë¦„ë„</div>
    ${guide.steps.map((step, i) => `
    <div class="flow-step">
      <div class="flow-num ${numColors[i]}">${i+1}</div>
      <div class="flow-body">
        <div class="flow-title">${step}</div>
        <div class="flow-desc">${getStepDesc(step, cat)}</div>
      </div>
    </div>`).join('')}
  </div>
  <div class="sec-card">
    <div class="sec-title">ğŸ”‘ í—ˆê°€Â·ì‹ ê³  ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
    <div class="permit-grid">${getPermitItems(cat)}</div>
  </div>
  <div class="sec-card">
    <div class="sec-title">ğŸ¦ í™œìš© ê°€ëŠ¥í•œ ì •ì±…ìê¸ˆ</div>
    ${getPolicyFunds()}
  </div>`;
}

function getStepDesc(step, cat) {
  const descs = {
    'ìŒì‹ì  ìœ í˜• í™•ì¸ (ì¼ë°˜/íœ´ê²Œ)': 'ì¼ë°˜ìŒì‹ì ì€ í—ˆê°€, íœ´ê²ŒìŒì‹ì ì€ ì‹ ê³ . ì£¼ë¥˜ íŒë§¤ ì—¬ë¶€ë¡œ êµ¬ë¶„.',
    'ìœ„ìƒêµìœ¡ ì´ìˆ˜ (6ì‹œê°„)': 'í•œêµ­ì‹í’ˆì‚°ì—…í˜‘íšŒ ë˜ëŠ” ì‹í’ˆìœ„ìƒêµìœ¡ì›. ì˜ì—…ì‹ ê³  ì „ í•„ìˆ˜.',
    'ì˜ì—…í—ˆê°€ ë˜ëŠ” ì‹ ê³  ì‹ ì²­': 'ê´€í•  ì‹œÂ·êµ°Â·êµ¬ì²­ ìœ„ìƒê³¼ ë°©ë¬¸ ë˜ëŠ” ì •ë¶€24 ì˜¨ë¼ì¸ ì‹ ì²­ ê°€ëŠ¥.',
    'ìœ„ìƒÂ·ì†Œë°© í˜„ì¥ì ê²€': 'ê´€í•  ë‹´ë‹¹ìê°€ ì‹œì„¤ ê¸°ì¤€ í˜„ì¥ í™•ì¸. ë¯¸ë¹„ ì‹œ ì‹œì • ì§€ì‹œ.',
    'ì˜ì—… ê°œì‹œ': 'í—ˆê°€ì¦ ê²Œì‹œ í›„ ì˜ì—… ê°€ëŠ¥. ì´í›„ ì •ê¸° ìœ„ìƒì ê²€ ëŒ€ë¹„.',
  };
  return descs[step] || 'ê´€í•  ë‹´ë‹¹ ê¸°ê´€ì— ì‚¬ì „ ë¬¸ì˜ ê¶Œì¥.';
}

function getPermitItems(cat) {
  const items = {
    food:    [['ğŸ“‹','ì˜ì—…í—ˆê°€','pass'],['ğŸ½ï¸','ìœ„ìƒê¸°ì¤€','pass'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','warn'],['ğŸ’¨','í™˜ê¸°ì„¤ë¹„','warn'],['ğŸš—','ì£¼ì°¨ì¥','warn'],['ğŸ“','ê±´ì¶•ê¸°ì¤€','pass']],
    retail:  [['ğŸ“‹','ì˜ì—…ì‹ ê³ ','pass'],['ğŸª','ì‹œì„¤ê¸°ì¤€','pass'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','pass'],['ğŸ“œ','ê°€ë§¹ê³„ì•½','warn'],['ğŸš—','ì£¼ì°¨ì¥','pass'],['ğŸ“','ê±´ì¶•ê¸°ì¤€','pass']],
    beauty:  [['ğŸ“','ë©´í—ˆì¦','warn'],['ğŸ“‹','ì˜ì—…ì‹ ê³ ','pass'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','pass'],['ğŸš¿','ìœ„ìƒì„¤ë¹„','pass'],['ğŸ“š','ìœ„ìƒêµìœ¡','warn'],['ğŸ“','ê±´ì¶•ê¸°ì¤€','pass']],
    health:  [['ğŸ“‹','ì‹œì„¤ì‹ ê³ ','warn'],['ğŸ‹ï¸','ê¸°êµ¬ê¸°ì¤€','warn'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','warn'],['ğŸš¿','íƒˆì˜ì‹¤','warn'],['ğŸš—','ì£¼ì°¨ì¥','warn'],['ğŸ“','ìê²©ì¦','warn']],
    edu:     [['ğŸ“‹','ì„¤ë¦½ë“±ë¡','warn'],['ğŸ“','ê°•ì‚¬ìê²©','warn'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','pass'],['ğŸ“','ë©´ì ê¸°ì¤€','warn'],['ğŸ‘¶','ì•„ë™ì•ˆì „','warn'],['ğŸ“š','êµìŠµê³¼ëª©','pass']],
    leisure: [['ğŸ“‹','ë‹¤ì¤‘ì´ìš©ì—…','warn'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','warn'],['ğŸšª','ë¹„ìƒêµ¬','warn'],['ğŸ”‡','ë°©ìŒê¸°ì¤€','warn'],['ğŸ‘¶','ì²­ì†Œë…„','warn'],['ğŸ“','ìš©ë„í™•ì¸','warn']],
    service: [['ğŸ“‹','ì‚¬ì—…ìë“±ë¡','pass'],['ğŸª','ì‹œì„¤ê¸°ì¤€','pass'],['ğŸ”¥','ì†Œë°©ì‹œì„¤','pass'],['ğŸ“','ìš©ë„ì§€ì—­','pass'],['ğŸ’Š','ê´€ë ¨í—ˆê°€','warn'],['ğŸš—','ì£¼ì°¨ì¥','pass']],
  };
  return (items[cat] || items.food).map(([icon, label, status]) => `
    <div class="permit-item">
      <div class="permit-icon">${icon}</div>
      <div style="font-size:11px;color:var(--text2);font-weight:600">${label}</div>
      <div class="permit-status ${status}">${status==='pass'?'âœ… ê°€ëŠ¥':status==='warn'?'âš ï¸ í™•ì¸':'âŒ ë¶ˆê°€'}</div>
    </div>`).join('');
}

function getPolicyFunds() {
  const funds = [
    { name: 'ì†Œìƒê³µì¸ ì •ì±…ìê¸ˆ', org: 'ì†Œìƒê³µì¸ì§„í¥ê³µë‹¨', rate: 'ì—° 2.0~3.5%', limit: 'ìµœëŒ€ 7,000ë§Œì›', tip: 'ì°½ì—… ì´ˆê¸° ìš´ì „ìê¸ˆ' },
    { name: 'ì²­ë…„ ì°½ì—… íŠ¹ë³„ë³´ì¦', org: 'ì‹ ìš©ë³´ì¦ê¸°ê¸ˆ', rate: 'ë³´ì¦ë£Œ 0.5~1%', limit: 'ìµœëŒ€ 1ì–µì›', tip: 'ë§Œ 39ì„¸ ì´í•˜ ìš°ëŒ€' },
    { name: 'ì§€ì—­ ì‹ ìš©ë³´ì¦', org: 'ì§€ì—­ì‹ ìš©ë³´ì¦ì¬ë‹¨', rate: 'ì‹œì¤‘ê¸ˆë¦¬', limit: 'ìµœëŒ€ 5,000ë§Œì›', tip: 'ì§€ì—­ë³„ ìƒì´' },
  ];
  return funds.map(f => `
    <div style="border-top:1px solid var(--border);padding:8px 0;display:flex;gap:10px;align-items:flex-start">
      <div style="background:var(--blue-bg);border-radius:6px;padding:5px 8px;font-size:11px;font-weight:700;color:var(--blue);white-space:nowrap">${f.name}</div>
      <div>
        <div style="font-size:12px;font-weight:700;color:var(--text)">${f.org}</div>
        <div style="font-size:11px;color:var(--muted)">${f.rate} Â· ${f.limit} Â· ${f.tip}</div>
      </div>
    </div>`).join('');
}

// ============================================================
// TAB: ì¤‘ê°œì‚¬
// ============================================================
function renderBroker() {
  const el = document.getElementById('tab-broker');
  el.innerHTML = '<div class="loading-spin"></div>';
  if (typeof kakao === 'undefined' || !kakao.maps) {
    el.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ¢</div>
      <div style="font-weight:700;margin-bottom:4px">ì¤‘ê°œì‚¬ ê²€ìƒ‰ì€ ë°°í¬ í™˜ê²½ì—ì„œ í™œì„±í™”ë©ë‹ˆë‹¤</div>
      <div style="font-size:11px">Kakao Maps API ë¡œë“œ í•„ìš”</div></div>
      <div class="sec-card" style="margin-top:12px">
        <div class="sec-title">ğŸ”‘ ê³„ì•½ ì „ í•„ìˆ˜ í™•ì¸ì‚¬í•­</div>
        <div style="font-size:12px;color:var(--text2);line-height:1.8">
          â€¢ ìš©ë„ì§€ì—­ ì í•© ì—¬ë¶€ (LURIS í† ì§€ì´ìš©ê·œì œì •ë³´ ì¡°íšŒ)<br>
          â€¢ ê±´ë¬¼ ê±´ì¶•ë¬¼ëŒ€ì¥ Â· ë“±ê¸°ë¶€ë“±ë³¸ ì—´ëŒ<br>
          â€¢ ì¸ê·¼ ë™ì¢…ì—…ì†Œ í˜„í™© ë° ìƒê¶Œ ë¶„ì„<br>
          â€¢ ì„ëŒ€ì°¨ ê³„ì•½ì„œ ë²•ë¬´ì‚¬ ê²€í†  ê°•ë ¥ ê¶Œì¥
        </div>
      </div>`;
    return;
  }
  if (!state.kakaoMap) { el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“</div>ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</div>'; return; }
  const ps = new kakao.maps.services.Places();
  ps.keywordSearch('ë¶€ë™ì‚°', function(data, status) {
    if (status !== kakao.maps.services.Status.OK || !data || !data.length) {
      el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ¢</div>ì£¼ë³€ ì¤‘ê°œì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
      return;
    }
    el.innerHTML = `
    <div class="sec-card">
      <div class="sec-title">ğŸ¢ ì£¼ë³€ ë¶€ë™ì‚° ì¤‘ê°œì‚¬</div>
      ${data.slice(0,8).map(p => {
        const dist = p.distance ? `${p.distance}m` : '';
        return `<div class="broker-card">
          <div class="broker-icon">ğŸ¢</div>
          <div class="broker-body">
            <div class="broker-name">${p.place_name}</div>
            <div class="broker-addr">${p.road_address_name || p.address_name}</div>
            ${dist ? `<div class="broker-dist">ğŸ“ ${dist}</div>` : ''}
          </div>
          ${p.phone ? `<a class="broker-tel" href="tel:${p.phone}">${p.phone}</a>` : ''}
        </div>`;
      }).join('')}
    </div>
    <div class="sec-card">
      <div style="font-size:11px;color:var(--muted);line-height:1.6">
        ğŸ’¡ <strong>ìƒê°€ ê³„ì•½ ì „ í•„ìˆ˜ í™•ì¸ì‚¬í•­</strong><br>
        â€¢ ìš©ë„ì§€ì—­ ì í•© ì—¬ë¶€ (LURIS í† ì§€ì´ìš©ê·œì œì •ë³´ ì¡°íšŒ)<br>
        â€¢ ê±´ë¬¼ ê±´ì¶•ë¬¼ëŒ€ì¥ Â· ë“±ê¸°ë¶€ë“±ë³¸ ì—´ëŒ<br>
        â€¢ ì¸ê·¼ ë™ì¢…ì—…ì†Œ í˜„í™© (ì§€ë„ íƒ­ ì°¸ê³ )<br>
        â€¢ ì„ëŒ€ì°¨ ê³„ì•½ì„œ ë²•ë¬´ì‚¬ ê²€í†  ê¶Œì¥
      </div>
    </div>`;
  }, { location: new kakao.maps.LatLng(state.coords.lat, state.coords.lng), radius: 1000, sort: kakao.maps.services.SortBy.DISTANCE });
}

// ============================================================
// UTILS
// ============================================================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ============================================================
// INIT
// ============================================================
window.addEventListener('load', initLanding);
</script>
</body>
</html>
