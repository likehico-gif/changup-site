<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>창업지도 — 계약 전 보증금 보호 검증기</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c455de3afef5b566b5fb09a4e2e038cd&libraries=services"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://js.tosspayments.com/v1/payment"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --navy: #1b2a4a; --navy-dark: #111d36; --navy-light: #243656;
  --blue: #2563eb; --blue-light: #dbeafe; --blue-bg: #eff6ff;
  --teal: #0d9488; --teal-light: #ccfbf1;
  --red: #dc2626; --red-dark: #991b1b; --red-light: #fef2f2;
  --orange: #ea580c; --orange-light: #fff7ed;
  --green: #16a34a; --green-light: #f0fdf4;
  --yellow: #ca8a04; --yellow-light: #fefce8;
  --bg: #f1f5f9; --surface: #ffffff; --surface2: #f8fafc;
  --border: #e2e8f0; --border2: #cbd5e1;
  --text: #1e293b; --text2: #334155; --muted: #64748b; --light: #94a3b8;
  --r: 8px; --r-lg: 12px; --r-xl: 16px;
  --shadow: 0 1px 3px rgba(0,0,0,0.06); --shadow-md: 0 4px 12px rgba(0,0,0,0.07); --shadow-lg: 0 10px 30px rgba(0,0,0,0.08);
}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',-apple-system,sans-serif;font-size:14px;line-height:1.6;overflow-x:hidden;-webkit-font-smoothing:antialiased}

/* TOP BAR */
.top-bar{background:var(--navy-dark);color:rgba(255,255,255,.5);font-size:11px;padding:0 24px;height:32px;display:flex;align-items:center;justify-content:flex-end;gap:16px}
.top-bar a{color:rgba(255,255,255,.5);text-decoration:none;transition:color .15s}
.top-bar a:hover{color:#fff}
.top-bar-divider{width:1px;height:10px;background:rgba(255,255,255,.15)}

/* NAV */
.nav{background:var(--navy);padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:60px;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.nav-left{display:flex;align-items:center;gap:32px}
.nav-logo{display:flex;align-items:center;gap:10px;text-decoration:none}
.nav-logo-mark{width:36px;height:36px;background:linear-gradient(135deg,var(--blue),#3b82f6);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;box-shadow:0 2px 8px rgba(37,99,235,.3)}
.nav-logo-text{font-size:18px;font-weight:800;color:#fff;letter-spacing:-.3px}
.nav-logo-text em{font-style:normal;color:#93c5fd;font-weight:900}
.nav-menu{display:flex;gap:2px}
.nav-menu-item{font-size:14px;font-weight:600;color:rgba(255,255,255,.65);padding:8px 16px;border-radius:var(--r);text-decoration:none;transition:all .15s;cursor:pointer}
.nav-menu-item:hover{color:#fff;background:rgba(255,255,255,.08)}
.nav-menu-item.active{color:#fff;background:rgba(255,255,255,.12)}
@media(max-width:768px){.nav-menu{display:none}}
.nav-right{display:flex;align-items:center;gap:10px}
.nav-btn{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.15);padding:7px 16px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s}
.nav-btn:hover{background:rgba(255,255,255,.18)}
.nav-btn.primary{background:var(--blue);border-color:var(--blue);box-shadow:0 2px 8px rgba(37,99,235,.3)}
.nav-btn.primary:hover{background:#1d4ed8}

/* ══════════════════════
   v6 HERO — "방패" 포지셔닝
══════════════════════ */
.hero{background:linear-gradient(175deg,#0d1117 0%,#1b2a4a 40%,#1e3a5f 70%,var(--bg) 100%);padding:56px 24px 90px;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 55% 45% at 25% 45%,rgba(220,38,38,.06) 0%,transparent 55%),radial-gradient(ellipse 45% 50% at 75% 55%,rgba(37,99,235,.09) 0%,transparent 55%)}
.hero-inner{max-width:900px;margin:0 auto;position:relative;text-align:center}

/* v6: 위험 신호 뱃지 */
.hero-danger-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(220,38,38,.12);border:1px solid rgba(220,38,38,.3);border-radius:100px;padding:6px 16px;font-size:12px;font-weight:700;color:#f87171;margin-bottom:22px;letter-spacing:.3px}
.hdb-dot{width:7px;height:7px;background:#f87171;border-radius:50%;animation:redPulse 1.5s infinite}
@keyframes redPulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(248,113,113,.4)}50%{opacity:.7;box-shadow:0 0 0 5px rgba(248,113,113,0)}}

.hero h1{font-size:clamp(26px,4.2vw,42px);font-weight:900;color:#fff;line-height:1.25;letter-spacing:-.5px;margin-bottom:16px}
.hero h1 .accent{color:#f87171}
.hero h1 .safe{color:#34d399}

.hero-sub-v6{font-size:15px;color:rgba(255,255,255,.5);line-height:1.9;margin-bottom:10px}
.hero-sub-bold{font-size:14px;font-weight:700;color:rgba(255,255,255,.75);margin-bottom:34px;letter-spacing:.2px}
.hero-sub-bold em{color:#fbbf24;font-style:normal}

/* 검색박스 */
.search-box{background:var(--surface);border-radius:var(--r-xl);padding:8px;box-shadow:0 8px 32px rgba(0,0,0,.25);max-width:720px;margin:0 auto;display:flex;gap:8px}
@media(max-width:600px){.search-box{flex-direction:column}}
.search-field{flex:1;display:flex;align-items:center;background:var(--surface2);border:1.5px solid var(--border);border-radius:var(--r-lg);padding:0 14px;transition:all .2s}
.search-field:focus-within{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1);background:#fff}
.sf-icon{margin-right:10px;font-size:16px;color:var(--light)}
.search-field input{flex:1;border:none;outline:none;background:transparent;padding:14px 0;font-size:14px;font-weight:500;color:var(--text);font-family:inherit}
.search-field input::placeholder{color:var(--light)}
.search-btn{background:var(--red);color:#fff;border:none;padding:14px 28px;border-radius:var(--r-lg);font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;display:flex;align-items:center;gap:6px;box-shadow:0 2px 10px rgba(220,38,38,.35)}
.search-btn:hover{background:#b91c1c;transform:translateY(-1px)}

.search-tags{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-top:14px}
.stag{font-size:12px;padding:5px 12px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.6);border-radius:100px;cursor:pointer;transition:all .15s;font-weight:500}
.stag:hover{background:rgba(255,255,255,.15);color:#fff}
.stag.active{background:var(--red);border-color:var(--red);color:#fff}

/* v6: 신뢰 트리오 */
.trust-trio{display:flex;justify-content:center;gap:20px;margin-top:22px;flex-wrap:wrap}
.trust-item{display:flex;align-items:center;gap:6px;font-size:11px;color:rgba(255,255,255,.35);font-weight:600}
.trust-item span{color:rgba(255,255,255,.5)}

/* STATS BAR */
.stats-bar{max-width:960px;margin:-40px auto 0;position:relative;z-index:10;padding:0 24px}
.stats-bar-inner{background:var(--surface);border-radius:var(--r-xl);box-shadow:var(--shadow-lg);display:grid;grid-template-columns:repeat(4,1fr);border:1px solid var(--border);overflow:hidden}
@media(max-width:600px){.stats-bar-inner{grid-template-columns:repeat(2,1fr)}}
.stat-item{padding:20px 16px;text-align:center;border-right:1px solid var(--border)}
.stat-item:last-child{border-right:none}
@media(max-width:600px){.stat-item:nth-child(2){border-right:none}.stat-item:nth-child(3),.stat-item:nth-child(4){border-top:1px solid var(--border)}}
.stat-num{font-size:24px;font-weight:900;color:var(--navy);line-height:1}
.stat-num span{color:var(--blue);font-size:14px}
.stat-label{font-size:12px;color:var(--muted);margin-top:4px}

/* SERVICES */
.services{max-width:1100px;margin:48px auto 0;padding:0 24px}
.services-title{font-size:20px;font-weight:800;margin-bottom:8px;color:var(--navy)}
.services-sub{font-size:13px;color:var(--muted);margin-bottom:24px}
.service-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
@media(max-width:800px){.service-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:480px){.service-grid{grid-template-columns:1fr}}
.svc-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:28px 20px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.svc-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;transition:background .2s}
.svc-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg)}
.svc-card:hover::before{background:var(--blue)}
.svc-card.c-blue::before{background:var(--blue)}
.svc-card.c-teal::before{background:var(--teal)}
.svc-card.c-orange::before{background:var(--orange)}
.svc-card.c-navy::before{background:var(--navy)}
.svc-icon{width:52px;height:52px;border-radius:var(--r-lg);display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}
.svc-card.c-blue .svc-icon{background:var(--blue-bg)}
.svc-card.c-teal .svc-icon{background:var(--teal-light)}
.svc-card.c-orange .svc-icon{background:var(--orange-light)}
.svc-card.c-navy .svc-icon{background:#e2e8f0}
.svc-name{font-size:16px;font-weight:800;margin-bottom:6px;color:var(--navy)}
.svc-desc{font-size:12px;color:var(--muted);line-height:1.7;margin-bottom:14px}
.svc-tag{display:inline-block;font-size:10px;font-weight:700;padding:3px 8px;border-radius:100px}
.svc-card.c-blue .svc-tag{background:var(--blue-light);color:var(--blue)}
.svc-card.c-teal .svc-tag{background:var(--teal-light);color:var(--teal)}
.svc-card.c-orange .svc-tag{background:var(--orange-light);color:var(--orange)}
.svc-card.c-navy .svc-tag{background:#e2e8f0;color:var(--navy)}
.svc-arrow{position:absolute;bottom:20px;right:20px;width:28px;height:28px;background:var(--surface2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--light);transition:all .2s}
.svc-card:hover .svc-arrow{background:var(--blue);color:#fff}

/* INFO */
.info-section{max-width:1100px;margin:40px auto 0;padding:0 24px}
.info-grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
@media(max-width:700px){.info-grid{grid-template-columns:1fr}}
.info-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:24px}
.info-card-title{font-size:15px;font-weight:800;color:var(--navy);margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}
.info-more{font-size:12px;color:var(--muted);font-weight:600;cursor:pointer}
.info-more:hover{color:var(--blue)}
.notice-list{display:flex;flex-direction:column;gap:0}
.notice-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);font-size:13px;cursor:pointer;transition:color .15s}
.notice-item:last-child{border-bottom:none}
.notice-item:hover{color:var(--blue)}
.notice-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;flex-shrink:0}
.nb-notice{background:var(--blue-light);color:var(--blue)}
.nb-event{background:var(--orange-light);color:var(--orange)}
.nb-update{background:var(--green-light);color:var(--green)}
.notice-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.notice-date{font-size:11px;color:var(--light);flex-shrink:0}
.quick-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.quick-link{display:flex;align-items:center;gap:10px;padding:12px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;text-decoration:none}
.quick-link:hover{border-color:var(--blue);color:var(--blue);background:var(--blue-bg)}
.ql-icon{font-size:18px}

/* HOW */
.how-section{max-width:1100px;margin:48px auto 0;padding:0 24px}
.how-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
@media(max-width:800px){.how-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:480px){.how-grid{grid-template-columns:repeat(2,1fr)}}
.how-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px 12px;text-align:center}
.how-num{width:24px;height:24px;background:var(--navy);color:#fff;border-radius:6px;display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;margin-bottom:10px}
.how-icon{font-size:22px;margin-bottom:6px}
.how-name{font-size:12px;font-weight:700;color:var(--navy);margin-bottom:2px}
.how-desc{font-size:10px;color:var(--muted);line-height:1.5}

/* LOADING */
.loading{display:none;max-width:560px;margin:0 auto;padding:100px 24px;text-align:center}
.loading-ring{width:48px;height:48px;margin:0 auto 20px;border:3px solid var(--border);border-top-color:var(--red);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-title{font-size:17px;font-weight:800;color:var(--navy);margin-bottom:6px}
.loading-sub{font-size:13px;color:var(--muted);margin-bottom:28px}
.load-stages{display:flex;flex-direction:column;gap:8px;text-align:left;max-width:280px;margin:0 auto}
.load-stage{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--light);opacity:0;transition:all .4s}
.load-stage.active{opacity:1;color:var(--text)}
.load-stage.done{opacity:1;color:var(--green)}
.load-dot{width:7px;height:7px;border-radius:50%;background:var(--border);flex-shrink:0}
.load-stage.active .load-dot{background:var(--red);animation:redPulse 1s infinite}
.load-stage.done .load-dot{background:var(--green)}

/* RESULT */
#result-area{display:none;max-width:1100px;margin:0 auto;padding:0 24px 80px;animation:fadeUp .4s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* ══════════════════════
   v6: CRITICAL BANNER (상단 전역 경고)
══════════════════════ */
#criticalBanner{display:none}
.critical-global-banner{background:var(--red-dark);color:#fff;padding:12px 24px;display:flex;align-items:center;justify-content:center;gap:12px;font-size:13px;font-weight:700;letter-spacing:.2px;animation:criticalIn .4s ease;position:relative;z-index:50}
@keyframes criticalIn{from{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}
.cgb-icon{font-size:16px}
.cgb-text{flex:1;text-align:center}
.cgb-action{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);color:#fff;padding:5px 14px;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;font-family:inherit}
.cgb-action:hover{background:rgba(255,255,255,.25)}

/* PROGRESS BAR */
.progress-bar{display:flex;align-items:center;padding:20px 0 28px;overflow-x:auto;gap:0}
.pb-step{display:flex;align-items:center;gap:6px;padding:7px 14px;border-radius:var(--r);font-size:12px;font-weight:700;color:var(--light);cursor:pointer;transition:all .15s;white-space:nowrap}
.pb-step.active{background:var(--navy);color:#fff}
.pb-step.done{color:var(--green)}
.pb-num{width:20px;height:20px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;background:var(--surface2);color:var(--light)}
.pb-step.active .pb-num{background:rgba(255,255,255,.15);color:#fff}
.pb-step.done .pb-num{background:var(--green-light);color:var(--green)}
.pb-arrow{color:var(--border2);margin:0 2px;font-size:14px}

.result-section{display:none}
.result-section.active{display:block;animation:fadeUp .3s ease}

/* CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:24px;margin-bottom:16px}
.card-title{font-size:15px;font-weight:800;color:var(--navy);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.card-icon{width:28px;height:28px;background:var(--blue-bg);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px}
.sec-header{margin-bottom:20px}
.sec-tags{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.sec-tag{font-size:11px;font-weight:700;padding:3px 10px;border-radius:4px}
.sec-tag-dark{background:var(--navy);color:#fff}
.sec-tag-area{background:var(--orange);color:#fff}
.sec-title{font-size:20px;font-weight:900;color:var(--navy)}
.sec-title em{color:var(--blue);font-style:normal}
.sec-sub{font-size:13px;color:var(--muted);margin-top:4px}

/* 업종 추천 카드 */
.rec-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
@media(max-width:700px){.rec-cards{grid-template-columns:1fr}}
.rec-card{background:var(--surface);border:2px solid var(--border);border-radius:var(--r-lg);padding:22px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.rec-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--border);transition:background .2s}
.rec-card:hover{border-color:var(--blue);box-shadow:var(--shadow-lg);transform:translateY(-3px)}
.rec-card:hover::before{background:var(--blue)}
.rec-card.selected{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.rec-card.selected::before{background:var(--blue)}
.rec-card.top-pick::before{background:var(--orange)}
.rec-badge{position:absolute;top:12px;right:12px;font-size:10px;font-weight:800;padding:3px 9px;border-radius:100px}
.rb-top{background:var(--orange-light);color:var(--orange)}
.rb-stable{background:var(--green-light);color:var(--green)}
.rb-growth{background:var(--blue-light);color:var(--blue)}
.rec-icon{font-size:36px;margin-bottom:10px}
.rec-name{font-size:18px;font-weight:900;margin-bottom:3px}
.rec-type{font-size:12px;color:var(--muted);margin-bottom:14px}
.score-row{display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
.score-label{display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px}
.score-label span:first-child{color:var(--muted)}
.score-label strong{font-weight:800}
.score-bar{height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}
.score-fill{height:100%;border-radius:3px;transition:width .7s ease}
.sf-profit{background:linear-gradient(90deg,var(--green),#4ade80)}
.sf-compete{background:linear-gradient(90deg,var(--yellow),#fbbf24)}
.sf-grade{background:linear-gradient(90deg,var(--blue),#60a5fa)}
.rec-cost{display:flex;justify-content:space-between;padding:12px 0 0;border-top:1px solid var(--border)}
.rc-label{font-size:11px;color:var(--muted)}
.rc-val{font-size:14px;font-weight:800}
.rec-select-btn{width:100%;margin-top:12px;background:var(--surface2);color:var(--text2);border:1.5px solid var(--border);padding:10px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .15s}
.rec-select-btn:hover{background:var(--blue);color:#fff;border-color:var(--blue)}
.rec-card.selected .rec-select-btn{background:var(--blue);color:#fff;border-color:var(--blue)}

/* ══════════════════════
   v6: 이중 점수 구조
══════════════════════ */
.dual-score-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
@media(max-width:500px){.dual-score-grid{grid-template-columns:1fr}}
.dual-score-card{border-radius:var(--r-lg);padding:22px;text-align:center;position:relative;overflow:hidden}
.dual-score-card.profit-card{background:var(--green-light);border:2px solid #86efac}
.dual-score-card.feasible-card{background:var(--red-light);border:2px solid #fca5a5;animation:dangerGlow 2s ease infinite}
.dual-score-card.feasible-card-ok{background:var(--yellow-light);border:2px solid #fcd34d}
.dual-score-card.feasible-card-safe{background:var(--green-light);border:2px solid #86efac}
@keyframes dangerGlow{0%,100%{box-shadow:0 0 0 0 rgba(220,38,38,0)}50%{box-shadow:0 0 16px 3px rgba(220,38,38,.1)}}
.ds-label{font-size:11px;font-weight:700;color:var(--muted);margin-bottom:6px}
.ds-score{font-size:48px;font-weight:900;line-height:1}
.profit-card .ds-score{color:var(--green)}
.feasible-card .ds-score{color:var(--red)}
.feasible-card-ok .ds-score{color:var(--yellow)}
.feasible-card-safe .ds-score{color:var(--green)}
.ds-badge{display:inline-block;font-size:12px;font-weight:800;padding:4px 14px;border-radius:100px;margin-top:8px;color:#fff}
.ds-gap-warning{background:#0a0a0a;border:1px solid rgba(220,38,38,.3);border-radius:var(--r);padding:12px 16px;margin-bottom:16px;font-size:12px;color:rgba(248,113,113,.85);line-height:1.7;display:flex;gap:10px;align-items:flex-start}
.ds-gap-icon{font-size:16px;flex-shrink:0;margin-top:1px}
.ds-gap-text strong{color:#f87171;font-weight:800}

/* 4대 지표 */
.quad-scores{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
@media(max-width:600px){.quad-scores{grid-template-columns:repeat(2,1fr)}}
.quad-item{text-align:center;padding:16px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r)}
.quad-item.fatal{border-color:var(--red);background:var(--red-light);animation:dangerGlow 2s ease infinite}
.quad-label{font-size:11px;color:var(--muted);font-weight:600;margin-bottom:6px}
.quad-score{font-size:30px;font-weight:900;line-height:1}
.quad-grade{font-size:11px;font-weight:700;margin-top:4px}
.fatal-badge{display:inline-flex;align-items:center;gap:4px;background:var(--red);color:#fff;font-size:10px;font-weight:800;padding:3px 10px;border-radius:100px;margin-top:5px}

/* 지역 평균 비교 */
.avg-compare-row{display:flex;align-items:center;gap:12px;margin-top:12px;padding:12px 16px;background:var(--navy-dark);border-radius:var(--r);flex-wrap:wrap}
.avg-compare-label{font-size:11px;color:rgba(255,255,255,.4);font-weight:600;flex-shrink:0}
.avg-compare-items{display:flex;gap:16px;flex-wrap:wrap}
.avg-compare-item{display:flex;align-items:center;gap:6px}
.avg-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.avg-dot.me{background:#34d399}
.avg-dot.avg{background:#94a3b8}
.avg-compare-text{font-size:12px;color:rgba(255,255,255,.7);font-weight:500}
.avg-compare-badge{font-size:11px;font-weight:800;padding:2px 10px;border-radius:100px;margin-left:auto}
.avg-compare-badge.up{background:rgba(52,211,153,.15);color:#34d399}
.avg-compare-badge.down{background:rgba(248,113,113,.15);color:#f87171}

/* ══════════════════════
   v6: 리스크 경고장 (강화)
══════════════════════ */
.risk-report-box{background:#080808;border:1.5px solid #dc2626;border-radius:var(--r-lg);padding:24px 22px;margin-bottom:16px;position:relative;overflow:hidden}
.risk-report-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#dc2626,#f87171,#dc2626);background-size:200% 100%;animation:riskFlow 2s linear infinite}
@keyframes riskFlow{0%{background-position:200% 0}100%{background-position:0 0}}
.rrb-header{display:flex;align-items:flex-start;gap:12px;margin-bottom:16px;padding-bottom:14px;border-bottom:1px solid rgba(220,38,38,.2)}
.rrb-icon-wrap{width:40px;height:40px;border-radius:8px;background:rgba(220,38,38,.12);border:1px solid rgba(220,38,38,.25);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;animation:riskIconPulse 2s ease infinite}
@keyframes riskIconPulse{0%,100%{box-shadow:0 0 0 0 rgba(220,38,38,0)}50%{box-shadow:0 0 0 6px rgba(220,38,38,.1)}}
.rrb-title-block{}
.rrb-title{font-size:14px;font-weight:900;color:#f87171;letter-spacing:.3px;margin-bottom:2px}
.rrb-subtitle{font-size:10px;color:rgba(248,113,113,.45);font-weight:700;letter-spacing:1.2px;text-transform:uppercase}
/* v6: 계약 전 체크 리스트 헤더 */
.rrb-checklist-header{font-size:11px;font-weight:800;color:rgba(255,255,255,.35);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.rrb-checklist-header::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.06)}
.rrb-items{display:flex;flex-direction:column;gap:8px}
.rrb-item{display:flex;gap:10px;align-items:flex-start;padding:12px 14px;border-radius:6px;border-left:3px solid}
.rrb-item.critical{background:rgba(220,38,38,.08);border-color:#dc2626}
.rrb-item.warning{background:rgba(234,88,12,.08);border-color:#ea580c}
.rrb-item.caution{background:rgba(202,138,4,.07);border-color:#ca8a04}
.rrb-item-icon{font-size:14px;flex-shrink:0;margin-top:1px}
.rrb-item-content{flex:1}
.rrb-item-title{font-size:13px;font-weight:800;margin-bottom:3px}
.rrb-item.critical .rrb-item-title{color:#f87171}
.rrb-item.warning .rrb-item-title{color:#fb923c}
.rrb-item.caution .rrb-item-title{color:#fbbf24}
.rrb-item-desc{font-size:11px;color:rgba(255,255,255,.38);line-height:1.65}
/* v6: (i) 툴팁 */
.rrb-item-meta{display:flex;align-items:center;gap:6px;margin-top:5px;flex-wrap:wrap}
.rrb-item-law{font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;background:rgba(255,255,255,.05);color:rgba(255,255,255,.28);border:1px solid rgba(255,255,255,.07)}
.tip-badge{display:inline-flex;align-items:center;gap:4px;font-size:10px;color:rgba(255,255,255,.2);cursor:help;position:relative}
.tip-badge:hover .tip-popup{display:block}
.tip-popup{display:none;position:absolute;bottom:120%;left:0;background:#1e293b;color:#e2e8f0;font-size:11px;padding:8px 12px;border-radius:6px;white-space:nowrap;z-index:50;border:1px solid rgba(255,255,255,.1);box-shadow:0 4px 16px rgba(0,0,0,.3);line-height:1.6;min-width:200px;max-width:280px;white-space:normal}
.rrb-score{font-size:13px;font-weight:900;margin-left:auto;flex-shrink:0;padding-left:10px;align-self:flex-start;margin-top:2px}
.rrb-item.critical .rrb-score{color:#f87171}
.rrb-item.warning .rrb-score{color:#fb923c}
.rrb-item.caution .rrb-score{color:#fbbf24}

/* 감점/가점 */
.deduction-list{display:flex;flex-direction:column;gap:6px}
.deduction-item{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:var(--r);font-size:12px}
.deduction-item.red{background:var(--red-light);border-left:3px solid var(--red)}
.deduction-item.yellow{background:var(--yellow-light);border-left:3px solid var(--yellow)}
.deduction-item.green{background:var(--green-light);border-left:3px solid var(--green)}
.ded-icon{font-size:14px;flex-shrink:0}
.ded-text{flex:1}
.ded-score{font-weight:900;white-space:nowrap}
/* v6: 점수 툴팁 */
.score-info-icon{font-size:11px;color:var(--light);cursor:help;position:relative;margin-left:4px;flex-shrink:0}
.score-info-icon:hover .tip-popup{display:block}
.score-logic-note{margin-top:10px;padding:8px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;font-size:10px;color:var(--light);font-family:'Courier New',monospace;letter-spacing:.3px}

/* 비교 배너 */
.compare-banner{background:var(--blue-bg);border:1.5px solid #93c5fd;border-radius:var(--r-lg);padding:20px;margin:16px 0;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.compare-title{font-size:14px;font-weight:800;color:var(--navy);margin-bottom:2px}
.compare-desc{font-size:12px;color:var(--muted)}
.compare-btns{display:flex;gap:8px}
.compare-btn{background:var(--blue);color:#fff;border:none;padding:8px 16px;border-radius:var(--r);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:all .15s}
.compare-btn:hover{background:#1d4ed8}
.compare-btn.outline{background:#fff;color:var(--blue);border:1.5px solid var(--blue)}
.analysis-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:700px){.analysis-grid{grid-template-columns:1fr}}
.comp-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.comp-item:last-child{border-bottom:none}
.comp-name{font-weight:600}
.comp-dist{color:var(--muted);font-size:11px}
.comp-rating{color:var(--yellow);font-weight:800;font-size:12px}
.insight-list{display:flex;flex-direction:column;gap:6px}
.insight-item{display:flex;gap:8px;padding:10px 12px;background:var(--surface2);border-radius:var(--r)}
.ii-icon{font-size:14px;flex-shrink:0;margin-top:1px}
.ii-title{font-size:12px;font-weight:800;margin-bottom:2px}
.ii-desc{font-size:11px;color:var(--muted);line-height:1.6}
.ii-positive{border-left:3px solid var(--green)}
.ii-caution{border-left:3px solid var(--yellow)}
.ii-negative{border-left:3px solid var(--red)}

/* 법적 검토 */
.land-bridge{background:var(--navy);border-radius:var(--r-xl);padding:32px 28px;color:#fff;margin-bottom:16px;position:relative;overflow:hidden}
.land-bridge::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 80% 50%,rgba(37,99,235,.25) 0%,transparent 50%)}
.land-bridge *{position:relative}
.lb-eyebrow{font-size:11px;font-weight:700;opacity:.5;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px}
.lb-title{font-size:20px;font-weight:900;margin-bottom:6px;line-height:1.35}
.lb-desc{font-size:13px;opacity:.55;line-height:1.7}
.admin-term-box{background:rgba(37,99,235,.12);border:1px solid rgba(147,197,253,.3);border-radius:var(--r);padding:12px 16px;margin-top:16px;font-size:12px;color:rgba(255,255,255,.8);line-height:1.8}
.admin-term-box strong{color:#93c5fd;font-weight:800}
.admin-term-highlight{font-size:11px;background:rgba(147,197,253,.15);border-radius:4px;padding:1px 6px;font-weight:700;color:#bfdbfe}
.zone-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
@media(max-width:520px){.zone-grid{grid-template-columns:1fr}}
.zone-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border:1.5px solid;border-radius:6px;font-size:12px}
.zone-item.ok{border-color:#bbf7d0;background:#f0fdf4}
.zone-item.ok .zs{color:#16a34a}
.zone-item.cond{border-color:#fde68a;background:#fefce8}
.zone-item.cond .zs{color:#ca8a04}
.zone-item.no{border-color:#fecaca;background:#fef2f2;color:var(--muted)}
.zone-item.no .zs{color:#dc2626}
.zs{font-size:11px;font-weight:800;flex-shrink:0}
.zn{font-size:12px;font-weight:500}
.permit-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:14px}
@media(max-width:600px){.permit-grid{grid-template-columns:1fr}}
.permit-item{padding:12px;border-radius:var(--r);border:1.5px solid;text-align:center}
.permit-item.pass{border-color:#bbf7d0;background:#f0fdf4}
.permit-item.fail{border-color:#fecaca;background:#fef2f2}
.permit-item.warn{border-color:#fde68a;background:#fefce8}
.permit-icon{font-size:20px;margin-bottom:4px}
.permit-label{font-size:11px;color:var(--muted);font-weight:600}
.permit-status{font-size:12px;font-weight:800;margin-top:3px}
.permit-item.pass .permit-status{color:var(--green)}
.permit-item.fail .permit-status{color:var(--red)}
.permit-item.warn .permit-status{color:var(--yellow)}

/* 인라인 상담 배너 */
.inline-consult-banner{background:linear-gradient(135deg,#150202,#250404);border:1.5px solid rgba(220,38,38,.4);border-radius:var(--r-lg);padding:20px 22px;margin:16px 0;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.icb-eyebrow{font-size:10px;font-weight:700;color:#f87171;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px}
.icb-title{font-size:15px;font-weight:900;color:#fff;margin-bottom:4px}
.icb-desc{font-size:12px;color:rgba(255,255,255,.4);line-height:1.6}
.icb-btn{background:#dc2626;color:#fff;border:none;padding:12px 22px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;white-space:nowrap;box-shadow:0 3px 12px rgba(220,38,38,.35)}
.icb-btn:hover{background:#b91c1c;transform:translateY(-1px)}

/* 비용표 */
.pyung-control{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--surface2);border-radius:var(--r);margin-bottom:14px}
.pyung-input{width:60px;background:#fff;border:1.5px solid var(--border);border-radius:6px;padding:5px 8px;font-size:14px;font-weight:800;text-align:center;outline:none;font-family:inherit}
.pyung-input:focus{border-color:var(--blue)}
.cost-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.cost-row:last-of-type{border-bottom:none}
.cr-l{color:var(--muted)}
.cr-r{font-weight:700}
.cr-r.deposit{color:var(--yellow)}
.cost-total-row{display:flex;justify-content:space-between;padding:12px 0 0;margin-top:4px;border-top:2px solid var(--navy)}
.ct-l{font-weight:800;font-size:14px}
.ct-r{font-weight:900;font-size:17px;color:var(--blue)}

/* 수익 */
.revenue-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media(max-width:600px){.revenue-grid{grid-template-columns:1fr}}
.rev-card{background:var(--surface2);border-radius:var(--r);padding:18px;text-align:center;border:1px solid var(--border)}
.rev-scenario{font-size:12px;font-weight:700;margin-bottom:8px}
.rev-amount{font-size:26px;font-weight:900;line-height:1}
.rev-unit{font-size:11px;color:var(--muted);margin-top:4px}
.rc-pess{color:#f87171}
.rc-base{color:var(--blue)}
.rc-opt{color:var(--green)}
.bep-card{background:var(--navy);border-radius:var(--r-lg);padding:24px;color:#fff;margin-top:16px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;text-align:center}
@media(max-width:600px){.bep-card{grid-template-columns:1fr}}
.bep-label{font-size:11px;opacity:.45;font-weight:600;margin-bottom:4px}
.bep-value{font-size:24px;font-weight:900}
.bep-sub{font-size:10px;opacity:.35;margin-top:2px}

/* 연도별 매출 잠금 */
.yearly-rev-section{margin-top:16px}
.yr-title{font-size:13px;font-weight:800;color:var(--navy);margin-bottom:8px;display:flex;align-items:center;gap:8px}
.yr-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(max-width:600px){.yr-grid{grid-template-columns:1fr}}
.yr-card{border-radius:var(--r);padding:16px;text-align:center;border:1px solid var(--border);position:relative;overflow:hidden}
.yr-card.yr-free{background:var(--surface2)}
.yr-card.yr-locked{background:var(--surface2)}
.yr-year{font-size:11px;font-weight:700;color:var(--muted);margin-bottom:6px}
.yr-amount{font-size:22px;font-weight:900}
.yr-sub{font-size:10px;color:var(--muted);margin-top:3px}
.yr-lock-overlay{position:absolute;inset:0;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);background:rgba(248,250,252,.7);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer}
.yr-lock-overlay:hover{background:rgba(239,246,255,.85)}
.yr-lock-icon{font-size:18px}
.yr-lock-text{font-size:10px;font-weight:800;color:var(--blue)}

/* 고정비 블러 */
.fixed-cost-locked{position:relative;overflow:hidden;border-radius:var(--r);border:1px solid var(--border);padding:14px;margin-top:10px;background:var(--surface2)}
.fixed-cost-content{filter:blur(5px);user-select:none}
.fixed-cost-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;background:rgba(255,255,255,.5);backdrop-filter:blur(2px)}
.fixed-cost-overlay:hover{background:rgba(239,246,255,.7)}
.fco-text{font-size:12px;font-weight:800;color:var(--blue)}

/* 최종 등급 */
.final-grade-card{text-align:center;padding:36px 20px;border-radius:var(--r-xl);margin-top:16px}
.final-grade-card.safe{background:var(--green-light);border:2px solid #86efac}
.final-grade-card.caution{background:var(--yellow-light);border:2px solid #fcd34d}
.final-grade-card.danger{background:var(--red-light);border:2px solid #fca5a5;animation:dangerGlow 2s ease infinite}
.fg-emoji{font-size:40px;margin-bottom:10px}
.fg-label{font-size:12px;color:var(--muted);font-weight:700;margin-bottom:4px}
.fg-grade{font-size:44px;font-weight:900;line-height:1}
.final-grade-card.safe .fg-grade{color:var(--green)}
.final-grade-card.caution .fg-grade{color:var(--yellow)}
.final-grade-card.danger .fg-grade{color:var(--red)}
.fg-badge{display:inline-block;font-size:13px;font-weight:800;padding:5px 16px;border-radius:100px;margin-top:10px;color:#fff}
.expert-verdict-box{margin-top:14px;padding:14px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);font-size:12px;color:var(--muted);line-height:1.8}
.expert-verdict-box strong{color:var(--text);font-weight:800}

/* ══════════════════════
   v6: 프리미엄 CTA — "보증금 보험" 구조
══════════════════════ */
.premium-section-wrapper{margin:20px 0}
.ps-lock-notice{background:var(--surface2);border:1.5px dashed var(--border2);border-radius:var(--r-lg);padding:18px 20px;margin-bottom:16px;text-align:center}
.ps-lock-title{font-size:14px;font-weight:800;color:var(--text2);margin-bottom:4px}
.ps-lock-desc{font-size:12px;color:var(--muted);line-height:1.7}
.pcu-box{background:#fff;border:2px solid var(--red);border-radius:var(--r-xl);padding:28px;position:relative;overflow:hidden}
.pcu-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--red),var(--orange),var(--red));background-size:200% 100%;animation:riskFlow 2s linear infinite}
.pcu-eyebrow{font-size:10px;font-weight:800;color:var(--red);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px}
.pcu-title{font-size:18px;font-weight:900;color:var(--navy);margin-bottom:6px;line-height:1.4}
.pcu-desc{font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:18px}

/* ══════════════════════
   v6: PDF 샘플 미리보기
══════════════════════ */
.pdf-preview-strip{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
@media(max-width:600px){.pdf-preview-strip{grid-template-columns:1fr}}
.pdf-page{border:1.5px solid var(--border);border-radius:var(--r);overflow:hidden;cursor:pointer;transition:all .2s;position:relative}
.pdf-page:hover{border-color:var(--blue);box-shadow:var(--shadow-md)}
.pdf-page-header{background:var(--navy);padding:8px 12px;display:flex;align-items:center;gap:6px}
.pdf-page-logo{font-size:10px;font-weight:800;color:#fff;letter-spacing:.3px}
.pdf-page-num{font-size:9px;color:rgba(255,255,255,.35);margin-left:auto}
.pdf-page-body{padding:12px;background:#fafafa;min-height:110px}
.pdf-section-title{font-size:10px;font-weight:800;color:var(--navy);margin-bottom:8px;padding-bottom:4px;border-bottom:1.5px solid var(--navy)}
.pdf-row{display:flex;justify-content:space-between;margin-bottom:5px;font-size:10px}
.pdf-row-label{color:var(--muted)}
.pdf-row-val{font-weight:700}
.pdf-row-val.locked{display:flex;align-items:center;gap:4px;color:var(--red)}
.pdf-blur-row{height:9px;background:linear-gradient(90deg,#e2e8f0 0%,#f1f5f9 100%);border-radius:3px;margin-bottom:5px;animation:shimmer 1.8s ease infinite}
@keyframes shimmer{0%,100%{opacity:.6}50%{opacity:1}}
.pdf-lock-overlay{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(180deg,transparent,rgba(248,250,252,.95));display:flex;align-items:flex-end;justify-content:center;padding-bottom:10px}
.pdf-lock-text{font-size:10px;font-weight:800;color:var(--blue);display:flex;align-items:center;gap:4px}
.pdf-sample-caption{text-align:center;font-size:11px;color:var(--muted);margin-bottom:16px;font-style:italic}

/* 가격 티어 */
.price-tiers{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px}
@media(max-width:500px){.price-tiers{grid-template-columns:1fr}}
.price-tier{border:2px solid var(--border);border-radius:var(--r-lg);padding:18px;transition:all .15s;cursor:pointer}
.price-tier:hover{border-color:var(--blue)}
.price-tier.recommended{border-color:var(--red);background:rgba(220,38,38,.02)}
.pt-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.price-tier.recommended .pt-label{color:var(--red)}
.pt-name{font-size:15px;font-weight:900;color:var(--navy);margin-bottom:6px}
.pt-items{font-size:11px;color:var(--muted);line-height:1.9;margin-bottom:10px}
.pt-items span{display:block}
.pt-items span::before{content:'✓ ';color:var(--green);font-weight:800}
.pt-price-row{display:flex;align-items:baseline;gap:6px}
.pt-price{font-size:22px;font-weight:900;color:var(--navy)}
.price-tier.recommended .pt-price{color:var(--red)}
.pt-orig{font-size:12px;color:var(--light);text-decoration:line-through}
.pt-badge{font-size:10px;font-weight:800;background:var(--red);color:#fff;padding:2px 8px;border-radius:100px;margin-left:4px}
.pcu-cta-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.pcu-btn-main{background:var(--red);color:#fff;border:none;padding:14px 24px;border-radius:var(--r);font-family:inherit;font-size:14px;font-weight:900;cursor:pointer;transition:all .2s;box-shadow:0 4px 16px rgba(220,38,38,.3);display:flex;align-items:center;gap:8px}
.pcu-btn-main:hover{background:#b91c1c;transform:translateY(-1px)}
.pcu-btn-sec{background:#fff;color:var(--navy);border:2px solid var(--border);padding:14px 20px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .15s}
.pcu-btn-sec:hover{border-color:var(--navy)}

/* v6: 사회적 증거 */
.scarcity-note{margin-top:12px;text-align:center;font-size:11px;color:var(--light)}
.scarcity-note em{color:var(--muted);font-style:normal;font-weight:600}

/* 매물 */
.property-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media(max-width:700px){.property-grid{grid-template-columns:1fr}}
.prop-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);overflow:hidden;cursor:pointer;transition:all .2s}
.prop-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-3px)}
.prop-thumb{height:120px;background:linear-gradient(135deg,#dbeafe,#bfdbfe);display:flex;align-items:center;justify-content:center;font-size:40px;position:relative}
.prop-thumb-badge{position:absolute;top:8px;left:8px;background:var(--navy);color:#fff;font-size:10px;font-weight:800;padding:3px 8px;border-radius:4px}
.prop-body{padding:14px}
.prop-area{font-size:11px;color:var(--muted);margin-bottom:2px}
.prop-name{font-size:14px;font-weight:800;margin-bottom:3px}
.prop-pyung{font-size:11px;color:var(--muted);margin-bottom:8px}
.prop-price{font-size:15px;font-weight:900;color:var(--blue)}
.prop-rent{font-size:12px;color:var(--muted)}
.prop-tags{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px}
.p-tag{font-size:10px;background:var(--surface2);border:1px solid var(--border);color:var(--muted);padding:2px 7px;border-radius:4px}

/* 전문가 상담 */
.expert-consult-card{background:var(--navy);border-radius:var(--r-xl);padding:28px;margin-bottom:16px;position:relative;overflow:hidden;color:#fff}
.expert-consult-card::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 80% at 90% 50%,rgba(37,99,235,.18) 0%,transparent 60%)}
.expert-consult-card *{position:relative}
.ecc-eyebrow{font-size:10px;font-weight:700;opacity:.4;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px}
.ecc-title{font-size:18px;font-weight:900;margin-bottom:6px;line-height:1.4}
.ecc-desc{font-size:13px;opacity:.5;line-height:1.7;margin-bottom:20px}
.ecc-tiers{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
@media(max-width:600px){.ecc-tiers{grid-template-columns:1fr}}
.ecc-tier{border-radius:var(--r);padding:14px 16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1)}
.ecc-tier.premium-tier{background:rgba(37,99,235,.15);border-color:rgba(37,99,235,.35)}
.ecc-tier-label{font-size:10px;font-weight:700;opacity:.5;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.ecc-tier.premium-tier .ecc-tier-label{color:#93c5fd;opacity:1}
.ecc-tier-title{font-size:14px;font-weight:800;margin-bottom:4px}
.ecc-tier-desc{font-size:11px;opacity:.45;line-height:1.6}
.ecc-tier-price{font-size:16px;font-weight:900;margin-top:8px}
.ecc-tier.premium-tier .ecc-tier-price{color:#93c5fd}
.ecc-btns{display:flex;gap:10px;flex-wrap:wrap}
.ecc-btn-main{background:var(--blue);color:#fff;border:none;padding:12px 22px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;box-shadow:0 3px 12px rgba(37,99,235,.3)}
.ecc-btn-main:hover{background:#1d4ed8;transform:translateY(-1px)}
.ecc-btn-sec{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.15);padding:12px 18px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer}

/* SEC NAV */
.sec-nav{display:flex;justify-content:space-between;margin-top:24px}
.sn-btn{background:var(--surface);border:1.5px solid var(--border);color:var(--muted);padding:10px 20px;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .15s}
.sn-btn:hover{border-color:var(--blue);color:var(--blue)}
.sn-btn.primary{background:var(--blue);color:#fff;border-color:var(--blue)}
.sn-btn.primary:hover{background:#1d4ed8}

/* DATA SOURCE BAR */
.data-source-bar{background:var(--navy-dark);border-top:1px solid rgba(255,255,255,.04);padding:14px 24px;font-size:10px;color:rgba(255,255,255,.2);text-align:center;letter-spacing:.3px;line-height:1.9}
.data-source-bar span{color:rgba(255,255,255,.35);font-weight:700}

/* FOOTER */
footer{background:var(--navy-dark);color:rgba(255,255,255,.35);font-size:12px;padding:36px 24px;margin-top:0}
.footer-inner{max-width:1100px;margin:0 auto}
.footer-logo{font-size:15px;font-weight:800;color:#fff;margin-bottom:8px}
.footer-links{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px}
.footer-links a{color:rgba(255,255,255,.5);text-decoration:none;font-size:12px}
.footer-links a:hover{color:#fff}

/* TOAST */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(12px);background:var(--navy);color:#fff;padding:12px 22px;border-radius:var(--r);font-size:13px;font-weight:600;opacity:0;transition:all .3s;z-index:200;pointer-events:none;box-shadow:var(--shadow-lg)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* ── MYPAGE MODAL ───────────────────────────────── */
.mp-overlay{position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.75);display:none;align-items:flex-start;justify-content:center;padding:24px 16px;overflow-y:auto;}
.mp-overlay.open{display:flex;}
.mp-modal{background:#fff;border-radius:16px;width:min(680px,100%);margin:auto;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;}
.mp-header{background:var(--navy);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;}
.mp-close{background:rgba(255,255,255,.15);border:none;color:#fff;width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;}
.mp-close:hover{background:rgba(255,255,255,.25);}
.mp-tabs{display:flex;background:#f8fafc;border-bottom:1px solid var(--border);padding:0 20px;}
.mp-tab{padding:14px 18px;font-size:14px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .2s;white-space:nowrap;}
.mp-tab:hover{color:var(--text);}
.mp-tab.active{color:var(--blue);border-bottom-color:var(--blue);}
.mp-body{padding:24px;min-height:360px;}
.mp-section-title{font-size:11px;font-weight:700;color:var(--light);letter-spacing:.8px;text-transform:uppercase;margin-bottom:14px;}
.mp-analysis-item{display:flex;align-items:center;gap:14px;padding:14px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-lg);margin-bottom:8px;transition:all .2s;cursor:default;}
.mp-analysis-item:hover{border-color:var(--blue-light);background:var(--blue-bg);}
.mp-empty{text-align:center;padding:52px 20px;color:var(--light);}
.mp-empty-icon{font-size:44px;margin-bottom:14px;}
.mp-plan-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:480px){.mp-plan-grid{grid-template-columns:1fr;}}
.mp-plan-card{border:2px solid var(--border);border-radius:var(--r-xl);padding:20px;}
.mp-plan-card.active-plan{border-color:var(--blue);background:var(--blue-bg);}
.mp-plan-card.premium-plan{border-color:#ca8a04;background:var(--yellow-light);}
.mp-plan-badge{display:inline-block;font-size:10px;font-weight:700;padding:3px 8px;border-radius:100px;margin-bottom:12px;}
.mp-stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;}
.mp-stat-box{background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;text-align:center;}
.mp-input-row{margin-bottom:16px;}
.mp-input-row label{display:block;font-size:12px;font-weight:700;color:var(--muted);margin-bottom:6px;}
.mp-input{width:100%;border:1.5px solid var(--border);border-radius:var(--r);padding:10px 14px;font-size:14px;font-family:inherit;outline:none;transition:border-color .2s;background:#fff;}
.mp-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.08);}

/* ── AUTH MODAL ──────────────────────────────── */
.auth-overlay{position:fixed;inset:0;z-index:11000;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;padding:20px;}
.auth-overlay.open{display:flex;}
.auth-modal{background:#fff;border-radius:16px;width:min(420px,100%);box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;}
.auth-header{background:var(--navy);padding:20px 24px;text-align:center;}
.auth-tabs{display:flex;background:#f8fafc;border-bottom:1px solid var(--border);}
.auth-tab{flex:1;padding:13px;font-size:14px;font-weight:700;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .2s;text-align:center;}
.auth-tab.active{color:var(--blue);border-bottom-color:var(--blue);}
.auth-body{padding:24px;}
.auth-field{margin-bottom:16px;}
.auth-field label{display:block;font-size:12px;font-weight:700;color:var(--muted);margin-bottom:6px;}
.auth-input{width:100%;border:1.5px solid var(--border);border-radius:var(--r);padding:11px 14px;font-size:14px;font-family:inherit;outline:none;transition:all .2s;background:#fff;}
.auth-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.08);}
.auth-input.error{border-color:var(--red);box-shadow:0 0 0 3px rgba(220,38,38,.08);}
.auth-btn{width:100%;padding:13px;background:var(--blue);color:#fff;border:none;border-radius:var(--r);font-size:15px;font-weight:700;font-family:inherit;cursor:pointer;transition:all .2s;margin-top:4px;}
.auth-btn:hover{background:#1d4ed8;}
.auth-btn:disabled{opacity:.6;cursor:not-allowed;}
.auth-error{font-size:12px;color:var(--red);font-weight:600;margin-top:10px;padding:10px 12px;background:var(--red-light);border-radius:var(--r);display:none;}
.auth-error.show{display:block;}
.auth-divider{text-align:center;font-size:12px;color:var(--light);margin:16px 0;position:relative;}
.auth-divider::before,.auth-divider::after{content:'';position:absolute;top:50%;width:40%;height:1px;background:var(--border);}
.auth-divider::before{left:0;}.auth-divider::after{right:0;}
/* 유저 드롭다운 */
.user-menu{position:relative;}
.user-menu-dropdown{position:absolute;top:calc(100% + 8px);right:0;background:#fff;border:1px solid var(--border);border-radius:var(--r-lg);box-shadow:var(--shadow-lg);min-width:180px;z-index:200;display:none;overflow:hidden;}
.user-menu-dropdown.open{display:block;}
.user-menu-item{padding:11px 16px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;transition:background .15s;}
.user-menu-item:hover{background:var(--surface2);}
.user-menu-item.danger{color:var(--red);}
.user-menu-item.danger:hover{background:var(--red-light);}

/* ── 공통 페이지 오버레이 (핫트렌드·정책가이드 공용) ── */
.page-overlay{position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.75);display:none;align-items:flex-start;justify-content:center;padding:24px 16px;overflow-y:auto;}
.page-overlay.open{display:flex;}
.page-modal{background:#fff;border-radius:16px;width:min(800px,100%);margin:auto;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;}
.page-modal-header{padding:16px 22px;display:flex;align-items:center;justify-content:space-between;}
.page-close{background:rgba(255,255,255,.15);border:none;color:#fff;width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;}
.page-close:hover{background:rgba(255,255,255,.25);}
.page-body{padding:24px;}

/* 핫트렌드 */
.trend-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
@media(max-width:560px){.trend-grid{grid-template-columns:1fr;}}
.trend-card{background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px 18px;display:flex;align-items:center;gap:14px;transition:all .2s;}
.trend-card:hover{border-color:var(--blue-light);background:var(--blue-bg);}
.trend-rank{font-size:18px;font-weight:900;color:var(--light);min-width:26px;text-align:center;}
.trend-rank.top3{color:var(--blue);}
.trend-info{flex:1;min-width:0;}
.trend-name{font-size:15px;font-weight:700;color:var(--text);}
.trend-sub{font-size:12px;color:var(--muted);margin-top:2px;}
.trend-change{font-size:14px;font-weight:800;white-space:nowrap;}
.trend-change.up{color:var(--red);}
.trend-change.down{color:var(--blue);}
.trend-bar-wrap{height:4px;background:var(--border);border-radius:100px;margin-top:6px;}
.trend-bar{height:4px;border-radius:100px;transition:width .6s;}
.hot-badge{display:inline-block;font-size:10px;font-weight:700;background:#fef2f2;color:var(--red);border:1px solid #fecaca;padding:1px 6px;border-radius:100px;margin-left:6px;vertical-align:middle;}
.new-badge{display:inline-block;font-size:10px;font-weight:700;background:var(--green-light);color:var(--green);border:1px solid #86efac;padding:1px 6px;border-radius:100px;margin-left:6px;vertical-align:middle;}

/* 정책 가이드 */
.policy-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px;}
.policy-tab{font-size:12px;font-weight:700;padding:6px 14px;border-radius:100px;border:1.5px solid var(--border);color:var(--muted);cursor:pointer;transition:all .2s;background:#fff;}
.policy-tab:hover{border-color:var(--blue);color:var(--blue);}
.policy-tab.active{background:var(--blue);color:#fff;border-color:var(--blue);}
.policy-card{border:1.5px solid var(--border);border-radius:var(--r-lg);padding:18px 20px;margin-bottom:12px;transition:all .2s;cursor:default;}
.policy-card:hover{border-color:var(--blue-light);box-shadow:var(--shadow-md);}
.policy-card-header{display:flex;align-items:flex-start;gap:12px;margin-bottom:10px;}
.policy-badge{font-size:10px;font-weight:700;padding:3px 8px;border-radius:100px;white-space:nowrap;}
.policy-amount{font-size:18px;font-weight:900;color:var(--blue);margin-bottom:4px;}
.policy-desc{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:10px;}
.policy-tags{display:flex;gap:6px;flex-wrap:wrap;}
.policy-tag{font-size:11px;padding:3px 8px;background:var(--surface2);border:1px solid var(--border);border-radius:100px;color:var(--muted);}
.policy-link{display:inline-flex;align-items:center;gap:5px;font-size:12px;font-weight:700;color:var(--blue);text-decoration:none;margin-top:10px;}
.policy-link:hover{text-decoration:underline;}
</style>
</head>
<body>

<div class="top-bar">
  <a href="#">데이터 출처</a><span class="top-bar-divider"></span>
  <a href="#">이용안내</a><span class="top-bar-divider"></span>
  <a href="#">로그인</a>
</div>

<nav class="nav">
  <div class="nav-left">
    <a href="#" class="nav-logo" onclick="location.reload()">
      <div class="nav-logo-mark">🧭</div>
      <span class="nav-logo-text">창업<em>지도</em></span>
    </a>
    <div class="nav-menu">
      <span class="nav-menu-item active" onclick="scrollToServices()">보증금 검증</span>
      <span class="nav-menu-item" onclick="openMapModal('commercial')">상권 지도</span>
      <span class="nav-menu-item" onclick="openTrend()">핫트렌드</span>
      <span class="nav-menu-item" onclick="openPolicy()">정책 가이드</span>
    </div>
  </div>
  <div class="nav-right">
    <!-- 로그아웃 상태: 로그인 버튼 / 로그인 상태: 유저 메뉴 -->
    <div id="authGuestBtns" style="display:flex;gap:8px;">
      <button class="nav-btn" onclick="openAuthModal('login')">로그인</button>
      <button class="nav-btn" style="border-color:rgba(255,255,255,.3);" onclick="openAuthModal('signup')">회원가입</button>
    </div>
    <div id="authUserMenu" class="user-menu" style="display:none;">
      <button class="nav-btn" onclick="toggleUserMenu()" style="display:flex;align-items:center;gap:6px;">
        <span style="font-size:16px;">👤</span>
        <span id="navNickname">사용자</span>
        <span style="font-size:10px;opacity:.7;">▾</span>
      </button>
      <div class="user-menu-dropdown" id="userMenuDropdown">
        <div class="user-menu-item" onclick="closeUserMenu();openMypage();">📊 마이페이지</div>
        <div class="user-menu-item" onclick="closeUserMenu();openMypage();showMpTab('membership');">💎 멤버십</div>
        <div style="height:1px;background:var(--border);margin:4px 0;"></div>
        <div class="user-menu-item danger" onclick="handleSignOut()">🚪 로그아웃</div>
      </div>
    </div>
    <button class="nav-btn" id="mypageNavBtn" onclick="openMypage()">마이페이지</button>
    <button class="nav-btn primary" onclick="scrollToSearch()">무료 검증 시작</button>
  </div>
</nav>

<!-- ═══════════════════
     v6 HERO — 방패 포지셔닝
═══════════════════ -->
<section class="hero" id="heroSection">
  <div class="hero-inner">
    <div class="hero-danger-badge">
      <span class="hdb-dot"></span>
      계약 직전 창업자 62%가 이 리스크를 모릅니다
    </div>
    <h1>계약서 쓰기 전,<br><span class="accent">5분만 확인하세요.</span></h1>
    <p class="hero-sub-v6">보증금 5천만 원을 지키는 가장 싸고 빠른 방법.</p>
    <p class="hero-sub-bold">
      인허가 불가 · 용도지역 위반 · 상권 과밀 —<br>
      <em>계약 후 발견되면 돌이킬 수 없습니다.</em>
    </p>

    <div class="search-box" id="searchBox">
      <div class="search-field">
        <span class="sf-icon">💡</span>
        <input type="text" id="bizInput" placeholder="관심 업종 (예: 카페, 삼겹살집, 편의점...)">
      </div>
      <div class="search-field">
        <span class="sf-icon">📍</span>
        <input type="text" id="areaInput" placeholder="희망 지역 (예: 강남역, 홍대, 성수동...)">
        <button onclick="openMapModal('select')" style="background:var(--blue);color:#fff;border:none;border-radius:6px;padding:5px 10px;font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;margin-left:6px;transition:background .15s;" onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='var(--blue)'">지도 선택</button>
      </div>
      <button class="search-btn" onclick="runAnalysis()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        무료 검증
      </button>
    </div>

    <div class="search-tags">
      <span class="stag" onclick="selectBiz(this,'카페')">☕ 카페</span>
      <span class="stag" onclick="selectBiz(this,'치킨집')">🍗 치킨집</span>
      <span class="stag" onclick="selectBiz(this,'고깃집')">🥩 고깃집</span>
      <span class="stag" onclick="selectBiz(this,'분식집')">🍜 분식집</span>
      <span class="stag" onclick="selectBiz(this,'베이커리')">🥐 베이커리</span>
      <span class="stag" onclick="selectBiz(this,'헬스장')">💪 헬스장</span>
      <span class="stag" onclick="selectBiz(this,'미용실')">💇 미용실</span>
      <span class="stag" onclick="selectBiz(this,'편의점')">🏪 편의점</span>
      <span class="stag" onclick="selectBiz(this,'술집')">🍺 술집</span>
      <span class="stag" onclick="selectBiz(this,'중국집')">🥡 중국집</span>
      <span class="stag" onclick="selectBiz(this,'노래방')">🎤 노래방</span>
      <span class="stag" onclick="selectBiz(this,'PC방')">🖥️ PC방</span>
      <span class="stag" onclick="selectBiz(this,'네일샵')">💅 네일샵</span>
    </div>
    <div class="search-tags" style="margin-top:6px;">
      <span class="stag" onclick="selectArea(this,'강남역')">📍 강남역</span>
      <span class="stag" onclick="selectArea(this,'홍대')">📍 홍대</span>
      <span class="stag" onclick="selectArea(this,'성수동')">📍 성수동</span>
      <span class="stag" onclick="selectArea(this,'신촌')">📍 신촌</span>
      <span class="stag" onclick="selectArea(this,'건대입구')">📍 건대</span>
      <span class="stag" onclick="selectArea(this,'종로')">📍 종로</span>
      <span class="stag" onclick="selectArea(this,'부산 서면')">📍 부산 서면</span>
      <span class="stag" onclick="selectArea(this,'대구 동성로')">📍 대구</span>
      <span class="stag" onclick="selectArea(this,'인천 부평')">📍 인천</span>
      <span class="stag" onclick="selectArea(this,'수원 팔달구')">📍 수원</span>
    </div>

    <div class="trust-trio">
      <div class="trust-item">🏛️ <span>국토교통부 v-world API 연동</span></div>
      <div class="trust-item">📊 <span>소상공인진흥공단 상권DB</span></div>
      <div class="trust-item">⚖️ <span>건축물대장 실시간 조회</span></div>
    </div>
  </div>
</section>

<!-- STATS BAR -->
<div class="stats-bar">
  <div class="stats-bar-inner">
    <div class="stat-item"><div class="stat-num">312<span>건</span></div><div class="stat-label">이번 달 계약 리스크 사전 검증</div></div>
    <div class="stat-item"><div class="stat-num">64<span>개</span></div><div class="stat-label">공공·민간 데이터 융합</div></div>
    <div class="stat-item"><div class="stat-num">2.8<span>배</span></div><div class="stat-label">사전 검증 후 분쟁 감소율</div></div>
    <div class="stat-item"><div class="stat-num">150<span>만+</span></div><div class="stat-label">누적 이용 건수</div></div>
  </div>
</div>

<!-- MAIN SERVICES -->
<section class="services" id="servicesSection">
  <div class="services-title">🛡 보증금 보호 서비스</div>
  <div class="services-sub">계약 전 반드시 확인해야 할 4가지 검증 항목</div>
  <div class="service-grid">
    <div class="svc-card c-blue" onclick="scrollToSearch()">
      <div class="svc-icon">📊</div>
      <div class="svc-name">상권 리스크 검증</div>
      <div class="svc-desc">업종별 경쟁 과밀도, 매출 하락 구간, 유동인구 데이터 기반 리스크 분석</div>
      <span class="svc-tag">핵심 서비스</span>
      <div class="svc-arrow">→</div>
    </div>
    <div class="svc-card c-teal" onclick="scrollToSearch()">
      <div class="svc-icon">🏗</div>
      <div class="svc-name">법규·인허가 검증</div>
      <div class="svc-desc">용도지역 위반 여부, 영업허가 조건, 건축법 시행령 기준 즉시 확인</div>
      <span class="svc-tag">땅쓸모 엔진</span>
      <div class="svc-arrow">→</div>
    </div>
    <div class="svc-card c-orange" onclick="showToast('핫트렌드 서비스는 준비 중입니다')">
      <div class="svc-icon">🔥</div>
      <div class="svc-name">수익성 시뮬레이션</div>
      <div class="svc-desc">보수적·기본·낙관 3가지 시나리오, BEP 기간, 3년 손익 추정</div>
      <span class="svc-tag">Coming Soon</span>
      <div class="svc-arrow">→</div>
    </div>
    <div class="svc-card c-navy" onclick="showToast('정책 가이드 서비스는 준비 중입니다')">
      <div class="svc-icon">📋</div>
      <div class="svc-name">계약서 체크리스트</div>
      <div class="svc-desc">임대차 계약 전 필수 확인 항목, 보증금 반환 조건, 특약 검토 포인트</div>
      <span class="svc-tag">Coming Soon</span>
      <div class="svc-arrow">→</div>
    </div>
  </div>
</section>

<!-- INFO -->
<section class="info-section">
  <div class="info-grid">
    <div class="info-card">
      <div class="info-card-title">📢 공지사항 <span class="info-more">더보기 ></span></div>
      <div class="notice-list">
        <div class="notice-item"><span class="notice-badge nb-notice">공지</span><span class="notice-text">창업지도 v6.0 — "계약 전 보증금 보호 검증기" 포지셔닝 전환</span><span class="notice-date">2026.02.26</span></div>
        <div class="notice-item"><span class="notice-badge nb-update">업데이트</span><span class="notice-text">PDF 샘플 미리보기 + 29,000/49,000원 가격 티어 도입</span><span class="notice-date">2026.02.24</span></div>
        <div class="notice-item"><span class="notice-badge nb-event">이벤트</span><span class="notice-text">정밀 리포트 런칭 기념 50% 할인 — 이번 주 한정</span><span class="notice-date">2026.02.20</span></div>
        <div class="notice-item"><span class="notice-badge nb-notice">공지</span><span class="notice-text">데이터 출처 및 면책 고지 안내</span><span class="notice-date">2026.02.15</span></div>
      </div>
    </div>
    <div class="info-card">
      <div class="info-card-title">⚡ 바로가기</div>
      <div class="quick-grid">
        <div class="quick-link" onclick="scrollToSearch()"><span class="ql-icon">🛡</span>리스크 검증</div>
        <div class="quick-link" onclick="scrollToSearch()"><span class="ql-icon">📊</span>상권 분석</div>
        <div class="quick-link" onclick="scrollToSearch()"><span class="ql-icon">⚖️</span>규제 확인</div>
        <div class="quick-link" onclick="scrollToSearch()"><span class="ql-icon">🏠</span>매물 찾기</div>
        <div class="quick-link" onclick="showToast('소상공인365로 이동합니다')"><span class="ql-icon">🔗</span>소상공인365</div>
        <div class="quick-link" onclick="showToast('소상공인24로 이동합니다')"><span class="ql-icon">🔗</span>소상공인24</div>
      </div>
    </div>
  </div>
</section>

<!-- HOW IT WORKS -->
<section class="how-section" id="howSection">
  <div class="services-title" style="margin-top:40px;">📌 검증 프로세스</div>
  <div class="services-sub">계약 전 6단계 보증금 보호 검증</div>
  <div class="how-grid">
    <div class="how-card"><div class="how-num">1</div><div class="how-icon">🎯</div><div class="how-name">업종 매칭</div><div class="how-desc">지역·자본 기반 추천</div></div>
    <div class="how-card"><div class="how-num">2</div><div class="how-icon">🚨</div><div class="how-name">리스크 탐지</div><div class="how-desc">4대 지표 + 경고장</div></div>
    <div class="how-card"><div class="how-num">3</div><div class="how-icon">⚖️</div><div class="how-name">법규 검토</div><div class="how-desc">건축법·식품위생법</div></div>
    <div class="how-card"><div class="how-num">4</div><div class="how-icon">💰</div><div class="how-name">수익 검증</div><div class="how-desc">시뮬레이션 + 등급</div></div>
    <div class="how-card"><div class="how-num">5</div><div class="how-icon">🏠</div><div class="how-name">매물 확인</div><div class="how-desc">전문가 연결</div></div>
    <div class="how-card"><div class="how-num">★</div><div class="how-icon">📋</div><div class="how-name">정밀 리포트</div><div class="how-desc">계약 전 최종 체크</div></div>
  </div>
</section>

<!-- LOADING -->
<div class="loading" id="loadingArea">
  <div class="loading-ring"></div>
  <div class="loading-title" id="loadingMsg">리스크 탐지 중...</div>
  <div class="loading-sub">계약 전 확인해야 할 항목을 검사합니다</div>
  <div class="load-stages">
    <div class="load-stage" id="ls1"><span class="load-dot"></span>업종·상권 데이터 로딩</div>
    <div class="load-stage" id="ls2"><span class="load-dot"></span>경쟁 과밀도 분석</div>
    <div class="load-stage" id="ls3"><span class="load-dot"></span>건축법·인허가 조건 확인</div>
    <div class="load-stage" id="ls4"><span class="load-dot"></span>수익 시뮬레이션</div>
    <div class="load-stage" id="ls5"><span class="load-dot"></span>리스크 경고 항목 생성</div>
  </div>
</div>

<!-- v6: CRITICAL 전역 배너 (결과 위에 표시) -->
<div id="criticalBanner"></div>

<!-- RESULT AREA -->
<div id="result-area">
  <div class="progress-bar" id="progressBar">
    <div class="pb-step active" onclick="goStep(1)"><span class="pb-num">1</span>업종 선택</div><span class="pb-arrow">›</span>
    <div class="pb-step" onclick="goStep(2)"><span class="pb-num">2</span>리스크 탐지</div><span class="pb-arrow">›</span>
    <div class="pb-step" onclick="goStep(3)"><span class="pb-num">3</span>법규 검토</div><span class="pb-arrow">›</span>
    <div class="pb-step" onclick="goStep(4)"><span class="pb-num">4</span>수익 검증</div><span class="pb-arrow">›</span>
    <div class="pb-step" onclick="goStep(5)"><span class="pb-num">5</span>매물·상담</div>
  </div>

  <!-- STEP 1 -->
  <div class="result-section active" id="step1">
    <div class="sec-header">
      <div class="sec-tags"><span class="sec-tag sec-tag-dark" id="bizTag"></span><span class="sec-tag sec-tag-area" id="areaTag"></span></div>
      <div class="sec-title" id="recTitle"></div>
      <div class="sec-sub" id="recSub"></div>
    </div>
    <div class="rec-cards" id="recCards"></div>
    <div class="sec-nav"><div></div><button class="sn-btn primary" onclick="goStep(2)" id="toStep2Btn" disabled>리스크 탐지 시작 →</button></div>
  </div>

  <!-- STEP 2 -->
  <div class="result-section" id="step2">
    <div class="sec-header">
      <div class="sec-title" id="step2Title" style="font-size:18px;"></div>
      <div class="sec-sub">수익성과 실현가능성을 분리해 분석합니다. 이 두 점수의 차이가 핵심 리스크입니다.</div>
    </div>

    <!-- 실제 공공데이터 결과 박스 -->
    <div id="realDataBox" style="display:none;"></div>

    <!-- v6: 이중 점수 -->
    <div class="dual-score-grid" id="dualScoreGrid"></div>
    <div id="dualScoreGapWarning"></div>

    <!-- 4대 지표 -->
    <div class="quad-scores" id="quadScores"></div>
    <div id="totalScoreArea"></div>

    <!-- v6: 리스크 경고장 -->
    <div id="riskReportBox"></div>

    <div class="card" style="margin-top:16px;">
      <div class="card-title"><div class="card-icon">📋</div>계약 전 필수 확인 항목</div>
      <div class="deduction-list" id="deductionList"></div>
      <div class="score-logic-note">Score Logic: 입지(30%) + 경쟁(25%) + 규제(25%) + 수익(20%) — 규제 과락(30점 미만) 시 18점 이하 강제 적용 | 출처: 소상공인진흥공단 상권분석 DB</div>
    </div>
    <div class="analysis-grid" style="margin-top:16px;">
      <div class="card"><div class="card-title"><div class="card-icon">📍</div>경쟁 현황</div><div id="compList"></div></div>
      <div class="card"><div class="card-title"><div class="card-icon">💡</div>인사이트</div><div class="insight-list" id="insightList"></div></div>
    </div>
    <div class="compare-banner">
      <div><div class="compare-title">🔍 다른 선택지와 비교</div><div class="compare-desc">하나의 결과로는 판단하기 어렵습니다.</div></div>
      <div class="compare-btns"><button class="compare-btn" onclick="showToast('비교 기능 준비 중')">이 업종 × 다른 지역</button><button class="compare-btn outline" onclick="showToast('비교 기능 준비 중')">이 지역 × 다른 업종</button></div>
    </div>
    <div class="sec-nav"><button class="sn-btn" onclick="goStep(1)">← 업종 변경</button><button class="sn-btn primary" onclick="goStep(3)">법규 검토 →</button></div>
  </div>

  <!-- STEP 3 -->
  <div class="result-section" id="step3">
    <div class="land-bridge">
      <div class="lb-eyebrow">Powered by 땅쓸모</div>
      <div class="lb-title" id="landTitle"></div>
      <div class="lb-desc" id="landDesc"></div>
      <div class="admin-term-box" id="adminTermBox"></div>
    </div>
    <div class="card">
      <div class="card-title"><div class="card-icon">📍</div>용도지역별 허용 여부</div>
      <div class="zone-grid" id="zoneGrid"></div>
      <div style="margin-top:12px;padding:10px 14px;background:var(--yellow-light);border:1px solid #fde68a;border-radius:var(--r);font-size:11px;color:var(--muted);">⚠️ 지자체 조례에 따라 추가 제한이 있을 수 있습니다. 최종 허가 여부는 해당 시·군·구청 건축과에 확인하시기 바랍니다.</div>
    </div>
    <div class="card">
      <div class="card-title"><div class="card-icon">✅</div>인허가 체크리스트</div>
      <div class="permit-grid" id="permitGrid"></div>
    </div>
    <div id="inlineConsultBanner"></div>
    <div class="card">
      <div class="card-title"><div class="card-icon">💰</div>예상 창업비용 <span id="pyungLabel" style="font-size:10px;font-weight:700;color:var(--blue);background:var(--blue-light);padding:2px 8px;border-radius:100px;margin-left:6px;"></span></div>
      <div class="pyung-control"><label style="font-size:13px;color:var(--muted);">예상 평수</label><input type="number" class="pyung-input" id="pyungInput" value="20" min="5" max="300" oninput="updateCosts()"><span style="font-size:13px;color:var(--muted);">평</span><span style="font-size:11px;color:var(--light);margin-left:auto;">변경 시 재계산</span></div>
      <div id="costTable"></div>
    </div>
    <div class="sec-nav"><button class="sn-btn" onclick="goStep(2)">← 리스크 탐지</button><button class="sn-btn primary" onclick="goStep(4)">수익 검증 →</button></div>
  </div>

  <!-- STEP 4 -->
  <div class="result-section" id="step4">
    <div class="sec-header"><div class="sec-title" style="font-size:18px;" id="step4Title"></div></div>
    <div class="card">
      <div class="card-title"><div class="card-icon">💰</div>월 순이익 시뮬레이션</div>
      <div class="revenue-grid" id="revGrid"></div>
      <div style="margin-top:12px;padding:10px 14px;background:var(--surface2);border-radius:var(--r);font-size:12px;color:var(--muted);line-height:1.7;" id="revNote"></div>
      <div class="yearly-rev-section">
        <div class="yr-title">📅 연도별 예상 매출 <span style="font-size:11px;font-weight:500;color:var(--muted);">(무료: 1년차만 공개)</span></div>
        <div class="yr-grid" id="yrGrid"></div>
      </div>
      <div style="margin-top:14px;">
        <div style="font-size:13px;font-weight:800;color:var(--navy);margin-bottom:8px;">📊 월 고정비 상세 내역</div>
        <div class="fixed-cost-locked">
          <div class="fixed-cost-content" id="fixedCostContent"></div>
          <div class="fixed-cost-overlay" onclick="showToast('정밀 리포트에서 확인 — 29,000원 / 49,000원')">
            <span style="font-size:18px;">🔒</span>
            <span class="fco-text">정밀 리포트에서 전체 공개</span>
          </div>
        </div>
      </div>
    </div>
    <div id="bepArea"></div>
    <div id="finalGradeArea"></div>

    <!-- v6: 프리미엄 — 요약본 잠금 해제 + PDF 샘플 + 가격 2티어 -->
    <div class="premium-section-wrapper">
      <div class="ps-lock-notice">
        <div class="ps-lock-title">🔒 현재 보고 계신 내용은 요약 분석입니다</div>
        <div class="ps-lock-desc">정밀 리포트에는 3년 손익 시뮬레이션, 월 고정비 전체 내역, 인허가 체크리스트 PDF, 경쟁 매장 상세 매출 추정이 포함됩니다.</div>
      </div>
      <div class="pcu-box">
        <div class="pcu-eyebrow">⚠ 계약 전 필수 확인</div>
        <div class="pcu-title">이 리포트 없이 계약하면<br>어떤 리스크가 있는지 확인하세요</div>
        <div class="pcu-desc">계약 후 발견된 법적 리스크와 경쟁 위협은 돌이킬 수 없습니다. 29,000원이 수천만 원을 지킵니다.</div>

        <!-- PDF 샘플 미리보기 -->
        <div class="pdf-preview-strip" id="pdfPreview"></div>
        <div class="pdf-sample-caption">▲ 실제 리포트 샘플 (3/10 페이지 미리보기) — 나머지는 구매 후 확인</div>

        <!-- 가격 2티어 -->
        <div class="price-tiers">
          <div class="price-tier" onclick="generateReport('basic')">
            <div class="pt-label">기본 리포트</div>
            <div class="pt-name">PDF 정밀 분석</div>
            <div class="pt-items">
              <span>3년 손익 시뮬레이션 (3개 시나리오)</span>
              <span>월 고정비 항목별 전체 공개</span>
              <span>인허가 체크리스트 PDF (12항목)</span>
              <span>경쟁사 매출 추정 비교</span>
            </div>
            <div class="pt-price-row">
              <div class="pt-price">29,000원</div>
              <div class="pt-orig">59,000원</div>
            </div>
          </div>
          <div class="price-tier recommended" onclick="generateReport('premium')">
            <div class="pt-label">계약 직전 정밀 분석 <span class="pt-badge">추천</span></div>
            <div class="pt-name">PDF + 전문가 상담 15분</div>
            <div class="pt-items">
              <span>기본 리포트 전체 포함</span>
              <span>전문가 1:1 상담 15분</span>
              <span>계약서 특약 검토 포인트</span>
              <span>보증금 반환 리스크 체크</span>
            </div>
            <div class="pt-price-row">
              <div class="pt-price">49,000원</div>
              <div class="pt-orig">99,000원</div>
            </div>
          </div>
        </div>

        <div class="pcu-cta-row">
          <button class="pcu-btn-main" onclick="generateReport('premium')">
            <span>📋</span> 계약 전 필수 확인: 정밀 리포트 열기
          </button>
          <button class="pcu-btn-sec" onclick="generateReport('basic')">무료 요약 리포트 받기</button>
        </div>
        <!-- v6: 사회적 증거 (scarcity) -->
        <div class="scarcity-note">이번 달 <em>312건의 계약 리스크 사전 검증</em> 완료 · 공공데이터포털 API 기반</div>
      </div>
    </div>

    <div class="sec-nav"><button class="sn-btn" onclick="goStep(3)">← 법규 검토</button><button class="sn-btn primary" onclick="goStep(5)">매물 & 상담 →</button></div>
  </div>

  <!-- STEP 5 -->
  <div class="result-section" id="step5">
    <div class="card" style="margin-bottom:16px;">
      <div class="card-title"><div class="card-icon">🏠</div>추천 매물</div>
      <div class="property-grid" id="propGrid"></div>
    </div>
    <div class="expert-consult-card">
      <div class="ecc-eyebrow">Premium Consulting</div>
      <div class="ecc-title">전문가 1:1 리스크 정밀 진단</div>
      <div class="ecc-desc">공인중개사·건축사·행정사가 계약서 검토부터 인허가 완료까지 함께합니다.<br>정밀 리포트 구매자에게는 상담료 50% 할인이 적용됩니다.</div>
      <div class="ecc-tiers">
        <div class="ecc-tier">
          <div class="ecc-tier-label">기본 상담</div>
          <div class="ecc-tier-title">무료 30분 상담</div>
          <div class="ecc-tier-desc">현황 파악 및 분석 결과 설명. 전화 또는 화상.</div>
          <div class="ecc-tier-price">무료</div>
        </div>
        <div class="ecc-tier premium-tier">
          <div class="ecc-tier-label">🔵 리포트 구매자 전용</div>
          <div class="ecc-tier-title">계약서 정밀 검토</div>
          <div class="ecc-tier-desc">임대차 계약서 전항목 검토 + 리스크 협의 지원.</div>
          <div class="ecc-tier-price">50,000원 → 25,000원</div>
        </div>
      </div>
      <div class="ecc-btns">
        <button class="ecc-btn-main" onclick="showToast('상담 접수 완료! 24시간 내 연락드립니다')">🤝 무료 상담 신청</button>
        <button class="ecc-btn-sec" onclick="showToast('정밀 리포트 결제 페이지 준비 중')">⚠ 리포트 후 할인 상담</button>
        <button class="ecc-btn-sec" onclick="restart()">🔄 다시 검증</button>
      </div>
    </div>
  </div>
</div><!-- /result-area -->

<div class="data-source-bar">
  <span>Data Source:</span> 국토교통부 v-world API · 소상공인진흥공단 상권분석 DB · 건축물대장 API · 국토교통부 LURIS 토지이용규제정보 · 행정안전부 인허가 데이터포털 · 통계청 소매업 임대료 분위 통계<br>
  본 서비스는 참고용이며 법적 효력이 없습니다. 최종 인허가 여부는 해당 시·군·구청에서 확인하세요. | © 2026 창업지도 (changupjido.kr)
</div>
<footer>
  <div class="footer-inner">
    <div class="footer-logo">🧭 창업지도 — 계약 전 보증금 보호 검증기</div>
    <div class="footer-links"><a href="#">이용약관</a><a href="#">개인정보처리방침</a><a href="#">데이터 출처</a><a href="#">고객센터</a></div>
    <div style="line-height:1.8;">본 서비스는 참고용 정보이며 법적 효력이 없습니다. 데이터 출처: 국토교통부 LURIS · 소상공인시장진흥공단 | 토지 분석: 땅쓸모 | © 2026 창업지도</div>
  </div>
</footer>

<div class="toast" id="toast"></div>

<script>
/* ═══════════════════════════════════
   DB (v6 — riskReport + adminTerm 완비)
═══════════════════════════════════ */
const BIZ_DB={
  카페:{
    icon:'☕',type:'음료 전문점',badge:'rb-top',badgeText:'인기',
    profitScore:72,locationScore:85,competitionScore:42,regulationScore:90,revenueScore:72,regulationFail:false,
    costMin:3500,costMax:13000,basePyung:15,
    revPess:280,revBase:520,revOpt:840,
    revNote:'객단가 8,000원, 일 방문객 40~120명 기준. 고정비 월 350만원 가정.',
    competitors:['스타벅스 강남역점 (82m)','이디야커피 (120m)','메가MGC커피 (200m)','개인카페 3곳 (300m)'],
    compRating:['4.2','3.8','4.0','—'],
    insights:[
      {type:'positive',icon:'📈',title:'유동인구 많음',desc:'하루 12만명+. 커피 소비 지수 전국 상위 5%.'},
      {type:'negative',icon:'🔴',title:'레드오션 경고',desc:'반경 500m 내 카페 8개. 상위 10% 매출 업체 3개 포진.'},
      {type:'positive',icon:'🎯',title:'20-30대 타깃',desc:'주요 소비층 61%. 브런치·스페셜티 수요 높음.'}
    ],
    deductions:[
      {type:'green',icon:'✅',text:'유동인구 12만+ (일일 승하차)',score:'+15',tip:'공공데이터포털 교통카드 빅데이터 기반'},
      {type:'red',icon:'🔴',text:'레드오션: 반경 500m 카페 8개 (상위 10% 매출 업체 3곳)',score:'-20',tip:'소상공인진흥공단 상권분석 DB 기준'},
      {type:'yellow',icon:'⚡',text:'임대료 상위 15% (지역 평균 대비 1.4배)',score:'-8',tip:'통계청 소매업 임대료 분위 통계'},
      {type:'green',icon:'✅',text:'타깃층(20-30대) 61%',score:'+10',tip:'행정안전부 주민등록 인구통계'},
      {type:'green',icon:'✅',text:'규제 통과: 근린상업지역 기준 충족',score:'+0',tip:'국토교통부 LURIS 토지이용규제정보'}
    ],
    riskReport:[
      {level:'critical',icon:'⛔',title:'레드오션: 반경 500m 카페 8개 — 상위 매출 업체 3곳 포진',desc:'경쟁 밀도 과밀 시 객단가 15~20% 하락. 차별화 없이 진입 시 3개월 내 BEP 미달 확률 62%.',law:'소상공인 상권분석 DB 경쟁 과밀 임계값 초과',tip:'소상공인진흥공단 상권분석 DB 기반. 반경 500m 동종 업체 5개 초과 시 과밀 판정.',score:'-20'},
      {level:'warning',icon:'⚠️',title:'임대료 상위 15% — 지역 평균 대비 1.4배',desc:'고임대 지역에서 매출 부진 시 고정비 부담 급격히 악화. 월 매출 400만 미만 시 적자 전환.',law:'통계청 소매업 임대료 분위 통계',tip:'통계청 서비스업 조사 기반 임대료 분위.',score:'-8'},
      {level:'caution',icon:'🔶',title:'위생·소방 설비 초기 점검 필요',desc:'스팀·전기 설비 기준 미충족 시 영업 개시 30일 이내 시정 명령 가능.',law:'식품위생법 시행규칙 제36조',tip:'식품의약품안전처 식품위생법 시행규칙 별표 14 기준.',score:'주의'}
    ],
    adminTerm:{zoneName:'제2종 일반주거지역 / 근린상업지역',lawRef:'건축법 시행령 별표1 제4호 다목',condition:'바닥면적 합계 500㎡ 미만 시 허가 가능. 근린생활시설(휴게음식점)로 신고.',highlight:'휴게음식점 영업신고(식품위생법 제37조)'},
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🚗',label:'주차장',status:'warn',text:'조건부'},{icon:'🔥',label:'소방시설',status:'pass',text:'적합'},{icon:'🍽',label:'위생기준',status:'pass',text:'충족'},{icon:'🏗',label:'용도변경',status:'pass',text:'불필요'},{icon:'📐',label:'건축기준',status:'pass',text:'적합'}],
    regulations:[{ok:true,text:'휴게음식점 영업신고 가능'},{ok:true,text:'근린상업·상업지역 운영 허용'},{ok:false,text:'전용주거지역 내 영업 불가'},{ok:true,text:'바닥면적 500㎡ 미만 시 별도 허가 불요'},{ok:false,text:'위생·소방 설비 초기 현장점검 필요'}],
    areaScore:78,areaAvgScore:62,areaName:'강남구 음료점',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'ok',note:'300㎡ 미만'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'cond'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:1000,baseMax:5000,isDeposit:true},{label:'월세(첫달)',baseMin:80,baseMax:200},{label:'인테리어',baseMin:1500,baseMax:4000},{label:'에스프레소머신',fixed:true,baseMin:300,baseMax:1500},{label:'주방기기·집기',baseMin:500,baseMax:2000},{label:'인허가비',fixed:true,baseMin:20,baseMax:80}],
    fixedCosts:[{label:'임대료',min:130,max:250},{label:'인건비(파트 2명)',min:200,max:280},{label:'원재료비',min:130,max:200},{label:'관리비·공과금',min:30,max:60},{label:'플랫폼·카드수수료',min:15,max:25}],
    bepMonths:8,monthlyCost:350,yearlyRev:{y1:5200,y2:6800,y3:8100},
    properties:[{thumb:'🏪',area:'강남역 2번출구',name:'1층 상가',pyung:'18평/59㎡',price:'보증금 3,000만',rent:'월세 180만',badge:'역세권',tags:['1층','역세권','용도적합']},{thumb:'☕',area:'신논현역 인근',name:'2층 카페 전용',pyung:'22평/73㎡',price:'보증금 4,000만',rent:'월세 150만',badge:'추천',tags:['자연채광','전 카페']},{thumb:'🏬',area:'역삼동',name:'1층 코너 상가',pyung:'20평/66㎡',price:'보증금 2,500만',rent:'월세 200만',badge:'코너',tags:['코너','유동인구多']}]
  },
  고깃집:{
    icon:'🥩',type:'일반음식점',badge:'rb-stable',badgeText:'안정',
    profitScore:78,locationScore:82,competitionScore:65,regulationScore:75,revenueScore:78,regulationFail:false,
    costMin:6500,costMax:21000,basePyung:30,
    revPess:450,revBase:850,revOpt:1400,
    revNote:'객단가 35,000원, 일 30~70명. 원가율 45%, 고정비 월 600만원.',
    competitors:['원조삼겹살 (150m)','돼지왕 강남점 (200m)','개인 고깃집 2곳 (400m)'],
    compRating:['4.5','4.1','—'],
    insights:[{type:'positive',icon:'🍖',title:'직장인 회식 수요',desc:'평일 저녁 회식 수요 연중 지속.'},{type:'caution',icon:'💰',title:'초기비용 주의',desc:'환기 덕트·소방 추가 500~2,000만원 필요.'},{type:'positive',icon:'📅',title:'주말 패밀리 수요',desc:'가족 외식 비중 높음. 주말 매출 40%+.'}],
    deductions:[{type:'green',icon:'✅',text:'직장인 밀집 (회식 수요)',score:'+12',tip:'고용노동부 사업체 현황 통계'},{type:'yellow',icon:'⚡',text:'경쟁: 반경 400m 내 4곳',score:'-10',tip:'소상공인진흥공단 상권분석 DB'},{type:'green',icon:'✅',text:'패밀리·저녁 이중 수요',score:'+8',tip:'통계청 가구원수별 외식 지출 통계'},{type:'yellow',icon:'⚡',text:'환기 설비 조건부 (추가 비용)',score:'-5',tip:'다중이용업소 안전관리법 시행령 제9조'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'환기·덕트 설비 미비 시 영업정지 대상',desc:'환기 기준 미충족 시 최대 6개월 영업정지. 초기 500~2,000만원 추가 필수.',law:'다중이용업소 안전관리법 제9조',tip:'소방청 다중이용업소 안전관리 업무 처리 규정 제15조 기준.',score:'-15'},{level:'warning',icon:'⚠️',title:'300㎡ 이상 시 스프링클러 의무',desc:'스프링클러 미설치 영업 시 소방시설법 위반. 설치 비용 800~2,000만원 별도.',law:'소방시설 설치 및 관리에 관한 법률 제11조',tip:'소방시설법 시행령 별표 4 기준.',score:'-10'},{level:'caution',icon:'🔶',title:'경쟁: 반경 400m 내 동종 업소 4개',desc:'고깃집 상권 평균 대비 경쟁도 상위 30%. 회식 예약 경쟁 심화.',law:'소상공인진흥공단 상권분석 DB',tip:'소상공인진흥공단 상권분석 DB 경쟁도 분위 기준.',score:'-5'}],
    adminTerm:{zoneName:'제2종 일반주거지역 / 일반상업지역',lawRef:'식품위생법 제36조, 건축법 시행령 별표1 제7호',condition:'일반음식점 영업허가 필요. 바닥면적 300㎡ 이상 시 소방시설(스프링클러) 의무.',highlight:'일반음식점 영업허가(식품위생법 제36조)'},
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🚗',label:'주차장',status:'warn',text:'조건부'},{icon:'🔥',label:'소방시설',status:'warn',text:'보완'},{icon:'🍽',label:'위생기준',status:'pass',text:'충족'},{icon:'💨',label:'환기설비',status:'warn',text:'조건부'},{icon:'📐',label:'건축기준',status:'pass',text:'적합'}],
    regulations:[{ok:true,text:'일반음식점 영업허가 신청 가능'},{ok:false,text:'300㎡ 이상 시 스프링클러 설치 의무'},{ok:false,text:'환기·덕트 설비 기준 현장 확인 필요'},{ok:true,text:'일반주거지역 이상 영업 허용'},{ok:false,text:'다중이용업소 안전관리 계획서 제출 필요'}],
    areaScore:82,areaAvgScore:59,areaName:'강남구 한식당',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'cond',note:'300㎡ 미만'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok',note:'최적'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'cond'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:2000,baseMax:8000,isDeposit:true},{label:'월세(첫달)',baseMin:150,baseMax:400},{label:'인테리어',baseMin:3000,baseMax:8000},{label:'환기·덕트',baseMin:500,baseMax:2000},{label:'냉장·조리기기',fixed:true,baseMin:500,baseMax:1500},{label:'인허가·소방',fixed:true,baseMin:50,baseMax:150}],
    fixedCosts:[{label:'임대료',min:200,max:400},{label:'인건비(직원 3명)',min:350,max:500},{label:'식자재비',min:280,max:420},{label:'관리비·공과금',min:50,max:90},{label:'카드수수료·기타',min:20,max:35}],
    bepMonths:10,monthlyCost:600,yearlyRev:{y1:8500,y2:10200,y3:12000},
    properties:[{thumb:'🍖',area:'강남역 6번출구',name:'지하1층 음식점',pyung:'35평/116㎡',price:'보증금 5,000만',rent:'월세 250만',badge:'추천',tags:['환기가능','전 식당']},{thumb:'🏬',area:'역삼역 인근',name:'2층 음식점',pyung:'40평/132㎡',price:'보증금 4,000만',rent:'월세 220만',badge:'넓이',tags:['넓은홀','주차편리']},{thumb:'🥩',area:'신논현 먹자골목',name:'1층 근린상업',pyung:'28평/92㎡',price:'보증금 3,500만',rent:'월세 280만',badge:'먹자골목',tags:['집객용이','권리금低']}]
  },
  편의점:{
    icon:'🏪',type:'소매업/근린시설',badge:'rb-stable',badgeText:'안정',
    profitScore:65,locationScore:80,competitionScore:35,regulationScore:95,revenueScore:55,regulationFail:false,
    costMin:3500,costMax:10000,basePyung:20,
    revPess:180,revBase:320,revOpt:480,
    revNote:'일 매출 60~160만원. 가맹 수수료 35% 차감 기준.',
    competitors:['GS25 강남점 (80m)','CU 역삼점 (150m)','세븐일레븐 (220m)'],
    compRating:['4.0','4.1','3.9'],
    insights:[{type:'positive',icon:'🚶',title:'24시간 유동인구',desc:'역세권 심야 수요 안정적.'},{type:'negative',icon:'🔴',title:'편의점 포화',desc:'200m 내 3개. 가맹 본사 상권 보호 정책 확인 필수.'},{type:'positive',icon:'🏢',title:'오피스 수요',desc:'점심·간식 집중. 도시락·음료 비중 높음.'}],
    deductions:[{type:'green',icon:'✅',text:'24시간 유동인구',score:'+10',tip:'서울시 교통카드 빅데이터'},{type:'red',icon:'🔴',text:'포화: 200m 내 3개 (가맹 보호 정책 검토 필요)',score:'-15',tip:'공정거래위원회 가맹사업 정보공개서 기준'},{type:'green',icon:'✅',text:'오피스 밀집 (점심 수요)',score:'+8',tip:'통계청 사업체통계조사'},{type:'green',icon:'✅',text:'규제 통과',score:'+5',tip:'국토교통부 LURIS 기준'}],
    riskReport:[{level:'critical',icon:'⛔',title:'가맹 상권 보호 미적용 구역 — 계약 전 반드시 확인',desc:'상권 보호 미적용 시 200m 내 동일 브랜드 추가 출점 허용. 계약서 제7~9조 필수 확인.',law:'가맹사업거래의 공정화에 관한 법률 제12조의2',tip:'공정거래위원회 가맹사업법 제12조의2 영업지역 보장 조항.',score:'-15'},{level:'warning',icon:'⚠️',title:'정보공개서 14일 열람 의무 미준수 시 계약 무효',desc:'가맹계약 체결 전 14일간 열람 미준수 시 계약 취소 가능.',law:'가맹사업법 제7조',tip:'공정거래위원회 가맹사업 표준약관 제4조 적용.',score:'주의'},{level:'caution',icon:'🔶',title:'200m 내 경쟁 편의점 3개 — 상권 분할 리스크',desc:'동일 상권 내 편의점 과밀. 일 매출 목표 달성 확률 40% 이하.',law:'소상공인진흥공단 소매업 상권분석 기준',tip:'소상공인진흥공단 소매업 상권분석 DB 기준.',score:'-8'}],
    adminTerm:{zoneName:'근린상업지역 / 제1~3종 일반주거지역',lawRef:'유통산업발전법 제8조, 가맹사업법 제5조',condition:'근린생활시설(소매점)로 신고. 바닥면적 무관. 가맹 계약 전 정보공개서 14일 열람 의무.',highlight:'편의점 가맹사업(가맹사업법 제5조, 정보공개서 14일)'},
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🚗',label:'주차장',status:'pass',text:'면제'},{icon:'🔥',label:'소방시설',status:'pass',text:'적합'},{icon:'🍽',label:'위생기준',status:'pass',text:'충족'},{icon:'🏗',label:'용도변경',status:'pass',text:'불필요'},{icon:'📐',label:'가맹심사',status:'pass',text:'통과'}],
    regulations:[{ok:true,text:'근린생활시설(소매점)로 신고 가능'},{ok:true,text:'대부분 용도지역에서 영업 허용'},{ok:false,text:'가맹계약 체결 전 정보공개서 14일 열람 의무'},{ok:false,text:'상권 보호 조항(200m 이내 동일 브랜드 출점 금지) 계약서 확인 필수'},{ok:true,text:'소방·위생 기준 충족 용이'}],
    areaScore:70,areaAvgScore:55,areaName:'강남구 소매점',
    zones:[{name:'제1종 전용주거',status:'ok'},{name:'제2종 전용주거',status:'ok'},{name:'제1종 일반주거',status:'ok'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'cond'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'가맹비',fixed:true,baseMin:500,baseMax:1500},{label:'보증금',baseMin:1000,baseMax:3000,isDeposit:true},{label:'월세(첫달)',baseMin:100,baseMax:300},{label:'인테리어·집기',baseMin:500,baseMax:2000},{label:'초도물품비',fixed:true,baseMin:1000,baseMax:2000}],
    fixedCosts:[{label:'임대료',min:100,max:300},{label:'인건비(야간알바)',min:120,max:200},{label:'가맹수수료',min:60,max:90},{label:'관리비·공과금',min:25,max:50},{label:'기타 운영비',min:15,max:25}],
    bepMonths:12,monthlyCost:250,yearlyRev:{y1:3200,y2:3800,y3:4200},
    properties:[{thumb:'🏪',area:'역세권 지하',name:'지하 코너 상가',pyung:'22평/73㎡',price:'보증금 2,000만',rent:'월세 160만',badge:'입지',tags:['지하유동인구','코너']},{thumb:'🏬',area:'오피스 인근',name:'오피스 1층',pyung:'18평/59㎡',price:'보증금 1,500만',rent:'월세 140만',badge:'오피스',tags:['직장인밀집','점심수요']},{thumb:'🚶',area:'주택가 인근',name:'주택가 근린상업',pyung:'20평/66㎡',price:'보증금 1,200만',rent:'월세 120만',badge:'주거지',tags:['경쟁적음','야간수요']}]
  },
  치킨집:{
    icon:'🍗',type:'일반음식점 (배달+홀)',badge:'rb-top',badgeText:'인기',
    profitScore:72,locationScore:74,competitionScore:75,regulationScore:78,revenueScore:72,regulationFail:false,
    costMin:4500,costMax:15000,basePyung:18,
    revPess:350,revBase:650,revOpt:1050,
    revNote:'객단가 25,000원. 배달 70%+홀 30%. 배달앱 수수료 20~25% 차감.',
    competitors:['BBQ 인근점','교촌치킨 인근','bhc치킨 인근','개인 치킨집'],
    compRating:['4.2','4.1','4.0','—'],
    insights:[{type:'positive',icon:'📦',title:'배달 중심 운영 가능',desc:'홀 없이 배달 전용으로 초기비용 절감. 배달의민족·쿠팡이츠 주문 안정.'},{type:'negative',icon:'🔴',title:'플랫폼 수수료 부담',desc:'배달앱 수수료 15~25%. 광고비 포함 시 실질 마진 10~15%.'},{type:'positive',icon:'🌙',title:'야식 수요 연중 강함',desc:'오후 6시~자정 매출 집중. 주말·명절 수요 급증.'}],
    deductions:[{type:'green',icon:'✅',text:'배달 수요 연중 안정',score:'+12',tip:'배달 플랫폼 통계'},{type:'red',icon:'🔴',text:'배달 수수료 20~25% — 순이익 압박',score:'-12',tip:'공정거래위원회 배달플랫폼 수수료 실태'},{type:'yellow',icon:'⚡',text:'반경 1km 내 동종 업소 경쟁',score:'-8',tip:'소상공인진흥공단 상권분석 DB'},{type:'green',icon:'✅',text:'브랜드 가맹 시 마케팅 지원',score:'+8',tip:'가맹본부 브랜드 인지도 활용'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'배달 플랫폼 수수료 15~25% — 수익 구조 악화',desc:'입점·중개·광고비 합산 시 실질 마진 10~15%. 월 매출 700만 미만 적자 위험.',law:'전자상거래법 제13조',tip:'공정거래위원회 배달플랫폼 수수료 실태조사.',score:'-12'},{level:'warning',icon:'⚠️',title:'상권 내 치킨집 과밀',desc:'반경 1km 내 동종 5개 이상 시 주문 분산. 플랫폼 광고 없이 노출 급감.',law:'소상공인진흥공단 상권분석',tip:'소상공인진흥공단 배달업종 경쟁도 기준.',score:'-8'},{level:'caution',icon:'🔶',title:'환기·위생 설비 초기 점검',desc:'튀김기·환기 기준 미충족 시 위생점검 불합격 가능.',law:'식품위생법 시행규칙 제36조',tip:'식품의약품안전처 기준.',score:'주의'}],
    adminTerm:{zoneName:'제2종 일반주거지역 이상',lawRef:'식품위생법 제36조',condition:'일반음식점 영업허가. 환기·소방 기준 충족 필요.',highlight:'일반음식점 영업허가(식품위생법 제36조)'},
    regulations:[{ok:true,text:'일반음식점 영업허가 가능'},{ok:false,text:'환기·덕트 설비 기준 충족 여부 확인 필요'},{ok:true,text:'상업·주거지역 대부분 영업 허용'},{ok:false,text:'배달 앱 입점 시 플랫폼 수수료 계약 조건 확인'},{ok:true,text:'위생관리자 지정 불필요 (소규모)'}],
    permits:[{icon:'📋',label:'영업허가',status:'pass',text:'가능'},{icon:'🚗',label:'주차',status:'warn',text:'조건부'},{icon:'🔥',label:'소방',status:'pass',text:'적합'},{icon:'🍽',label:'위생',status:'pass',text:'충족'},{icon:'💨',label:'환기',status:'warn',text:'조건부'},{icon:'📦',label:'배달신고',status:'pass',text:'가능'}],
    areaScore:74,areaAvgScore:60,areaName:'주거·상업지역 치킨',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'cond',note:'300㎡ 미만'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'cond'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'가맹비(브랜드)',fixed:true,baseMin:500,baseMax:2000},{label:'보증금',baseMin:1000,baseMax:5000,isDeposit:true},{label:'월세',baseMin:80,baseMax:250},{label:'인테리어',baseMin:1500,baseMax:4000},{label:'튀김기·주방기기',fixed:true,baseMin:500,baseMax:1500},{label:'인허가비',fixed:true,baseMin:30,baseMax:80}],
    fixedCosts:[{label:'임대료',min:100,max:250},{label:'인건비',min:150,max:280},{label:'식자재비',min:200,max:350},{label:'배달플랫폼 수수료',min:80,max:150},{label:'관리비·공과금',min:30,max:60}],
    bepMonths:9,monthlyCost:420,yearlyRev:{y1:6800,y2:8200,y3:9500},
    properties:[{thumb:'🍗',area:'주택가 인근',name:'1층 근린상가',pyung:'15평/50㎡',price:'보증금 2,000만',rent:'월세 120만',badge:'주거지',tags:['배달최적','경쟁적음']},{thumb:'🏬',area:'오피스 인근',name:'1층 상가',pyung:'18평/59㎡',price:'보증금 2,500만',rent:'월세 150만',badge:'오피스',tags:['점심수요','야식수요']},{thumb:'🎓',area:'대학가',name:'2층 홀+배달',pyung:'22평/73㎡',price:'보증금 1,800만',rent:'월세 140만',badge:'대학가',tags:['야식수요강','주문多']}]
  },
  분식집:{
    icon:'🍜',type:'휴게음식점',badge:'rb-stable',badgeText:'안정',
    profitScore:68,locationScore:76,competitionScore:55,regulationScore:85,revenueScore:65,regulationFail:false,
    costMin:2000,costMax:8000,basePyung:15,
    revPess:220,revBase:420,revOpt:680,
    revNote:'객단가 8,000원. 점심 회전율 5~10회전. 원가율 38~42%.',
    competitors:['김밥천국','본죽 인근','개인 분식집 다수'],
    compRating:['4.0','4.1','—'],
    insights:[{type:'positive',icon:'💰',title:'낮은 초기비용',desc:'소규모 창업 가능. 초기 투자 2,000~5,000만원 수준.'},{type:'positive',icon:'🔄',title:'높은 점심 회전율',desc:'주변 직장인·학생 점심 수요 안정.'},{type:'caution',icon:'⚡',title:'단가 낮아 박리다매 구조',desc:'일 100명+ 방문 시 흑자. 입지 의존도 높음.'}],
    deductions:[{type:'green',icon:'✅',text:'낮은 초기비용·진입 장벽',score:'+10',tip:'소상공인 창업 지원 DB'},{type:'yellow',icon:'⚡',text:'단가 낮음 — 박리다매 필수',score:'-8',tip:'통계청 외식업 업종별 객단가'},{type:'green',icon:'✅',text:'점심 수요 안정적',score:'+8',tip:'행정안전부 유동인구 통계'},{type:'yellow',icon:'⚡',text:'경쟁 업소 多 — 차별화 필요',score:'-5',tip:'소상공인진흥공단 상권분석'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'입지 의존도 높음 — 유동인구 필수',desc:'일 유동인구 500명 미만 구역에서 분식집 흑자 달성 어려움. 임대료 대비 매출 비율 20% 이하 유지 필요.',law:'소상공인진흥공단 창업 가이드',tip:'소상공인진흥공단 업종별 매출 통계.',score:'-8'},{level:'caution',icon:'🔶',title:'위생 관리 기준 강화',desc:'도마·조리도구 색상 구분 등 위생점검 항목 대폭 강화.',law:'식품위생법 시행규칙 별표14',tip:'식품의약품안전처 음식점 위생등급제 기준.',score:'주의'}],
    adminTerm:{zoneName:'제1종 일반주거지역 이상',lawRef:'식품위생법 제37조',condition:'휴게음식점 영업신고. 소규모(100㎡ 미만) 진입 장벽 낮음.',highlight:'휴게음식점 영업신고(식품위생법 제37조)'},
    regulations:[{ok:true,text:'휴게음식점 영업신고 가능'},{ok:true,text:'대부분 용도지역 영업 허용'},{ok:true,text:'소방·위생 기준 충족 용이'},{ok:false,text:'위생등급제 대비 정기 위생점검 준비 필요'},{ok:true,text:'소규모 시 주차 기준 면제'}],
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🚗',label:'주차',status:'pass',text:'면제'},{icon:'🔥',label:'소방',status:'pass',text:'적합'},{icon:'🍽',label:'위생',status:'pass',text:'충족'},{icon:'🏗',label:'용도',status:'pass',text:'불필요'},{icon:'📐',label:'건축',status:'pass',text:'적합'}],
    areaScore:72,areaAvgScore:58,areaName:'주거·상권 분식',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'ok',note:'100㎡ 미만'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:500,baseMax:3000,isDeposit:true},{label:'월세',baseMin:50,baseMax:150},{label:'인테리어',baseMin:500,baseMax:2000},{label:'주방기기·집기',fixed:true,baseMin:300,baseMax:800},{label:'초도식자재',fixed:true,baseMin:100,baseMax:300},{label:'인허가비',fixed:true,baseMin:10,baseMax:30}],
    fixedCosts:[{label:'임대료',min:60,max:180},{label:'인건비(파트 1명)',min:120,max:200},{label:'식자재비',min:100,max:200},{label:'관리비·공과금',min:20,max:40},{label:'기타 운영비',min:10,max:20}],
    bepMonths:6,monthlyCost:220,yearlyRev:{y1:4200,y2:5100,y3:6000},
    properties:[{thumb:'🍜',area:'학교·직장 인근',name:'1층 소규모',pyung:'12평/40㎡',price:'보증금 1,000만',rent:'월세 80만',badge:'입지',tags:['유동인구多','점심수요']},{thumb:'🏬',area:'시장 상권',name:'시장 내 상가',pyung:'10평/33㎡',price:'보증금 500만',rent:'월세 60만',badge:'시장',tags:['고객충성','시장수요']},{thumb:'🚶',area:'주택가',name:'주택가 1층',pyung:'15평/50㎡',price:'보증금 800만',rent:'월세 70만',badge:'주거지',tags:['경쟁적음','안정수요']}]
  },
  베이커리:{
    icon:'🥐',type:'휴게음식점 (제과·제빵)',badge:'rb-top',badgeText:'인기',
    profitScore:70,locationScore:82,competitionScore:58,regulationScore:80,revenueScore:68,regulationFail:false,
    costMin:5000,costMax:18000,basePyung:20,
    revPess:300,revBase:580,revOpt:920,
    revNote:'객단가 12,000원. 아침·점심·카페 결합 수요. 원가율 35~40%.',
    competitors:['파리바게뜨 인근','뚜레쥬르 인근','개인 베이커리'],
    compRating:['4.2','4.0','—'],
    insights:[{type:'positive',icon:'☕',title:'카페 복합 운영 가능',desc:'베이커리+음료 결합 시 객단가 15,000~20,000원 가능.'},{type:'negative',icon:'💰',title:'초기 설비 비용 높음',desc:'오븐·발효기 등 필수 설비 2,000~5,000만원.'},{type:'positive',icon:'🌅',title:'아침 수요 독점',desc:'카페·편의점과 다른 조기 고객층. 오전 매출 비중 40%.'}],
    deductions:[{type:'green',icon:'✅',text:'아침·카페 복합 수요 안정',score:'+12',tip:'통계청 외식업 소비 패턴'},{type:'yellow',icon:'⚡',text:'대형 브랜드(파리바게뜨 등) 경쟁',score:'-10',tip:'소상공인진흥공단 제과점업 경쟁도'},{type:'green',icon:'✅',text:'브런치·스페셜티 트렌드 수혜',score:'+8',tip:'SNS 소비 트렌드 통계'},{type:'red',icon:'🔴',text:'초기 설비비 높음',score:'-8',tip:'한국제과기술사협회 창업 가이드'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'대형 브랜드와 직접 경쟁 — 차별화 필수',desc:'파리바게뜨·뚜레쥬르 반경 200m 내 입점 시 매출 30~40% 하락 사례 다수.',law:'소상공인진흥공단 제과업 상권분석',tip:'소상공인진흥공단 업종별 경쟁도 통계.',score:'-10'},{level:'caution',icon:'🔶',title:'오븐 설비 환기 기준',desc:'제과용 오븐 설치 시 환기 시설 설치 의무. 건물 구조에 따라 설치 불가 경우 있음.',law:'건축법 시행령 제87조',tip:'건축물 설비기준 규칙 제17조 환기설비.',score:'주의'}],
    adminTerm:{zoneName:'근린상업지역 / 제2종 일반주거지역 이상',lawRef:'식품위생법 제37조, 식품위생법 시행령 제25조',condition:'휴게음식점 영업신고. 제과·제빵업 신고 별도 가능.',highlight:'제과점 영업신고(식품위생법 제37조)'},
    regulations:[{ok:true,text:'휴게음식점(제과점) 영업신고 가능'},{ok:true,text:'상업·주거지역 대부분 허용'},{ok:false,text:'오븐 설비 환기시설 설치 가능 여부 건물 확인 필요'},{ok:true,text:'식품제조가공업 미해당 (소규모 판매)'},{ok:false,text:'브랜드 가맹 시 가맹정보공개서 14일 열람 의무'}],
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🚗',label:'주차',status:'warn',text:'조건부'},{icon:'🔥',label:'소방',status:'pass',text:'적합'},{icon:'🍽',label:'위생',status:'pass',text:'충족'},{icon:'💨',label:'환기',status:'warn',text:'조건부'},{icon:'📐',label:'건축',status:'pass',text:'적합'}],
    areaScore:76,areaAvgScore:61,areaName:'상권 제과·제빵',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'cond'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:1500,baseMax:6000,isDeposit:true},{label:'월세',baseMin:100,baseMax:280},{label:'인테리어',baseMin:2000,baseMax:5000},{label:'오븐·발효기',fixed:true,baseMin:1500,baseMax:4000},{label:'진열장·집기',fixed:true,baseMin:500,baseMax:1500},{label:'인허가비',fixed:true,baseMin:20,baseMax:60}],
    fixedCosts:[{label:'임대료',min:130,max:280},{label:'인건비(파트 2명)',min:180,max:280},{label:'재료비(밀가루 등)',min:150,max:250},{label:'전기·가스요금',min:40,max:80},{label:'플랫폼·카드수수료',min:15,max:25}],
    bepMonths:10,monthlyCost:380,yearlyRev:{y1:5800,y2:7200,y3:8600},
    properties:[{thumb:'🥐',area:'역세권 1층',name:'1층 코너 상가',pyung:'20평/66㎡',price:'보증금 3,000만',rent:'월세 180만',badge:'역세권',tags:['아침수요','통행량多']},{thumb:'🏬',area:'오피스 빌딩',name:'오피스 1층',pyung:'18평/59㎡',price:'보증금 2,500만',rent:'월세 160만',badge:'오피스',tags:['점심복합','카페수요']},{thumb:'🏘',area:'주택가 상권',name:'주택가 코너',pyung:'15평/50㎡',price:'보증금 1,500만',rent:'월세 120만',badge:'주거지',tags:['단골형성','경쟁적음']}]
  },
  헬스장:{
    icon:'💪',type:'체육시설업',badge:'rb-stable',badgeText:'안정',
    profitScore:75,locationScore:80,competitionScore:60,regulationScore:65,revenueScore:72,regulationFail:false,
    costMin:8000,costMax:30000,basePyung:80,
    revPess:400,revBase:800,revOpt:1400,
    revNote:'회원권 월 6~10만원. 회원 100~250명 목표. 퍼스널트레이닝(PT) 수익 별도.',
    competitors:['개인 헬스장 인근','대형 체인 PT샵'],
    compRating:['4.1','—'],
    insights:[{type:'positive',icon:'🏋️',title:'PT 수익으로 고마진 가능',desc:'PT 1회 5~8만원. 트레이너 1명당 월 300~500만원 추가 매출.'},{type:'negative',icon:'💸',title:'초기비용 최고 수준',desc:'운동기구·시설 투자 5,000~20,000만원 이상 필요.'},{type:'caution',icon:'⚠️',title:'체육시설업 신고 + 시설 기준',desc:'1종 체육시설 신고 필요. 운동기구 기준·탈의실 면적 요건.'}],
    deductions:[{type:'green',icon:'✅',text:'PT 추가 수익 가능',score:'+15',tip:'트레이너 PT 매출 월 300~500만 추가 가능'},{type:'red',icon:'🔴',text:'초기 설비비 고비용',score:'-12',tip:'체육시설업 운동기구 기준 필수 장비 목록'},{type:'yellow',icon:'⚡',text:'체육시설업 신고 절차',score:'-5',tip:'국민체육진흥법 제10조 신고 의무'},{type:'green',icon:'✅',text:'건강 트렌드 수요 증가',score:'+10',tip:'문화체육관광부 체육시설업 통계'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'체육시설업 신고 미이행 시 영업정지',desc:'1종 체육시설(헬스장) 미신고 영업 시 300만원 이하 과태료. 탈의실·샤워실 면적 기준 충족 필수.',law:'국민체육진흥법 제10조',tip:'문화체육관광부 체육시설 설치·이용에 관한 법률.',score:'-10'},{level:'warning',icon:'⚠️',title:'대규모 시설비 회수 기간 길음',desc:'초기 투자 1~3억 회수에 평균 2~3년 소요. 회원 이탈률 관리 필수.',law:'소상공인진흥공단 체육시설업 가이드',tip:'소상공인진흥공단 업종별 손익분기 통계.',score:'-8'},{level:'caution',icon:'🔶',title:'층간소음·주거지역 입지 제한',desc:'주거지역 상층부 입지 시 소음 민원 발생 가능. 독립 건물 또는 지하 1~2층 추천.',law:'소음·진동관리법',tip:'환경부 생활소음 규제 기준.',score:'주의'}],
    adminTerm:{zoneName:'일반상업지역 / 근린상업지역 / 준주거지역',lawRef:'국민체육진흥법 제10조, 체육시설의 설치·이용에 관한 법률 제10조',condition:'1종 체육시설업 신고. 운동면적 기준(66㎡ 이상), 탈의실·샤워실 필수.',highlight:'체육시설업 신고(국민체육진흥법 제10조)'},
    regulations:[{ok:false,text:'체육시설업(1종) 신고 — 탈의실·샤워실·운동면적 기준 충족 필요'},{ok:true,text:'상업·준주거지역 영업 허용'},{ok:false,text:'주거지역 내 소음·진동 기준 충족 여부 확인'},{ok:false,text:'소방시설(스프링클러 등) 면적별 의무 확인'},{ok:true,text:'트레이너 자격증(생활체육지도사) 보유 시 PT 서비스 가능'}],
    permits:[{icon:'📋',label:'시설신고',status:'warn',text:'조건부'},{icon:'🚗',label:'주차',status:'warn',text:'조건부'},{icon:'🔥',label:'소방',status:'warn',text:'보완'},{icon:'🏋️',label:'기구기준',status:'warn',text:'확인필요'},{icon:'🚿',label:'탈의실',status:'warn',text:'면적기준'},{icon:'🎓',label:'자격증',status:'warn',text:'권고'}],
    areaScore:78,areaAvgScore:62,areaName:'상권 체육시설',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'no'},{name:'제2종 일반주거',status:'cond',note:'소음 주의'},{name:'제3종 일반주거',status:'cond'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'no'}],
    costs:[{label:'보증금',baseMin:3000,baseMax:10000,isDeposit:true},{label:'월세',baseMin:200,baseMax:600},{label:'인테리어',baseMin:3000,baseMax:8000},{label:'운동기구 세트',fixed:true,baseMin:3000,baseMax:12000},{label:'탈의실·샤워실',fixed:true,baseMin:500,baseMax:2000},{label:'인허가·신고비',fixed:true,baseMin:50,baseMax:150}],
    fixedCosts:[{label:'임대료',min:250,max:600},{label:'인건비(트레이너)',min:300,max:600},{label:'관리비·공과금',min:80,max:150},{label:'기구 유지보수',min:30,max:60},{label:'카드수수료·기타',min:20,max:40}],
    bepMonths:14,monthlyCost:700,yearlyRev:{y1:8500,y2:11000,y3:13500},
    properties:[{thumb:'💪',area:'역세권 지하',name:'지하 1~2층',pyung:'100평/330㎡',price:'보증금 5,000만',rent:'월세 350만',badge:'추천',tags:['소음해결','넓은평수']},{thumb:'🏋️',area:'오피스 인근',name:'3~4층 독립',pyung:'80평/264㎡',price:'보증금 4,000만',rent:'월세 280만',badge:'오피스',tags:['직장인 수요','PT가능']},{thumb:'🏢',area:'주거 상권',name:'상가 2~3층',pyung:'60평/198㎡',price:'보증금 3,000만',rent:'월세 220만',badge:'주거지',tags:['단골형성','경쟁적음']}]
  },
  미용실:{
    icon:'💇',type:'이용·미용업',badge:'rb-stable',badgeText:'안정',
    profitScore:73,locationScore:79,competitionScore:62,regulationScore:82,revenueScore:70,regulationFail:false,
    costMin:3000,costMax:12000,basePyung:20,
    revPess:280,revBase:520,revOpt:850,
    revNote:'객단가 45,000원. 1인 미용사 1일 4~8명 시술. 재방문율 60%+.',
    competitors:['프랜차이즈 헤어샵 인근','개인 미용실 다수'],
    compRating:['4.2','—'],
    insights:[{type:'positive',icon:'🔄',title:'재방문율 높음',desc:'단골 고객 형성 시 안정적 매출. 재방문 주기 4~8주.'},{type:'positive',icon:'🎨',title:'디자이너 실력 차별화',desc:'SNS 마케팅 + 스타일리스트 실력으로 경쟁 우위 가능.'},{type:'caution',icon:'⚠️',title:'면허증 보유 필수',desc:'미용사 면허 없는 영업 시 형사 처벌 대상.'}],
    deductions:[{type:'green',icon:'✅',text:'재방문율 높음 — 안정 수익',score:'+12',tip:'통계청 서비스업 조사'},{type:'yellow',icon:'⚡',text:'경쟁 미용실 과밀',score:'-8',tip:'소상공인진흥공단 미용업 상권분석'},{type:'green',icon:'✅',text:'SNS 마케팅 효과 큼',score:'+8',tip:'트렌드 헤어 SNS 통계'},{type:'yellow',icon:'⚡',text:'프랜차이즈 저가 경쟁',score:'-6',tip:'저가 헤어샵 프랜차이즈 증가 추세'}],
    riskReport:[{level:'critical',icon:'⛔',title:'미용사 면허 없는 영업 — 형사처벌',desc:'미용사 국가자격증 없이 영업 시 1년 이하 징역 또는 1천만원 이하 벌금.',law:'공중위생관리법 제6조',tip:'보건복지부 공중위생관리법 제6조 위반 처벌 기준.',score:'-30'},{level:'warning',icon:'⚠️',title:'저가 헤어샵 프랜차이즈 경쟁',desc:'블루클럽·헤어커트 등 1만원대 프랜차이즈와 차별화 전략 필요.',law:'소상공인진흥공단 미용업 가이드',tip:'소상공인진흥공단 미용업 경쟁도 통계.',score:'-8'}],
    adminTerm:{zoneName:'근린상업지역 / 제2종 일반주거지역 이상',lawRef:'공중위생관리법 제2조·제6조',condition:'미용업 영업신고. 미용사 면허 보유자 1인 이상 필수.',highlight:'미용업 영업신고(공중위생관리법 제2조)'},
    regulations:[{ok:false,text:'미용사 국가면허 보유 필수 (없으면 영업 불가)'},{ok:true,text:'미용업 영업신고 후 영업 가능'},{ok:true,text:'상업·주거지역 대부분 허용'},{ok:true,text:'소방·위생 기준 충족 용이'},{ok:false,text:'위생교육(3시간) 영업 전 이수 의무'}],
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🎓',label:'면허증',status:'warn',text:'필수'},{icon:'🔥',label:'소방',status:'pass',text:'적합'},{icon:'🚿',label:'위생설비',status:'pass',text:'충족'},{icon:'🏗',label:'용도',status:'pass',text:'불필요'},{icon:'📚',label:'위생교육',status:'warn',text:'이수필요'}],
    areaScore:75,areaAvgScore:60,areaName:'상권 미용업',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'cond'},{name:'제1종 일반주거',status:'ok'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'cond'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:1000,baseMax:5000,isDeposit:true},{label:'월세',baseMin:80,baseMax:250},{label:'인테리어',baseMin:1500,baseMax:4000},{label:'미용기기·의자',fixed:true,baseMin:500,baseMax:2000},{label:'샴푸대·집기',fixed:true,baseMin:200,baseMax:800},{label:'인허가비',fixed:true,baseMin:20,baseMax:50}],
    fixedCosts:[{label:'임대료',min:100,max:250},{label:'인건비(디자이너)',min:200,max:350},{label:'약제·소모품',min:50,max:100},{label:'관리비·공과금',min:25,max:50},{label:'카드수수료',min:15,max:25}],
    bepMonths:8,monthlyCost:320,yearlyRev:{y1:5200,y2:6500,y3:7800},
    properties:[{thumb:'💇',area:'주택가 상권',name:'1~2층 미용실',pyung:'18평/59㎡',price:'보증금 2,000만',rent:'월세 120만',badge:'단골형성',tags:['재방문高','경쟁적음']},{thumb:'🏬',area:'역세권',name:'역세권 2층',pyung:'22평/73㎡',price:'보증금 3,000만',rent:'월세 180만',badge:'역세권',tags:['유동高','SNS유리']},{thumb:'🎨',area:'트렌디 상권',name:'갤러리형 1층',pyung:'15평/50㎡',price:'보증금 2,500만',rent:'월세 160만',badge:'트렌드',tags:['인스타마케팅','젊은층']}]
  },
  노래방:{
    icon:'🎤',type:'다중이용업 (노래연습장)',badge:'rb-caution',badgeText:'주의',
    profitScore:66,locationScore:75,competitionScore:68,regulationScore:55,revenueScore:65,regulationFail:false,
    costMin:6000,costMax:20000,basePyung:50,
    revPess:280,revBase:520,revOpt:820,
    revNote:'시간당 1만원 기준. 룸 10개, 평일 회전율 40%·주말 80% 가정.',
    competitors:['인근 노래방 다수','코인노래방'],
    compRating:['3.9','—'],
    insights:[{type:'positive',icon:'🎉',title:'주말·저녁 수요 강함',desc:'회식·모임·연인 수요 연중 지속.'},{type:'negative',icon:'🔴',title:'소방·다중이용업 규제 강함',desc:'방음·소방·비상구 설비 투자 1,000~3,000만원 추가 필수.'},{type:'caution',icon:'🪙',title:'코인노래방 경쟁 증가',desc:'코인노래방 급증으로 기존 노래방 매출 잠식 추세.'}],
    deductions:[{type:'green',icon:'✅',text:'주말 수요 안정적',score:'+10',tip:'한국노래연습장업협회 통계'},{type:'red',icon:'🔴',text:'다중이용업 소방 규제 강도 높음',score:'-15',tip:'소방청 다중이용업소 안전관리법'},{type:'yellow',icon:'⚡',text:'코인노래방 경쟁 심화',score:'-8',tip:'소상공인진흥공단 노래연습장 상권분석'},{type:'green',icon:'✅',text:'음식·주류 판매 결합 시 매출 증가',score:'+8',tip:'업종 결합 운영 사례 통계'}],
    riskReport:[{level:'critical',icon:'⛔',title:'다중이용업소 안전관리 미이행 — 영업정지',desc:'비상구·방음·소방시설 미비 시 즉시 영업정지. 소방안전교육 이수 필수.',law:'다중이용업소 안전관리법 제9조',tip:'소방청 다중이용업소 안전관리 업무 처리 규정.',score:'-20'},{level:'warning',icon:'⚠️',title:'코인노래방 급증 — 기존 매출 잠식',desc:'코인노래방 1개 반경 300m 내 입점 시 매출 15~25% 감소 사례.',law:'소상공인진흥공단 상권분석',tip:'소상공인진흥공단 노래연습장 경쟁도.',score:'-8'}],
    adminTerm:{zoneName:'일반상업지역 / 근린상업지역',lawRef:'다중이용업소 안전관리에 관한 특별법 제9조',condition:'다중이용업 신고 + 소방안전교육 이수. 방음·비상구·소방설비 기준 충족 필수.',highlight:'노래연습장업 신고(음악산업진흥법 제2조)'},
    regulations:[{ok:false,text:'다중이용업 소방안전교육 이수 및 신고 의무'},{ok:false,text:'비상구·방음·자동소화장치 설치 의무'},{ok:true,text:'상업지역 내 영업 허용'},{ok:false,text:'주거지역 내 소음 기준 초과 시 영업 불가'},{ok:false,text:'청소년 출입 시간 제한(오전 9시~오후 10시) 준수'}],
    permits:[{icon:'📋',label:'업신고',status:'warn',text:'조건부'},{icon:'🔥',label:'소방',status:'warn',text:'필수보완'},{icon:'🚪',label:'비상구',status:'warn',text:'필수'},{icon:'🔇',label:'방음',status:'warn',text:'기준충족'},{icon:'👶',label:'청소년',status:'warn',text:'시간제한'},{icon:'📐',label:'용도',status:'warn',text:'확인필요'}],
    areaScore:70,areaAvgScore:58,areaName:'상권 노래연습장',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'no'},{name:'제2종 일반주거',status:'no'},{name:'제3종 일반주거',status:'cond',note:'소음 민원 위험'},{name:'준주거지역',status:'cond'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'no'}],
    costs:[{label:'보증금',baseMin:2000,baseMax:8000,isDeposit:true},{label:'월세',baseMin:150,baseMax:400},{label:'인테리어·방음',baseMin:3000,baseMax:8000},{label:'음향·노래반주기',fixed:true,baseMin:1000,baseMax:3000},{label:'소방설비',fixed:true,baseMin:500,baseMax:2000},{label:'인허가·신고비',fixed:true,baseMin:50,baseMax:150}],
    fixedCosts:[{label:'임대료',min:200,max:400},{label:'인건비',min:150,max:280},{label:'노래반주기 유지',min:30,max:60},{label:'관리비·공과금',min:50,max:90},{label:'기타 운영비',min:20,max:40}],
    bepMonths:12,monthlyCost:500,yearlyRev:{y1:5500,y2:6800,y3:7800},
    properties:[{thumb:'🎤',area:'먹자골목 인근',name:'2~3층 전용',pyung:'60평/198㎡',price:'보증금 4,000만',rent:'월세 250만',badge:'입지',tags:['저녁수요','먹자골목']},{thumb:'🏬',area:'역세권',name:'지하 노래방',pyung:'50평/165㎡',price:'보증금 3,500만',rent:'월세 220만',badge:'역세권',tags:['접근성최고','주말수요']},{thumb:'🎉',area:'대학가',name:'대학가 3층',pyung:'45평/149㎡',price:'보증금 2,500만',rent:'월세 180만',badge:'대학가',tags:['20대수요강','MT시즌']}]
  },
  PC방:{
    icon:'🖥️',type:'다중이용업 (PC방)',badge:'rb-caution',badgeText:'주의',
    profitScore:60,locationScore:72,competitionScore:65,regulationScore:58,revenueScore:62,regulationFail:false,
    costMin:8000,costMax:25000,basePyung:60,
    revPess:250,revBase:480,revOpt:780,
    revNote:'시간당 1,500원. 60석 기준. 음료·식사 판매 결합 시 매출 30% 증가.',
    competitors:['인근 PC방 다수'],
    compRating:['4.0','—'],
    insights:[{type:'positive',icon:'🎮',title:'게임·e스포츠 수요',desc:'PC방 방문 수요 안정. 신규 게임 출시 시 매출 급증.'},{type:'negative',icon:'💻',title:'PC·인터넷 장비 비용',desc:'60석 기준 PC 초기 설치비 4,000~8,000만원.'},{type:'caution',icon:'⚠️',title:'청소년보호·소방 규제',desc:'청소년 심야 출입 제한 + 다중이용업 소방 의무.'}],
    deductions:[{type:'green',icon:'✅',text:'e스포츠·게임 수요 지속',score:'+10',tip:'한국콘텐츠진흥원 게임이용자 통계'},{type:'red',icon:'🔴',text:'고가 PC 장비 초기 투자',score:'-12',tip:'PC방 창업 비용 통계'},{type:'yellow',icon:'⚡',text:'다중이용업 소방 규제',score:'-10',tip:'소방청 다중이용업소 안전관리법'},{type:'green',icon:'✅',text:'음료·식사 결합 시 수익 보완',score:'+8',tip:'PC방 복합 운영 사례'}],
    riskReport:[{level:'critical',icon:'⛔',title:'다중이용업소 안전관리 미이행',desc:'소방시설 미비 시 영업정지. 청소년 보호법 위반 시 형사처벌.',law:'다중이용업소 안전관리법, 청소년보호법',tip:'소방청 다중이용업소 기준.',score:'-20'},{level:'warning',icon:'⚠️',title:'PC 노후화 — 주기적 교체 비용',desc:'PC 교체 주기 3~4년. 교체 시 3,000~8,000만원 추가 필요.',law:'소상공인진흥공단 PC방 가이드',tip:'PC방 운영 비용 통계.',score:'-8'}],
    adminTerm:{zoneName:'일반상업지역 / 근린상업지역',lawRef:'다중이용업소 안전관리법, 청소년보호법 제2조',condition:'다중이용업 신고. 소방안전교육 이수. 청소년 심야 출입 금지 운영.',highlight:'PC방(인터넷컴퓨터게임시설제공업) 신고'},
    regulations:[{ok:false,text:'다중이용업 소방안전교육 및 신고 의무'},{ok:false,text:'청소년 심야(오전 1시 이후) 출입 금지 준수'},{ok:true,text:'상업지역 내 영업 허용'},{ok:false,text:'소방시설(스프링클러 등) 면적별 의무 설치'},{ok:false,text:'개인정보(회원 로그인) 관리 의무'}],
    permits:[{icon:'📋',label:'업신고',status:'warn',text:'조건부'},{icon:'🔥',label:'소방',status:'warn',text:'필수보완'},{icon:'👶',label:'청소년',status:'warn',text:'심야제한'},{icon:'💻',label:'PC설비',status:'pass',text:'가능'},{icon:'🍽',label:'음식영업',status:'warn',text:'추가신고'},{icon:'📐',label:'용도',status:'warn',text:'확인필요'}],
    areaScore:68,areaAvgScore:57,areaName:'상권 PC방',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'no'},{name:'제2종 일반주거',status:'no'},{name:'제3종 일반주거',status:'cond'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'no'}],
    costs:[{label:'보증금',baseMin:2000,baseMax:8000,isDeposit:true},{label:'월세',baseMin:150,max:400},{label:'PC·모니터(60석)',fixed:true,baseMin:4000,baseMax:8000},{label:'인테리어',baseMin:2000,baseMax:5000},{label:'소방설비',fixed:true,baseMin:500,baseMax:2000},{label:'인허가비',fixed:true,baseMin:50,baseMax:150}],
    fixedCosts:[{label:'임대료',min:200,max:450},{label:'인건비',min:150,max:280},{label:'전기요금',min:80,max:150},{label:'인터넷·콘텐츠비',min:50,max:100},{label:'관리비·기타',min:30,max:60}],
    bepMonths:14,monthlyCost:550,yearlyRev:{y1:5000,y2:6200,y3:7200},
    properties:[{thumb:'🖥️',area:'대학가',name:'지하 1~2층',pyung:'80평/264㎡',price:'보증금 4,000만',rent:'월세 280만',badge:'대학가',tags:['젊은층多','야간수요']},{thumb:'🏬',area:'먹자골목',name:'2~3층 복합',pyung:'60평/198㎡',price:'보증금 3,500만',rent:'월세 250만',badge:'먹자골목',tags:['복합운영','e스포츠']},{thumb:'🎮',area:'역세권',name:'2층 대형',pyung:'70평/231㎡',price:'보증금 4,500만',rent:'월세 300만',badge:'역세권',tags:['접근성최고','프리미엄']}]
  },
  술집:{
    icon:'🍺',type:'일반음식점 (주류취급)',badge:'rb-caution',badgeText:'주의',
    profitScore:70,locationScore:78,competitionScore:70,regulationScore:60,revenueScore:72,regulationFail:false,
    costMin:4000,costMax:15000,basePyung:30,
    revPess:350,revBase:700,revOpt:1200,
    revNote:'객단가 40,000원. 저녁 회식·모임 수요. 원가율 35%.',
    competitors:['인근 주점 다수','호프집·포차'],
    compRating:['4.0','—'],
    insights:[{type:'positive',icon:'🌃',title:'저녁·야간 수요 강함',desc:'회식·모임 수요 평일 저녁 집중. 주말 매출 50%+.'},{type:'negative',icon:'⏰',title:'영업시간 제한 리스크',desc:'코로나 등 집합금지 업종 1순위. 야간 영업 정책 변화 민감.'},{type:'caution',icon:'🍷',title:'주류판매 규제',desc:'미성년자 주류 판매 금지. 적발 시 영업정지.'}],
    deductions:[{type:'green',icon:'✅',text:'저녁 회식 수요 연중',score:'+12',tip:'통계청 외식업 지출 통계'},{type:'red',icon:'🔴',text:'집합금지 등 영업 제한 취약',score:'-12',tip:'감염병예방법 집합금지 업종'},{type:'yellow',icon:'⚡',text:'주변 주점 경쟁',score:'-8',tip:'소상공인진흥공단 주점업 상권분석'},{type:'green',icon:'✅',text:'고객단가 높음',score:'+10',tip:'통계청 외식 주류 소비 통계'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'미성년자 주류 판매 금지 — 단속 시 영업정지',desc:'청소년에게 주류 판매 적발 시 2개월~영구 영업정지.',law:'청소년보호법 제28조',tip:'여성가족부 청소년 보호법 주류 판매 기준.',score:'-15'},{level:'warning',icon:'⚠️',title:'집합금지·영업시간 제한 취약 업종',desc:'감염병·사회적 거리두기 시 주점 우선 영업제한.',law:'감염병의 예방 및 관리에 관한 법률 제49조',tip:'질병관리청 집합금지 적용 업종 기준.',score:'-12'},{level:'caution',icon:'🔶',title:'소방·환기 설비 기준',desc:'영업면적 150㎡ 이상 시 소방시설 추가 의무.',law:'소방시설법',tip:'소방청 기준.',score:'주의'}],
    adminTerm:{zoneName:'일반상업지역 / 근린상업지역',lawRef:'식품위생법 제36조, 주세법 제2조',condition:'일반음식점 영업허가 + 주류 판매 가능. 청소년 출입 금지 구역 지정 여부 확인.',highlight:'일반음식점 영업허가(식품위생법 제36조)'},
    regulations:[{ok:true,text:'일반음식점(주류 포함) 영업허가 가능'},{ok:false,text:'미성년자 주류 판매 금지 — 신분증 확인 의무'},{ok:true,text:'상업지역 내 영업 허용'},{ok:false,text:'청소년 출입 금지 업소 지정 여부 확인 필요'},{ok:false,text:'소방·환기 설비 기준 충족 확인'}],
    permits:[{icon:'📋',label:'영업허가',status:'pass',text:'가능'},{icon:'🍷',label:'주류판매',status:'pass',text:'허용'},{icon:'🔥',label:'소방',status:'warn',text:'확인필요'},{icon:'👶',label:'청소년',status:'warn',text:'판매금지'},{icon:'💨',label:'환기',status:'warn',text:'조건부'},{icon:'⏰',label:'영업시간',status:'warn',text:'제한주의'}],
    areaScore:74,areaAvgScore:59,areaName:'상권 주점업',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'no'},{name:'제2종 일반주거',status:'cond',note:'민원 위험'},{name:'제3종 일반주거',status:'cond'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'no'}],
    costs:[{label:'보증금',baseMin:1500,baseMax:6000,isDeposit:true},{label:'월세',baseMin:130,baseMax:350},{label:'인테리어',baseMin:2000,baseMax:6000},{label:'주방기기·집기',fixed:true,baseMin:500,baseMax:1500},{label:'인허가비',fixed:true,baseMin:30,baseMax:80}],
    fixedCosts:[{label:'임대료',min:170,max:350},{label:'인건비(서빙 2명)',min:200,max:350},{label:'식자재·주류비',min:250,max:400},{label:'관리비·공과금',min:40,max:80},{label:'카드수수료',min:20,max:35}],
    bepMonths:9,monthlyCost:480,yearlyRev:{y1:7500,y2:9000,y3:10500},
    properties:[{thumb:'🍺',area:'먹자골목',name:'1층 포차형',pyung:'25평/83㎡',price:'보증금 2,500만',rent:'월세 180만',badge:'먹자골목',tags:['회식수요','저녁집중']},{thumb:'🏬',area:'역세권',name:'지하 1층',pyung:'35평/116㎡',price:'보증금 3,000만',rent:'월세 200만',badge:'역세권',tags:['접근성최고','야간수요']},{thumb:'🍷',area:'번화가',name:'2층 바형',pyung:'20평/66㎡',price:'보증금 2,000만',rent:'월세 160만',badge:'번화가',tags:['트렌디','칵테일바']}]
  },
  중국집:{
    icon:'🥡',type:'일반음식점 (중식)',badge:'rb-stable',badgeText:'안정',
    profitScore:71,locationScore:76,competitionScore:55,regulationScore:80,revenueScore:70,regulationFail:false,
    costMin:3500,costMax:12000,basePyung:25,
    revPess:320,revBase:600,revOpt:950,
    revNote:'객단가 18,000원. 배달 60%+홀 40%. 짜장면·짬뽕 등 기본 메뉴 중심.',
    competitors:['인근 중국집','배달 전문 중식'],
    compRating:['4.0','—'],
    insights:[{type:'positive',icon:'📦',title:'배달 수요 꾸준',desc:'짜장면·짬뽕 배달 주문은 감소 없이 안정적.'},{type:'positive',icon:'👨‍👩‍👧',title:'가족 단위 수요',desc:'배달+홀 이원화 운영으로 수익 극대화 가능.'},{type:'caution',icon:'🌡️',title:'중식 조리 자격 권고',desc:'중식조리기능사 보유 시 품질 차별화 가능.'}],
    deductions:[{type:'green',icon:'✅',text:'배달 수요 꾸준 (짜장·짬뽕 국민메뉴)',score:'+12',tip:'배달 플랫폼 통계'},{type:'green',icon:'✅',text:'가족 외식 수요 안정',score:'+8',tip:'통계청 가구 외식 지출'},{type:'yellow',icon:'⚡',text:'인근 중식 경쟁',score:'-8',tip:'소상공인진흥공단 음식업 상권분석'},{type:'yellow',icon:'⚡',text:'배달 수수료 부담',score:'-6',tip:'배달 플랫폼 수수료율'}],
    riskReport:[{level:'warning',icon:'⚠️',title:'배달앱 수수료 — 중식 마진 압박',desc:'짜장면(7,000~9,000원) 저단가 메뉴 배달 수수료 20% 차감 시 실질 마진 5~10%.',law:'전자상거래법',tip:'공정거래위원회 배달플랫폼 수수료 실태.',score:'-8'},{level:'caution',icon:'🔶',title:'화기 사용 — 환기 설비 필수',desc:'웍 고화력 화기 사용. 환기 기준 미충족 시 위생점검 불합격 가능.',law:'식품위생법 시행규칙 제36조',tip:'식품의약품안전처 기준.',score:'주의'}],
    adminTerm:{zoneName:'제2종 일반주거지역 이상',lawRef:'식품위생법 제36조',condition:'일반음식점 영업허가. 환기·소방 기준 충족 필요.',highlight:'일반음식점 영업허가(식품위생법 제36조)'},
    regulations:[{ok:true,text:'일반음식점 영업허가 가능'},{ok:false,text:'고화력 화기 사용 — 환기설비 기준 충족 필요'},{ok:true,text:'제2종 일반주거지역 이상 영업 허용'},{ok:true,text:'위생 기준 충족 용이'},{ok:false,text:'배달앱 입점 시 수수료 계약 조건 확인'}],
    permits:[{icon:'📋',label:'영업허가',status:'pass',text:'가능'},{icon:'🚗',label:'주차',status:'warn',text:'조건부'},{icon:'🔥',label:'소방',status:'pass',text:'적합'},{icon:'🍽',label:'위생',status:'pass',text:'충족'},{icon:'💨',label:'환기',status:'warn',text:'조건부'},{icon:'📦',label:'배달',status:'pass',text:'가능'}],
    areaScore:73,areaAvgScore:59,areaName:'주거·상업 중식',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'no'},{name:'제1종 일반주거',status:'cond'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'no'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:1000,baseMax:5000,isDeposit:true},{label:'월세',baseMin:80,baseMax:250},{label:'인테리어',baseMin:1500,baseMax:4000},{label:'주방기기·웍',fixed:true,baseMin:500,baseMax:1500},{label:'배달 장비',fixed:true,baseMin:100,baseMax:300},{label:'인허가비',fixed:true,baseMin:20,baseMax:60}],
    fixedCosts:[{label:'임대료',min:100,max:250},{label:'인건비',min:180,max:320},{label:'식자재비',min:200,max:350},{label:'배달수수료',min:60,max:120},{label:'관리비·공과금',min:30,max:60}],
    bepMonths:8,monthlyCost:380,yearlyRev:{y1:6200,y2:7500,y3:8800},
    properties:[{thumb:'🥡',area:'주택가',name:'1층 배달+홀',pyung:'20평/66㎡',price:'보증금 1,500만',rent:'월세 120만',badge:'주거지',tags:['배달최적','홀병행']},{thumb:'🏬',area:'오피스 인근',name:'1층 점심특화',pyung:'22평/73㎡',price:'보증금 2,000만',rent:'월세 150만',badge:'오피스',tags:['점심세트','단체주문']},{thumb:'🚶',area:'먹자골목',name:'2층 중식당',pyung:'30평/99㎡',price:'보증금 2,500만',rent:'월세 180만',badge:'먹자골목',tags:['홀비중높음','가족수요']}]
  },
  네일샵:{
    icon:'💅',type:'이용·미용업 (네일)',badge:'rb-stable',badgeText:'안정',
    profitScore:72,locationScore:76,competitionScore:55,regulationScore:80,revenueScore:70,regulationFail:false,
    costMin:2000,costMax:8000,basePyung:15,
    revPess:260,revBase:480,revOpt:760,
    revNote:'시술 1회 평균 50,000원. 1인 하루 4~6명. 재방문 주기 3~5주.',
    competitors:['인근 네일샵','뷰티샵 다수'],
    compRating:['4.3','—'],
    insights:[{type:'positive',icon:'💅',title:'낮은 초기비용',desc:'소규모 1인 창업 가능. 초기 투자 2,000~4,000만원.'},{type:'positive',icon:'🔄',title:'높은 재방문율',desc:'단골 고객 형성 시 안정적. 3~5주 주기 재방문.'},{type:'positive',icon:'📱',title:'SNS 마케팅 효과',desc:'인스타그램 시술 사진 마케팅 효과 탁월.'}],
    deductions:[{type:'green',icon:'✅',text:'재방문율 높음 — 안정 수익',score:'+12',tip:'통계청 뷰티서비스 통계'},{type:'green',icon:'✅',text:'SNS 마케팅 효과 큼',score:'+10',tip:'인스타그램 뷰티 트렌드'},{type:'yellow',icon:'⚡',text:'인근 네일샵 경쟁',score:'-8',tip:'소상공인진흥공단 미용업 상권분석'},{type:'green',icon:'✅',text:'낮은 초기투자',score:'+8',tip:'네일샵 창업 비용 통계'}],
    riskReport:[{level:'critical',icon:'⛔',title:'미용사(네일) 자격 없는 영업 — 처벌 대상',desc:'네일 미용 자격증 없이 영업 시 1년 이하 징역 또는 1천만원 이하 벌금.',law:'공중위생관리법 제6조',tip:'보건복지부 공중위생관리법 미용업 면허 기준.',score:'-30'},{level:'caution',icon:'🔶',title:'화학 약품 환기 기준',desc:'젤·아크릴 등 화학 약품 사용. 환기 미흡 시 위생점검 지적.',law:'산업안전보건법, 식품위생법 준용',tip:'화학물질관리법 관련 사업장 환기 기준.',score:'주의'}],
    adminTerm:{zoneName:'제1종 일반주거지역 이상',lawRef:'공중위생관리법 제2조·제6조',condition:'미용업(네일) 영업신고. 미용사 자격증 보유자 1인 이상 필수.',highlight:'미용업 영업신고(공중위생관리법 제2조)'},
    regulations:[{ok:false,text:'네일 미용사 국가자격증 보유 필수'},{ok:true,text:'미용업 영업신고 후 가능'},{ok:true,text:'대부분 용도지역 허용'},{ok:false,text:'위생교육(3시간) 영업 전 이수 의무'},{ok:false,text:'화학 약품 환기 설비 확인 필요'}],
    permits:[{icon:'📋',label:'영업신고',status:'pass',text:'가능'},{icon:'🎓',label:'자격증',status:'warn',text:'필수'},{icon:'🔥',label:'소방',status:'pass',text:'적합'},{icon:'💨',label:'환기',status:'warn',text:'확인'},{icon:'🏗',label:'용도',status:'pass',text:'불필요'},{icon:'📚',label:'위생교육',status:'warn',text:'이수필요'}],
    areaScore:74,areaAvgScore:60,areaName:'상권 네일·뷰티',
    zones:[{name:'제1종 전용주거',status:'no'},{name:'제2종 전용주거',status:'cond'},{name:'제1종 일반주거',status:'ok'},{name:'제2종 일반주거',status:'ok'},{name:'제3종 일반주거',status:'ok'},{name:'준주거지역',status:'ok'},{name:'일반상업지역',status:'ok'},{name:'근린상업지역',status:'ok',note:'최적'},{name:'유통상업지역',status:'ok'},{name:'준공업지역',status:'ok'},{name:'전용공업지역',status:'cond'},{name:'자연녹지지역',status:'cond'}],
    costs:[{label:'보증금',baseMin:500,baseMax:3000,isDeposit:true},{label:'월세',baseMin:60,baseMax:200},{label:'인테리어',baseMin:800,baseMax:3000},{label:'네일 기기·집기',fixed:true,baseMin:300,baseMax:1000},{label:'초도재료',fixed:true,baseMin:100,baseMax:300},{label:'인허가비',fixed:true,baseMin:10,baseMax:30}],
    fixedCosts:[{label:'임대료',min:70,max:200},{label:'인건비(테크니션)',min:150,max:280},{label:'재료·소모품',min:50,max:100},{label:'관리비·공과금',min:20,max:40},{label:'SNS마케팅',min:10,max:30}],
    bepMonths:7,monthlyCost:280,yearlyRev:{y1:4800,y2:6000,y3:7200},
    properties:[{thumb:'💅',area:'주택가 상권',name:'1~2층 소규모',pyung:'12평/40㎡',price:'보증금 1,000만',rent:'월세 80만',badge:'단골형성',tags:['재방문高','소규모']},{thumb:'🏬',area:'여성 유동상권',name:'2층 프리미엄',pyung:'15평/50㎡',price:'보증금 1,500만',rent:'월세 120만',badge:'여성상권',tags:['고객단가高','SNS마케팅']},{thumb:'🎨',area:'트렌디 상권',name:'인스타 감성',pyung:'10평/33㎡',price:'보증금 800만',rent:'월세 90만',badge:'트렌드',tags:['SNS인플루언서','디자인샵']}]
  }
};

let selectedBiz=null,selectedArea='',selectedBizData=null,currentStep=0;

function scrollToSearch(){document.getElementById('searchBox').scrollIntoView({behavior:'smooth',block:'center'})}
function scrollToServices(){document.getElementById('servicesSection').scrollIntoView({behavior:'smooth',block:'start'})}
function selectBiz(el,val){document.querySelectorAll('.stag').forEach(t=>t.classList.remove('active'));el.classList.add('active');document.getElementById('bizInput').value=val;selectedBiz=val}
function selectArea(el,val){document.querySelectorAll('.stag').forEach(t=>t.classList.remove('active'));el.classList.add('active');document.getElementById('areaInput').value=val;selectedArea=val}

function calculateRiskScore(d){
  let w=d.locationScore*0.30+d.competitionScore*0.25+d.regulationScore*0.25+d.revenueScore*0.20;
  if(d.regulationFail||d.regulationScore<30)w=Math.min(w,18);
  else if(d.regulationScore<50)w*=0.5;
  return Math.round(w);
}
function getProfitScore(d){return d.profitScore||75}
function getFeasibleScore(d){
  let s=(d.competitionScore*0.4+d.regulationScore*0.4+d.locationScore*0.2);
  if(d.regulationFail)s=Math.min(s,15);
  return Math.round(s);
}
function getGradeInfo(s,rf){
  if(rf||s<30)return{grade:'불가',cls:'danger',emoji:'🚫',msg:'규제 또는 리스크 과락. 현재 조건으로 계약 진행 시 보증금 회수 위험이 있습니다.'};
  if(s<55)return{grade:'주의',cls:'caution',emoji:'⚠️',msg:'리스크 요인이 확인됩니다. 인허가 실무 검토 및 전문가 상담을 권장합니다.'};
  return{grade:'안전',cls:'safe',emoji:'✅',msg:`데이터 분석 기준 사업 안정성 상위 ${s>=80?'10':'20'}% 이내. 인허가 실무 검토 후 진행을 권장합니다.`};
}

function runAnalysis(){
  const b=document.getElementById('bizInput').value.trim()||selectedBiz;
  const a=document.getElementById('areaInput').value.trim()||selectedArea;
  if(!b&&!a){showToast('업종이나 지역을 입력해 주세요!');return}
  selectedBiz=b||'카페';selectedArea=a||'강남역';
  ['servicesSection','howSection'].forEach(id=>document.getElementById(id).style.display='none');
  document.querySelector('.info-section').style.display='none';
  document.querySelector('.stats-bar').style.display='none';
  document.getElementById('loadingArea').style.display='block';
  document.getElementById('result-area').style.display='none';
  document.getElementById('criticalBanner').style.display='none';
  const st=['ls1','ls2','ls3','ls4','ls5'];
  let si=0;
  document.querySelectorAll('.load-stage').forEach(s=>s.classList.remove('active','done'));
  document.getElementById(st[0]).classList.add('active');
  const t=setInterval(()=>{
    if(si<st.length){document.getElementById(st[si]).classList.remove('active');document.getElementById(st[si]).classList.add('done');si++;if(si<st.length)document.getElementById(st[si]).classList.add('active')}
  },380);
  setTimeout(()=>{
    clearInterval(t);
    st.forEach(s=>{document.getElementById(s).classList.remove('active');document.getElementById(s).classList.add('done')});
    setTimeout(()=>{document.getElementById('loadingArea').style.display='none';document.getElementById('heroSection').style.display='none';renderStep1()},300);
  },2100);
}

function getRecommendations(q){
  q=(q||'').toLowerCase();
  // 키워드 → BIZ_DB 키 별칭 매핑
  const aliases={
    '커피':'카페','coffee':'카페','카페':'카페','음료':'카페','디저트':'카페','브런치':'카페',
    '치킨':'치킨집','닭':'치킨집','후라이드':'치킨집','양념치킨':'치킨집','배달치킨':'치킨집',
    '고기':'고깃집','삼겹살':'고깃집','갈비':'고깃집','한식':'고깃집','식당':'고깃집','밥집':'고깃집','고깃집':'고깃집',
    '분식':'분식집','김밥':'분식집','떡볶이':'분식집','라면':'분식집','순대':'분식집','우동':'분식집',
    '빵':'베이커리','베이커리':'베이커리','제과':'베이커리','케이크':'베이커리','제빵':'베이커리',
    '헬스':'헬스장','피트니스':'헬스장','gym':'헬스장','pt':'헬스장','운동':'헬스장','체육':'헬스장',
    '미용':'미용실','헤어':'미용실','뷰티':'미용실','머리':'미용실','hair':'미용실','헤어샵':'미용실',
    '편의점':'편의점','cvs':'편의점','마트':'편의점','슈퍼':'편의점',
    '술':'술집','포차':'술집','주점':'술집','호프':'술집','bar':'술집','이자카야':'술집','맥주':'술집',
    '중국':'중국집','짜장':'중국집','짬뽕':'중국집','중식':'중국집','탕수육':'중국집',
    '노래':'노래방','노래방':'노래방','코인':'노래방','karaoke':'노래방',
    'pc':'PC방','게임':'PC방','인터넷':'PC방','피씨방':'PC방','pc방':'PC방',
    '네일':'네일샵','손톱':'네일샵','nail':'네일샵','젤네일':'네일샵','아트네일':'네일샵'
  };
  const r=[];
  // 1순위: 정확한 별칭 매핑
  for(const[kw,biz] of Object.entries(aliases)){
    if(q.includes(kw)&&!r.includes(biz))r.push(biz);
  }
  // 2순위: BIZ_DB 키 직접 매칭
  for(const[k] of Object.entries(BIZ_DB)){
    if((q.includes(k.toLowerCase())||k.toLowerCase().includes(q))&&!r.includes(k))r.push(k);
  }
  // 3순위: 인기 업종으로 채움
  const defaults=['카페','치킨집','고깃집','분식집'];
  for(const k of defaults){if(!r.includes(k)&&r.length<3)r.push(k)}
  return r.slice(0,3);
}

function renderStep1(){
  const area=selectedArea||'선택 지역',recs=getRecommendations(selectedBiz);
  document.getElementById('bizTag').textContent=`"${selectedBiz}"`;
  document.getElementById('areaTag').textContent=`📍 ${area}`;
  document.getElementById('recTitle').innerHTML=`<em>${area}</em>에서 검증 가능한 업종`;
  document.getElementById('recSub').textContent='4대 지표 종합 분석 — 업종을 선택하면 리스크 탐지를 시작합니다';
  const cards=recs.map((k,i)=>{
    const d=BIZ_DB[k],ts=calculateRiskScore(d),gi=getGradeInfo(ts,d.regulationFail);
    const diff=ts-(d.areaAvgScore||60);
    // data-key 추가, 점수 요소에 data-score/data-bar 속성 부여 → 실시간 업데이트용
    return`<div class="rec-card${i===0?` top-pick${k===selectedBiz?' selected':''}`:''}${k===selectedBiz&&i!==0?' selected':''}" data-key="${k}" onclick="selectRecCard(this,'${k}')">
      <span class="rec-badge ${d.badge}">${d.badgeText}</span>
      <div class="rec-icon">${d.icon}</div>
      <div class="rec-name">${k} <span class="rt-indicator" style="display:none;font-size:9px;background:var(--blue);color:#fff;padding:1px 6px;border-radius:100px;font-weight:700;vertical-align:middle;letter-spacing:.2px">⟳</span></div>
      <div class="rec-type">${d.type}</div>
      <div class="score-row">
        <div><div class="score-label"><span>수익성</span><strong data-score="profit">${d.profitScore}점</strong></div><div class="score-bar"><div class="score-fill sf-profit" data-bar="profit" style="width:${d.profitScore}%"></div></div></div>
        <div><div class="score-label"><span>경쟁</span><strong data-score="competition">${d.competitionScore>60?'높음':'보통'}</strong></div><div class="score-bar"><div class="score-fill sf-compete" data-bar="competition" style="width:${d.competitionScore}%"></div></div></div>
        <div><div class="score-label"><span>종합 등급</span><strong data-score="total" style="color:${gi.cls==='safe'?'var(--green)':gi.cls==='caution'?'var(--yellow)':'var(--red)'}">${ts}점 ${gi.grade}</strong></div><div class="score-bar"><div class="score-fill sf-grade" data-bar="total" style="width:${ts}%"></div></div></div>
      </div>
      <div data-diff style="font-size:10px;color:${diff>=0?'var(--green)':'var(--red)'};font-weight:700;margin-bottom:10px;">${diff>=0?'▲':'▼'} ${Math.abs(diff)}점 (${d.areaName||'지역'} 평균 대비)</div>
      <div class="rec-cost">
        <div><div class="rc-label">예상 초기비용</div><div class="rc-val">${(d.costMin/10000).toFixed(0)}천~${(d.costMax/10000).toFixed(0)}천만원</div></div>
        <div style="text-align:right"><div class="rc-label">월 순이익</div><div class="rc-val" style="color:var(--green)">+${d.revBase}만~</div></div>
      </div>
      <button class="rec-select-btn">${k===selectedBiz||i===0?'✓ 선택됨':'이 업종 리스크 검증'}</button>
    </div>`;
  }).join('');
  document.getElementById('recCards').innerHTML=cards;
  selectedBizData=BIZ_DB[recs[0]]||BIZ_DB['카페'];
  if(!selectedBiz||!BIZ_DB[selectedBiz])selectedBiz=recs[0];
  document.getElementById('toStep2Btn').disabled=false;
  document.getElementById('result-area').style.display='block';
  goStep(1);
  setTimeout(()=>document.getElementById('result-area').scrollIntoView({behavior:'smooth',block:'start'}),100);

  // ── B안: 지도 좌표 있으면 실시간 점수 업데이트 (1회 fetch → 3장 카드 모두 적용) ──
  if(selectedCoords && selectedCoords.lat){
    // ① 카드마다 로딩 인디케이터 표시
    recs.forEach(k=>{
      const ind=document.querySelector(`.rec-card[data-key="${k}"] .rt-indicator`);
      if(ind){ind.style.display='inline';ind.style.background='var(--blue)';}
    });
    // ② API 1회 호출 (selectedBiz 기준 카테고리 코드로 동종업소 집계)
    fetchRealAnalysis(selectedCoords.lat, selectedCoords.lng, selectedBiz)
      .then(data=>{
        if(!data||!data.success) {
          recs.forEach(k=>{ const ind=document.querySelector(`.rec-card[data-key="${k}"] .rt-indicator`); if(ind)ind.style.display='none'; });
          return;
        }
        realApiData=data;
        const firstKey=selectedBiz&&BIZ_DB[selectedBiz]?selectedBiz:recs[0];
        recs.forEach(k=>{
          const card=document.querySelector(`.rec-card[data-key="${k}"]`);
          if(!card) return;
          // ③ 해당 업종 BIZ_DB 기반 + API 데이터로 점수 재계산
          const realD=computeRealScores(BIZ_DB[k], data);
          const ts2=calculateRiskScore(realD);
          const gi2=getGradeInfo(ts2, realD.regulationFail);
          const diff2=ts2-(realD.areaAvgScore||60);
          // ④ 수익성
          const ps=card.querySelector('[data-score="profit"]'),pb=card.querySelector('[data-bar="profit"]');
          if(ps) ps.textContent=`${realD.profitScore}점`;
          if(pb) pb.style.width=`${realD.profitScore}%`;
          // ⑤ 경쟁
          const cs=card.querySelector('[data-score="competition"]'),cb=card.querySelector('[data-bar="competition"]');
          if(cs) cs.textContent=realD.competitionScore>60?'높음':'보통';
          if(cb) cb.style.width=`${realD.competitionScore}%`;
          // ⑥ 종합 등급
          const ts2el=card.querySelector('[data-score="total"]'),tb=card.querySelector('[data-bar="total"]');
          if(ts2el){
            ts2el.textContent=`${ts2}점 ${gi2.grade}`;
            ts2el.style.color=gi2.cls==='safe'?'var(--green)':gi2.cls==='caution'?'var(--yellow)':'var(--red)';
          }
          if(tb) tb.style.width=`${ts2}%`;
          // ⑦ 평균 대비
          const diffEl=card.querySelector('[data-diff]');
          if(diffEl){
            diffEl.style.color=diff2>=0?'var(--green)':'var(--red)';
            diffEl.textContent=`${diff2>=0?'▲':'▼'} ${Math.abs(diff2)}점 (${realD.areaName||'지역'} 평균 대비)`;
          }
          // ⑧ 로딩 → 실시간 뱃지
          const ind=card.querySelector('.rt-indicator');
          if(ind){ind.textContent='📡 실시간';ind.style.background='var(--teal)';ind.style.display='inline';}
          // ⑨ 선택된 업종의 실시간 데이터를 selectedBizData에도 반영
          if(k===firstKey) selectedBizData=realD;
        });
      })
      .catch(()=>{
        recs.forEach(k=>{ const ind=document.querySelector(`.rec-card[data-key="${k}"] .rt-indicator`); if(ind)ind.style.display='none'; });
      });
  }
}

function selectRecCard(el,key){
  document.querySelectorAll('.rec-card').forEach(c=>{c.classList.remove('selected');c.querySelector('.rec-select-btn').textContent='이 업종 리스크 검증'});
  el.classList.add('selected');el.querySelector('.rec-select-btn').textContent='✓ 선택됨';
  // 실시간 데이터가 이미 적용됐으면 그걸 유지, 없으면 BIZ_DB 기본값 사용
  selectedBizData = (realApiData ? computeRealScores(BIZ_DB[key], realApiData) : BIZ_DB[key]);
  selectedBiz=key;
  document.getElementById('toStep2Btn').disabled=false;
  showToast(`${BIZ_DB[key].icon} "${key}" 선택!`);
}

function renderStep2(){
  const d=selectedBizData,ts=calculateRiskScore(d),gi=getGradeInfo(ts,d.regulationFail);
  const profitS=getProfitScore(d),feasibleS=getFeasibleScore(d);
  const gap=profitS-feasibleS;
  // 분석 내역 자동 저장
  saveAnalysisToHistory(selectedBiz, selectedArea, ts, gi.grade);
  document.getElementById('step2Title').innerHTML=`${d.icon} ${selectedArea} ${selectedBiz} — 리스크 탐지 결과`;

  // 실제 API 데이터 연동 (좌표가 있을 때)
  const realBox = document.getElementById('realDataBox');
  if(realBox) { realBox.innerHTML=''; realBox.style.display='none'; }
  if(selectedCoords && selectedCoords.lat) {
    fetchRealAnalysis(selectedCoords.lat, selectedCoords.lng, selectedBiz)
      .then(data => { if(data) applyRealDataToStep2(data); })
      .catch(()=>{});
  }

  /* v6: 이중 점수 */
  const feasibleCls=feasibleS<50?'feasible-card':feasibleS<65?'feasible-card-ok':'feasible-card-safe';
  document.getElementById('dualScoreGrid').innerHTML=`
    <div class="dual-score-card profit-card">
      <div class="ds-label">수익성 점수 <span style="font-size:10px;font-weight:500;color:var(--muted);" title="소상공인진흥공단 상권분석 DB 기반">ⓘ</span></div>
      <div class="ds-score">${profitS}</div>
      <div class="ds-badge" style="background:var(--green);">매출 잠재력 ${profitS>=70?'높음':'보통'}</div>
    </div>
    <div class="dual-score-card ${feasibleCls}">
      <div class="ds-label">실현 가능성 점수 <span style="font-size:10px;font-weight:500;color:var(--muted);" title="국토교통부 LURIS + 건축물대장 API 기반">ⓘ</span></div>
      <div class="ds-score">${feasibleS}</div>
      <div class="ds-badge" style="background:${feasibleS<50?'var(--red)':feasibleS<65?'var(--yellow)':'var(--green)'};">${feasibleS<50?'법규·경쟁 리스크':feasibleS<65?'일부 리스크':'실현 가능'}</div>
    </div>`;

  /* v6: 점수 격차 경고 */
  document.getElementById('dualScoreGapWarning').innerHTML=gap>=20?`
    <div class="ds-gap-warning">
      <div class="ds-gap-icon">⚡</div>
      <div class="ds-gap-text"><strong>격차 경고 (${gap}점):</strong> 수익성은 높지만 실현 가능성이 낮습니다. 이 격차가 클수록 계약 후 분쟁 가능성이 높아집니다. 계약 전 법규 검토가 필수입니다.</div>
    </div>`:'';

  /* 4대 지표 */
  const qd=[{l:'입지',s:d.locationScore,f:false,tip:'국토교통부 v-world 유동인구·접근성 데이터'},{l:'경쟁 우위',s:d.competitionScore,f:false,tip:'소상공인진흥공단 상권분석 DB 동종업체 밀도'},{l:'규제 적합',s:d.regulationScore,f:d.regulationFail,tip:'건축법 시행령 제3조의5 + LURIS 토지이용규제'},{l:'수익 전망',s:d.revenueScore,f:false,tip:'소상공인진흥공단 업종별 평균 매출 통계'}];
  document.getElementById('quadScores').innerHTML=qd.map(q=>{
    const c=q.f?'var(--red)':q.s>=70?'var(--green)':q.s>=50?'var(--yellow)':'var(--red)';
    const g=q.f?'FAIL':q.s>=80?'우수':q.s>=60?'양호':q.s>=40?'보통':'미흡';
    return`<div class="quad-item${q.f?' fatal':''}" title="${q.tip}"><div class="quad-label">${q.l} <span style="font-size:9px;color:var(--light);cursor:help;" title="${q.tip}">ⓘ</span></div><div class="quad-score" style="color:${c}">${q.f?'0':q.s}</div><div class="quad-grade" style="color:${c}">${g}</div>${q.f?'<div class="fatal-badge">⛔ 허가 불가</div>':''}</div>`;
  }).join('');

  /* 종합 + 평균 비교 */
  const diff=ts-(d.areaAvgScore||60);
  document.getElementById('totalScoreArea').innerHTML=`
    <div style="background:${gi.cls==='safe'?'var(--green-light)':gi.cls==='caution'?'var(--yellow-light)':'var(--red-light)'};border:2px solid ${gi.cls==='safe'?'#86efac':gi.cls==='caution'?'#fcd34d':'#fca5a5'};border-radius:var(--r-lg);text-align:center;padding:22px 20px;margin-bottom:0;${gi.cls==='danger'?'animation:dangerGlow 2s ease infinite':''}">
      <div style="font-size:11px;font-weight:700;color:var(--muted);margin-bottom:6px;">종합 창업 안전 점수</div>
      <div style="font-size:52px;font-weight:900;color:${gi.cls==='safe'?'var(--green)':gi.cls==='caution'?'var(--yellow)':'var(--red)'};line-height:1">${ts}</div>
      <div class="ts-badge ${gi.cls}" style="margin-top:8px">${gi.emoji} ${gi.grade}</div>
    </div>
    <div class="avg-compare-row">
      <span class="avg-compare-label">지역 평균 비교</span>
      <div class="avg-compare-items">
        <div class="avg-compare-item"><span class="avg-dot me"></span><span class="avg-compare-text">내 분석: ${ts}점</span></div>
        <div class="avg-compare-item"><span class="avg-dot avg"></span><span class="avg-compare-text">${d.areaName||'지역'} 평균: ${d.areaAvgScore}점</span></div>
      </div>
      <span class="avg-compare-badge ${diff>=0?'up':'down'}">${diff>=0?'▲ 평균 초과':'▼ 평균 미달'}</span>
    </div>`;

  /* v6: Critical 전역 배너 */
  const rr=d.riskReport||[];
  const hasCritical=rr.some(r=>r.level==='critical');
  if(hasCritical){
    document.getElementById('criticalBanner').style.display='block';
    document.getElementById('criticalBanner').innerHTML=`<div class="critical-global-banner"><span class="cgb-icon">❌</span><div class="cgb-text">현재 조건으로 계약 진행 시 보증금 회수 위험 — 인허가 불가 또는 용도지역 위반 가능성 존재</div><button class="cgb-action" onclick="goStep(4)">리포트로 해결 →</button></div>`;
  }

  /* v6: 리스크 경고장 */
  document.getElementById('riskReportBox').innerHTML=rr.length?`
    <div class="risk-report-box">
      <div class="rrb-header">
        <div class="rrb-icon-wrap">${hasCritical?'🚨':'⚠️'}</div>
        <div class="rrb-title-block">
          <div class="rrb-title">${hasCritical?'CRITICAL RISK — 계약 전 반드시 확인':'RISK DETECTED — 주의 항목 있음'}</div>
          <div class="rrb-subtitle">단순 감점이 아닌 현실적 위협 ${rr.length}건 | 계약 후 발견 시 돌이킬 수 없음</div>
        </div>
      </div>
      <div class="rrb-checklist-header">계약 전 확인 필수 항목 ${rr.length}가지</div>
      <div class="rrb-items">
        ${rr.map((r,i)=>`
          <div class="rrb-item ${r.level}">
            <div class="rrb-item-icon">${r.icon}</div>
            <div class="rrb-item-content">
              <div class="rrb-item-title">${i+1}. ${r.title}</div>
              <div class="rrb-item-desc">${r.desc}</div>
              <div class="rrb-item-meta">
                <span class="rrb-item-law">📎 ${r.law}</span>
                <span class="tip-badge">ⓘ 출처<div class="tip-popup">📊 ${r.tip}</div></span>
              </div>
            </div>
            <div class="rrb-score">${r.score}</div>
          </div>`).join('')}
      </div>
    </div>`:'';

  document.getElementById('deductionList').innerHTML=d.deductions.map(dd=>`
    <div class="deduction-item ${dd.type}">
      <div class="ded-icon">${dd.icon}</div>
      <div class="ded-text">${dd.text}</div>
      <span class="score-info-icon">ⓘ<div class="tip-popup">📊 ${dd.tip||'소상공인진흥공단 상권분석 DB 기반'}</div></span>
      <div class="ded-score" style="color:${dd.type==='red'?'var(--red)':dd.type==='yellow'?'var(--yellow)':'var(--green)'}">${dd.score}</div>
    </div>`).join('');
  document.getElementById('compList').innerHTML=d.competitors.map((c,i)=>`<div class="comp-item"><div><div class="comp-name">${c.split('(')[0].trim()}</div><div class="comp-dist">${c.includes('(')?'('+c.split('(')[1]:''}</div></div><div class="comp-rating">★ ${d.compRating[i]||'—'}</div></div>`).join('');
  document.getElementById('insightList').innerHTML=d.insights.map(ins=>`<div class="insight-item ii-${ins.type}"><div class="ii-icon">${ins.icon}</div><div><div class="ii-title">${ins.title}</div><div class="ii-desc">${ins.desc}</div></div></div>`).join('');
}

function renderStep3(){
  const d=selectedBizData,at=d.adminTerm;
  document.getElementById('landTitle').textContent=`"${selectedBiz}" 법규 검토`;
  document.getElementById('landDesc').textContent='용도지역 허가 여부, 인허가 체크리스트, 관련 법령 조문 직접 인용';
  document.getElementById('adminTermBox').innerHTML=`
    <strong>📌 용도지역:</strong> ${at.zoneName}<br>
    <strong>📌 관련 법령:</strong> <span class="admin-term-highlight">${at.lawRef}</span><br>
    <strong>📌 허가 조건:</strong> ${at.condition}<br>
    <strong>📌 핵심 신고 항목:</strong> <span class="admin-term-highlight">${at.highlight}</span>`;
  document.getElementById('zoneGrid').innerHTML=d.zones.map(z=>`<div class="zone-item ${z.status}"><span class="zn">${z.name}${z.note?` <span style="font-size:10px;color:var(--muted);">(${z.note})</span>`:''}</span><span class="zs">${z.status==='ok'?'✓ 가능':z.status==='cond'?'△ 조건부':'✕ 불가'}</span></div>`).join('');
  document.getElementById('permitGrid').innerHTML=d.permits.map(p=>`<div class="permit-item ${p.status}"><div class="permit-icon">${p.icon}</div><div class="permit-label">${p.label}</div><div class="permit-status">${p.status==='pass'?'✓':p.status==='warn'?'△':'✕'} ${p.text}</div></div>`).join('');
  const hasWarn=d.permits.some(p=>p.status==='warn'||p.status==='fail');
  const rr=d.riskReport||[];const hasCritical=rr.some(r=>r.level==='critical');
  document.getElementById('inlineConsultBanner').innerHTML=hasWarn?`
    <div class="inline-consult-banner">
      <div>
        <div class="icb-eyebrow">${hasCritical?'⛔ Critical Issue Detected':'⚠ Warning Detected'}</div>
        <div class="icb-title">이 문제, 모르고 계약하면 보증금이 위험합니다</div>
        <div class="icb-desc">인허가 조건 미충족 항목 발견. 지금 전문가와 확인하세요.</div>
      </div>
      <button class="icb-btn" onclick="showToast('상담 접수 완료! 24시간 내 연락드립니다')">이 리스크, 전문가와 해결하기 →</button>
    </div>`:'';
  updateCosts();
}

function updateCosts(){
  const d=selectedBizData;if(!d)return;
  const py=parseInt(document.getElementById('pyungInput').value)||20,r=py/d.basePyung;
  document.getElementById('pyungLabel').textContent=`${py}평 기준`;
  let tMin=0,tMax=0,dMin=0,dMax=0;
  const rows=d.costs.map(c=>{
    let mn,mx;
    if(c.fixed){mn=c.baseMin;mx=c.baseMax}else{mn=Math.round(c.baseMin*r/10)*10;mx=Math.round(c.baseMax*r/10)*10}
    tMin+=mn;tMax+=mx;if(c.isDeposit){dMin+=mn;dMax+=mx}
    return`<div class="cost-row"><span class="cr-l">${c.label}${c.isDeposit?' <span style="font-size:10px;color:var(--yellow);font-weight:700;">[보증금]</span>':''}</span><span class="cr-r${c.isDeposit?' deposit':''}">${mn.toLocaleString()}~${mx.toLocaleString()}만원</span></div>`;
  });
  rows.push(`<div class="cost-total-row"><span class="ct-l">총 예상비용</span><span class="ct-r">${tMin.toLocaleString()}~${tMax.toLocaleString()}만원</span></div>`);
  rows.push(`<div style="margin-top:8px;padding:8px 12px;background:var(--yellow-light);border:1px solid #fde68a;border-radius:var(--r);font-size:11px;color:var(--muted);">💡 보증금 제외 순비용 ${(tMin-dMin).toLocaleString()}~${(tMax-dMax).toLocaleString()}만원</div>`);
  document.getElementById('costTable').innerHTML=rows.join('');
}

function renderStep4(){
  const d=selectedBizData,ts=calculateRiskScore(d),gi=getGradeInfo(ts,d.regulationFail);
  document.getElementById('step4Title').innerHTML=`${d.icon} ${selectedBiz} — 수익 검증 & 최종 등급`;
  document.getElementById('revGrid').innerHTML=`
    <div class="rev-card"><div class="rev-scenario" style="color:#f87171;">😓 보수적</div><div class="rev-amount rc-pess">${d.revPess}</div><div class="rev-unit">만원/월</div></div>
    <div class="rev-card" style="border-color:rgba(37,99,235,.3);"><div class="rev-scenario" style="color:var(--blue);">📊 기본</div><div class="rev-amount rc-base">${d.revBase}</div><div class="rev-unit">만원/월</div></div>
    <div class="rev-card"><div class="rev-scenario" style="color:var(--green);">🚀 낙관</div><div class="rev-amount rc-opt">${d.revOpt}</div><div class="rev-unit">만원/월</div></div>`;
  document.getElementById('revNote').textContent=`📌 ${d.revNote}`;
  document.getElementById('yrGrid').innerHTML=`
    <div class="yr-card yr-free"><div class="yr-year">1년차</div><div class="yr-amount" style="color:var(--blue);">${d.yearlyRev.y1.toLocaleString()}만</div><div class="yr-sub">연간 총매출 (무료 공개)</div></div>
    <div class="yr-card yr-locked"><div class="yr-year">2년차</div><div class="yr-amount" style="color:var(--muted);">████만</div><div class="yr-sub">정밀 리포트 공개</div><div class="yr-lock-overlay" onclick="showToast('정밀 리포트에서 확인 — 29,000원')"><div class="yr-lock-icon">🔒</div><div class="yr-lock-text">잠금 해제</div></div></div>
    <div class="yr-card yr-locked"><div class="yr-year">3년차</div><div class="yr-amount" style="color:var(--muted);">████만</div><div class="yr-sub">정밀 리포트 공개</div><div class="yr-lock-overlay" onclick="showToast('정밀 리포트에서 확인 — 29,000원')"><div class="yr-lock-icon">🔒</div><div class="yr-lock-text">잠금 해제</div></div></div>`;
  document.getElementById('fixedCostContent').innerHTML=d.fixedCosts.map(f=>`<div style="display:flex;justify-content:space-between;padding:5px 0;font-size:12px;border-bottom:1px solid var(--border);"><span style="color:var(--muted);">${f.label}</span><span style="font-weight:700;">${f.min}~${f.max}만원</span></div>`).join('');
  document.getElementById('bepArea').innerHTML=`
    <div class="bep-card">
      <div><div class="bep-label">예상 BEP</div><div class="bep-value">${d.bepMonths}개월</div><div class="bep-sub">손익분기점</div></div>
      <div><div class="bep-label">월 고정비 (추정)</div><div class="bep-value">${d.monthlyCost}만</div><div class="bep-sub">상세 → 리포트</div></div>
      <div><div class="bep-label">1년차 매출</div><div class="bep-value">${d.yearlyRev.y1.toLocaleString()}만</div><div class="bep-sub">연간 총 매출</div></div>
    </div>`;
  document.getElementById('finalGradeArea').innerHTML=`
    <div class="final-grade-card ${gi.cls}">
      <div class="fg-emoji">${gi.emoji}</div>
      <div class="fg-label">최종 종합 등급</div>
      <div class="fg-grade">${ts}점</div>
      <div class="fg-badge" style="background:${gi.cls==='safe'?'var(--green)':gi.cls==='caution'?'var(--yellow)':'var(--red)'}">${gi.grade}</div>
    </div>
    <div class="expert-verdict-box">
      <strong>전문가 판정:</strong> ${gi.msg}<br>
      <strong>다음 단계:</strong> 인허가 체크리스트 현장 확인 → 공인중개사 매물 검토 → 행정사 신고 접수.<br>
      정밀 리포트에는 <strong>2·3년차 매출 시나리오</strong>와 <strong>월 고정비 전체 내역</strong>이 포함됩니다.
    </div>`;

  /* v6: PDF 샘플 미리보기 렌더링 */
  const pages=[
    {title:'인허가 체크리스트',rows:[{l:'영업 신고 종류',v:'휴게음식점 신고'},{l:'필요 면적',v:'제한 없음'},{l:'위생 시설',v:'✓ 충족'}],locked:false},
    {title:'3년 손익 시뮬레이션',rows:[{l:'1년차 매출',v:`${d.yearlyRev.y1.toLocaleString()}만원`},{l:'2년차 매출',v:'🔒 잠금',locked:true},{l:'3년차 매출',v:'🔒 잠금',locked:true}],locked:true},
    {title:'경쟁사 심층 분석',rows:[{l:'반경 500m 업체',v:`${d.competitors.length}곳`},{l:'상위 매출 추정',v:'🔒 잠금',locked:true},{l:'시장 점유율',v:'🔒 잠금',locked:true}],locked:true}
  ];
  document.getElementById('pdfPreview').innerHTML=pages.map((p,i)=>`
    <div class="pdf-page" onclick="showToast('정밀 리포트에서 전체 내용 확인 — 29,000원')">
      <div class="pdf-page-header"><span class="pdf-page-logo">🧭 창업지도</span><span class="pdf-page-num">p.${i+1}/10</span></div>
      <div class="pdf-page-body">
        <div class="pdf-section-title">${p.title}</div>
        ${p.rows.map(r=>`<div class="pdf-row"><span class="pdf-row-label">${r.l}</span><span class="pdf-row-val ${r.locked?'locked':''}">${r.v}</span></div>`).join('')}
        ${p.locked?'<div class="pdf-blur-row"></div><div class="pdf-blur-row" style="width:80%"></div>':''}
      </div>
      ${p.locked?'<div class="pdf-lock-overlay"><span class="pdf-lock-text">🔒 구매 후 열람</span></div>':''}
    </div>`).join('');
}

function renderStep5(){
  const d=selectedBizData;
  document.getElementById('propGrid').innerHTML=d.properties.map(p=>`
    <div class="prop-card">
      <div class="prop-thumb">${p.thumb}<span class="prop-thumb-badge">${p.badge}</span></div>
      <div class="prop-body">
        <div class="prop-area">📍 ${p.area}</div>
        <div class="prop-name">${p.name}</div>
        <div class="prop-pyung">📐 ${p.pyung}</div>
        <div class="prop-price">${p.price}</div>
        <div class="prop-rent">${p.rent}</div>
        <div class="prop-tags">${p.tags.map(t=>`<span class="p-tag">${t}</span>`).join('')}</div>
      </div>
    </div>`).join('');
}

function goStep(n){
  if(!selectedBizData&&n>1){showToast('업종을 먼저 선택해 주세요!');return}
  currentStep=n;
  document.querySelectorAll('.result-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.pb-step').forEach((p,i)=>{p.classList.remove('active','done');if(i+1<n)p.classList.add('done');if(i+1===n)p.classList.add('active')});
  document.getElementById('step'+n).classList.add('active');
  if(n===2)renderStep2();if(n===3)renderStep3();if(n===4)renderStep4();if(n===5)renderStep5();
  document.getElementById('result-area').scrollIntoView({behavior:'smooth',block:'start'});
}

function restart(){
  document.getElementById('result-area').style.display='none';
  document.getElementById('criticalBanner').style.display='none';
  document.getElementById('heroSection').style.display='';
  document.getElementById('servicesSection').style.display='';
  document.getElementById('howSection').style.display='';
  document.querySelector('.info-section').style.display='';
  document.querySelector('.stats-bar').style.display='';
  document.getElementById('bizInput').value='';
  document.getElementById('areaInput').value='';
  document.querySelectorAll('.stag').forEach(t=>t.classList.remove('active'));
  selectedBiz=null;selectedArea='';selectedBizData=null;currentStep=0;
  document.querySelectorAll('.load-stage').forEach(s=>s.classList.remove('active','done'));
  scrollToSearch();
}

document.getElementById('bizInput').addEventListener('keydown',e=>{if(e.key==='Enter')runAnalysis()});
document.getElementById('areaInput').addEventListener('keydown',e=>{if(e.key==='Enter')runAnalysis()});
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)}

/* ── PDF 리포트 생성 ── */
async function generateReport(tier) {
  const d = selectedBizData;
  if (!d) { showToast('먼저 업종과 지역을 선택해주세요'); return; }

  const ts        = calculateRiskScore(d);
  const gi        = getGradeInfo(ts, d.regulationFail);
  const profitS   = getProfitScore(d);
  const feasibleS = getFeasibleScore(d);
  const now       = new Date();
  const dateStr   = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;
  const reportNo  = 'CJ-' + Date.now().toString().slice(-8);
  const isPrem    = tier === 'premium';

  const gradeColor = gi.cls === 'safe' ? '#16a34a' : gi.cls === 'caution' ? '#ca8a04' : '#dc2626';
  const gradeBg    = gi.cls === 'safe' ? '#f0fdf4' : gi.cls === 'caution' ? '#fefce8' : '#fef2f2';
  const gradeLabel = gi.grade || (gi.cls === 'safe' ? '안전' : gi.cls === 'caution' ? '주의' : '위험');
  const gradeEmoji = gi.cls === 'safe' ? '✅' : gi.cls === 'caution' ? '⚠️' : '🚨';

  const realStores  = realApiData?.stores?.totalCount      ?? null;
  const realSame    = realApiData?.stores?.sameTypeCount   ?? null;
  const realZone    = realApiData?.landuse?.zoneType       ?? null;
  const realComp    = realApiData?.analysis?.competitionLevel ?? null;
  const realGrade   = realApiData?.analysis?.regulationGrade  ?? null;
  const realWarn    = realApiData?.analysis?.regulationWarning ?? null;
  const hasReal     = !!realApiData;

  const risks = [];
  if (d.regulationFail)        risks.push({ lv:'심각', txt:'인허가 불가 — 현재 위치 영업 허가 취득 불가능' });
  if (d.competitionScore < 40) risks.push({ lv:'주의', txt:`경쟁 과밀 — 반경 500m 내 동종 업소 밀집 (경쟁강도 ${d.competitionScore}점)` });
  if (d.locationScore < 50)    risks.push({ lv:'주의', txt:'입지 점수 낮음 — 유동인구·접근성 불리한 용도지역' });
  if (realWarn) risks.push({ lv:'주의', txt: realWarn.replace(/^⚠️\s*/, '') });

  /* ── 헬퍼 ── */
  const sectionTitle = (icon, text, borderColor) =>
    `<div style="font-size:13px;font-weight:800;color:#1b2a4a;padding-bottom:8px;border-bottom:2px solid ${borderColor||'#1b2a4a'};margin-bottom:12px;">${icon} ${text}</div>`;

  const metricBox = (label, score, color, locked, evidence) => locked
    ? `<td style="width:25%;padding:5px;"><div style="background:#f1f5f9;border:1.5px solid #e2e8f0;border-radius:10px;padding:16px 8px 12px;text-align:center;">
        <div style="font-size:10px;color:#94a3b8;font-weight:700;margin-bottom:10px;">${label}</div>
        <div style="font-size:34px;font-weight:900;color:#cbd5e1;line-height:1">??</div>
        <div style="font-size:9px;color:#94a3b8;margin-top:8px;">🔒 정밀 리포트 공개</div>
      </div></td>`
    : `<td style="width:25%;padding:5px;"><div style="background:${color}14;border:1.5px solid ${color}35;border-radius:10px;padding:16px 8px 12px;text-align:center;">
        <div style="font-size:10px;color:#64748b;font-weight:700;margin-bottom:8px;">${label}</div>
        <div style="font-size:38px;font-weight:900;color:${color};line-height:1">${score}</div>
        <div style="font-size:9px;color:#94a3b8;margin-top:3px;">/ 100점</div>
        <div style="background:#e2e8f0;border-radius:3px;height:5px;margin:10px 4px 0;overflow:hidden;"><div style="background:${color};height:5px;width:${score}%;border-radius:3px;"></div></div>
        ${evidence ? `<div style="font-size:9px;color:${color};font-weight:700;margin-top:7px;line-height:1.3;">${evidence}</div>` : ''}
      </div></td>`;

  const scenarioBox = (emoji, label, val, bg, border, color) =>
    `<td style="width:33%;padding:5px;"><div style="background:${bg};border:1.5px solid ${border};border-radius:10px;padding:16px 8px;text-align:center;">
      <div style="font-size:10px;color:${color};font-weight:700;margin-bottom:8px;">${emoji} ${label}</div>
      <div style="font-size:26px;font-weight:900;color:${color}">${val}<span style="font-size:12px;font-weight:600;margin-left:2px;">만원/월</span></div>
    </div></td>`;

  const infoBox = (label, val, sub) =>
    `<td style="width:33%;padding:5px;"><div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:14px 8px;text-align:center;">
      <div style="font-size:10px;color:#64748b;font-weight:700;margin-bottom:5px;">${label}</div>
      <div style="font-size:17px;font-weight:900;color:#1b2a4a;">${val}</div>
      ${sub ? `<div style="font-size:9px;color:#94a3b8;margin-top:3px;">${sub}</div>` : ''}
    </div></td>`;

  const compScore  = 100 - d.competitionScore;
  const compColor  = d.competitionScore < 40 ? '#dc2626' : d.competitionScore < 60 ? '#ca8a04' : '#16a34a';
  const locColor   = d.locationScore < 40 ? '#ca8a04' : d.locationScore < 65 ? '#2563eb' : '#16a34a';
  const profEvi    = d._evidence?.profit  || (hasReal ? '소상공인진흥공단 경쟁 보정' : '업종 평균 기준');
  const compEvi    = d._evidence?.competition || (hasReal ? `반경500m 상권 분석` : '상권분석 DB 기준');
  const locEvi     = d._evidence?.location || (hasReal ? realZone || 'VWorld 용도지역' : '위치 데이터 기준');
  const regEvi     = d._evidence?.regulation || (hasReal ? `규제 적합도 ${realGrade||'확인필요'}` : '건축법·용도지역 기준');

  const html = `<div id="pdfContent" style="width:794px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#1e293b;background:#fff;">

<!-- ①  헤더 -->
<div style="background:#1b2a4a;padding:28px 40px 22px;">
  <table style="width:100%;border-collapse:collapse;margin-bottom:16px;"><tr>
    <td style="vertical-align:top;padding:0;">
      <div style="font-size:9px;letter-spacing:2.5px;color:rgba(255,255,255,.35);margin-bottom:5px;">CHANGUP JIDO · 창업 리스크 분석 리포트</div>
      <div style="font-size:24px;font-weight:900;color:#fff;line-height:1.15;margin-bottom:10px;">창업 리스크 분석 리포트</div>
      <div style="display:inline-block;background:${isPrem?'#dc2626':'rgba(255,255,255,.15)'};color:#fff;font-size:9px;font-weight:800;padding:4px 14px;border-radius:100px;letter-spacing:1px;">${isPrem?'PREMIUM REPORT':'FREE SUMMARY'}</div>
      ${hasReal?`<div style="display:inline-block;background:rgba(52,211,153,.2);color:#34d399;font-size:9px;font-weight:800;padding:4px 12px;border-radius:100px;letter-spacing:1px;margin-left:6px;">LIVE DATA</div>`:''}
    </td>
    <td style="vertical-align:top;text-align:right;padding:0;font-size:11px;color:rgba(255,255,255,.45);line-height:2.1;">
      <div>리포트 번호 <strong style="color:#fff">${reportNo}</strong></div>
      <div>발행일 <strong style="color:#fff">${dateStr}</strong></div>
      <div>소상공인진흥공단 · 국토교통부 · VWorld</div>
    </td>
  </tr></table>

  <!-- 업종/지역/점수 패널 -->
  <div style="background:rgba(255,255,255,.1);border-radius:10px;padding:16px 22px;">
    <table style="width:100%;border-collapse:collapse;"><tr>
      <td style="padding:0 24px 0 0;vertical-align:middle;">
        <div style="font-size:9px;color:rgba(255,255,255,.4);font-weight:700;margin-bottom:5px;">분석 업종</div>
        <div style="font-size:19px;font-weight:900;color:#fff;">${d.icon||''} ${selectedBiz||'—'}</div>
        <div style="font-size:11px;color:rgba(255,255,255,.5);margin-top:2px;">${d.type||''}</div>
      </td>
      <td style="padding:0 0 0 24px;border-left:1px solid rgba(255,255,255,.2);vertical-align:middle;">
        <div style="font-size:9px;color:rgba(255,255,255,.4);font-weight:700;margin-bottom:5px;">분석 지역</div>
        <div style="font-size:19px;font-weight:900;color:#fff;">📍 ${selectedArea||'선택 지역'}</div>
        ${selectedCoords ? `<div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:2px;">좌표: ${selectedCoords.lat?.toFixed(4)}, ${selectedCoords.lng?.toFixed(4)}</div>` : ''}
      </td>
      <td style="width:175px;padding:0 0 0 24px;border-left:1px solid rgba(255,255,255,.2);text-align:center;vertical-align:middle;">
        <div style="font-size:9px;color:rgba(255,255,255,.4);font-weight:700;margin-bottom:6px;">종합 창업 안전 점수</div>
        <div style="font-size:56px;font-weight:900;color:${gi.cls==='safe'?'#4ade80':gi.cls==='caution'?'#fbbf24':'#f87171'};line-height:1;">${ts}</div>
        <div style="font-size:13px;font-weight:800;color:${gi.cls==='safe'?'#4ade80':gi.cls==='caution'?'#fbbf24':'#f87171'};margin-top:4px;">${gradeEmoji} ${gradeLabel}</div>
      </td>
    </tr></table>
  </div>
</div>

<!-- ② 본문 -->
<div style="padding:22px 40px;">

  <!-- 4대 핵심 지표 -->
  <div style="margin-bottom:20px;">
    ${sectionTitle('📊','4대 핵심 지표')}
    <table style="width:100%;border-collapse:collapse;"><tr>
      ${metricBox('수익성', profitS, '#16a34a', false, isPrem ? profEvi : null)}
      ${metricBox('실현가능성', feasibleS, feasibleS<50?'#dc2626':feasibleS<65?'#ca8a04':'#16a34a', false, isPrem ? (d._evidence?.regulation||null) : null)}
      ${metricBox('경쟁 우위', compScore, compColor, !isPrem, isPrem ? compEvi : null)}
      ${metricBox('입지 점수', d.locationScore, locColor, !isPrem, isPrem ? locEvi : null)}
    </tr></table>
    ${!isPrem ? '<div style="text-align:center;font-size:10px;color:#94a3b8;margin-top:8px;padding:8px;background:#f8fafc;border-radius:6px;">🔒 경쟁 우위·입지 점수는 <strong>정밀 리포트</strong>에서 공개됩니다</div>' : ''}
  </div>

  ${isPrem && hasReal ? `
  <!-- 실시간 공공데이터 -->
  <div style="margin-bottom:20px;">
    ${sectionTitle('🛰️','실시간 공공데이터')}
    <table style="width:100%;border-collapse:collapse;"><tr>
      <td style="width:25%;padding:5px;"><div style="background:#f0fdf4;border:1px solid #86efac;border-radius:10px;padding:14px;text-align:center;">
        <div style="font-size:9px;color:#16a34a;font-weight:700;margin-bottom:5px;">반경500m 상가</div>
        <div style="font-size:28px;font-weight:900;color:#1b2a4a;">${realStores??'—'}<span style="font-size:12px;color:#64748b;">개</span></div>
      </div></td>
      <td style="width:25%;padding:5px;"><div style="background:#eff6ff;border:1px solid #93c5fd;border-radius:10px;padding:14px;text-align:center;">
        <div style="font-size:9px;color:#2563eb;font-weight:700;margin-bottom:5px;">동종 업소</div>
        <div style="font-size:28px;font-weight:900;color:#1b2a4a;">${realSame??'—'}<span style="font-size:12px;color:#64748b;">개</span></div>
      </div></td>
      <td style="width:25%;padding:5px;"><div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:14px;text-align:center;">
        <div style="font-size:9px;color:#64748b;font-weight:700;margin-bottom:5px;">경쟁 강도</div>
        <div style="font-size:18px;font-weight:900;color:${realComp==='높음'||realComp==='매우높음'?'#dc2626':realComp==='낮음'?'#16a34a':'#ca8a04'}">${realComp??'—'}</div>
      </div></td>
      <td style="width:25%;padding:5px;"><div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:14px;text-align:center;">
        <div style="font-size:9px;color:#64748b;font-weight:700;margin-bottom:5px;">용도지역</div>
        <div style="font-size:14px;font-weight:900;color:#1b2a4a;">${realZone??'—'}</div>
      </div></td>
    </tr></table>
  </div>
  ` : ''}

  <!-- 수익성 시뮬레이션 -->
  <div style="margin-bottom:20px;">
    ${sectionTitle('💰','수익성 시뮬레이션')}
    ${isPrem ? `
    <table style="width:100%;border-collapse:collapse;margin-bottom:8px;"><tr>
      ${scenarioBox('😓','보수적',d.revPess,'#fef2f2','#fca5a5','#dc2626')}
      ${scenarioBox('😊','기본',  d.revBase,'#f0fdf4','#86efac','#16a34a')}
      ${scenarioBox('🚀','낙관',  d.revOpt, '#eff6ff','#93c5fd','#2563eb')}
    </tr></table>
    <table style="width:100%;border-collapse:collapse;"><tr>
      ${infoBox('손익분기점', d.bepMonths+'개월', '투자금 회수 기준')}
      ${infoBox('예상 초기비용', `${(d.costMin/10000).toFixed(0)}천~${(d.costMax/10000).toFixed(0)}천만원`, '임차+인테리어+운전')}
      ${infoBox('1년차 예상 매출', `${(d.yearlyRev?.y1?.toLocaleString?.()??'—')}만원`, '기본 시나리오 기준')}
    </tr></table>
    ` : `
    <div style="background:#f8fafc;border:2px dashed #e2e8f0;border-radius:10px;padding:26px;text-align:center;">
      <div style="font-size:26px;margin-bottom:8px;">🔒</div>
      <div style="font-size:13px;font-weight:700;color:#64748b;margin-bottom:5px;">정밀 리포트 전용</div>
      <div style="font-size:11px;color:#94a3b8;line-height:1.8;">보수적·기본·낙관 3가지 시나리오 수익 예측<br>손익분기점 · 초기비용 · 1~3년차 매출 예측</div>
    </div>`}
  </div>

  <!-- 리스크 경고 -->
  <div style="margin-bottom:20px;">
    ${sectionTitle('🚨','주요 리스크 진단', risks.length>0?'#dc2626':'#16a34a')}
    ${risks.length > 0 ? risks.map(r=>`
      <div style="padding:10px 16px;background:${r.lv==='심각'?'#fef2f2':'#fffbeb'};border-left:4px solid ${r.lv==='심각'?'#dc2626':'#ca8a04'};border-radius:0 8px 8px 0;margin-bottom:8px;">
        <table style="width:100%;border-collapse:collapse;"><tr>
          <td style="width:52px;padding:0;vertical-align:top;">
            <span style="display:inline-block;background:${r.lv==='심각'?'#dc2626':'#ca8a04'};color:#fff;font-size:9px;font-weight:800;padding:2px 7px;border-radius:100px;">${r.lv}</span>
          </td>
          <td style="padding:0 0 0 6px;font-size:11px;color:#1e293b;line-height:1.6;">${r.txt}</td>
        </tr></table>
      </div>`).join('') : `
      <div style="padding:16px;background:#f0fdf4;border:1.5px solid #86efac;border-radius:10px;text-align:center;">
        <div style="font-size:16px;margin-bottom:4px;">✅</div>
        <div style="font-size:12px;font-weight:700;color:#16a34a;">주요 리스크 없음 — 현재 조건 기준 안정적</div>
      </div>`}
  </div>

  ${isPrem && d.regulations ? `
  <!-- 법규·인허가 체크리스트 -->
  <div style="margin-bottom:20px;">
    ${sectionTitle('⚖️','법규·인허가 체크리스트')}
    <table style="width:100%;border-collapse:collapse;">
      ${d.regulations.map((r,i)=>`
        <tr style="border-bottom:1px solid #f1f5f9;">
          <td style="width:26px;padding:8px 0;font-size:14px;">${r.ok?'✅':'❌'}</td>
          <td style="padding:8px 6px;font-size:11px;color:${r.ok?'#1e293b':'#dc2626'};line-height:1.5;">${r.text}</td>
          <td style="width:60px;text-align:right;padding:8px 0;">
            <span style="font-size:9px;font-weight:700;color:${r.ok?'#16a34a':'#dc2626'};">${r.ok?'통과':'주의'}</span>
          </td>
        </tr>`).join('')}
    </table>
  </div>` : ''}

  ${!isPrem ? `
  <!-- 무료: 업그레이드 CTA -->
  <div style="margin-bottom:20px;background:linear-gradient(135deg,#1b2a4a,#1e3a5f);border-radius:12px;padding:22px 28px;text-align:center;">
    <div style="font-size:14px;font-weight:900;color:#fff;margin-bottom:8px;">🔓 정밀 리포트로 더 깊은 분석을</div>
    <div style="font-size:11px;color:rgba(255,255,255,.6);line-height:2;">
      ✓ 경쟁 우위·입지점수 상세 분석&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;✓ 3가지 수익 시나리오 &amp; 손익분기점<br>
      ✓ 실시간 공공데이터 상권 분석&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;✓ 법규·인허가 전체 체크리스트
    </div>
    <div style="margin-top:12px;display:inline-block;background:#fbbf24;color:#1b2a4a;font-size:12px;font-weight:900;padding:8px 24px;border-radius:8px;">changup-map.netlify.app 에서 정밀 리포트 열기 →</div>
  </div>` : ''}

  <!-- 면책 고지 -->
  <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:12px 16px;font-size:9.5px;color:#94a3b8;line-height:1.8;">
    <strong style="color:#64748b;">⚠ 면책 고지</strong>&nbsp;
    본 리포트는 소상공인진흥공단·국토교통부 공공데이터를 기반으로 생성한 참고 자료이며 법적 효력이 없습니다.
    실제 창업 결정 전 반드시 공인중개사·행정사 등 전문가와 현장 확인을 병행하시기 바랍니다.
    &nbsp;|&nbsp; 데이터 기준: ${dateStr}&nbsp;&nbsp;리포트 번호: ${reportNo}
  </div>

</div>
</div>`;

  showToast('📋 리포트 생성 중...');

  const container = document.createElement('div');
  container.style.cssText = 'position:fixed;top:0;left:0;width:794px;visibility:hidden;pointer-events:none;z-index:9999;';
  container.innerHTML = html;
  document.body.appendChild(container);

  const element = container.querySelector('#pdfContent');
  const filename = `창업지도_${selectedBiz}_${selectedArea||'분석'}_${dateStr}.pdf`;

  // 렌더링 대기 후 실제 높이 측정
  await new Promise(r => setTimeout(r, 700));
  const pdfHeight = Math.max(1050, (element.scrollHeight || element.offsetHeight) + 30);

  html2pdf().set({
    margin: 0,
    filename,
    image: { type: 'jpeg', quality: 0.97 },
    html2canvas: {
      scale: 2,
      useCORS: true,
      logging: false,
      width: 794,
      windowWidth: 794,
      scrollX: 0,
      scrollY: 0,
      backgroundColor: '#ffffff'
    },
    jsPDF: { unit: 'px', format: [794, pdfHeight], orientation: 'portrait' }
  }).from(element).save().then(() => {
    document.body.removeChild(container);
    showToast('✅ 리포트 다운로드 완료!');
  }).catch(err => {
    console.error('PDF 오류:', err);
    document.body.removeChild(container);
    showToast('⚠ 다운로드 실패. 다시 시도해주세요.');
  });
}

/* ── 실제 공공데이터 API 연동 ── */
let realApiData = null;

async function fetchRealAnalysis(lat, lng, bizType) {
  try {
    const params = new URLSearchParams({ lat, lng, bizType: bizType || '', radius: '500' });
    const res = await fetch(`/api/analyze?${params}`);
    if (!res.ok) return null;
    return await res.json();
  } catch (e) { console.warn('실제 API 호출 실패, 기본 데이터 사용:', e); return null; }
}

/* ─────────────────────────────────────────────────────────────
   실제 API 데이터 → 점수 재계산 (근거 기반 스코어링 엔진)

   [경쟁강도] 소상공인진흥공단 반경500m 동종업소 수 기준
   [입지점수] 국토교통부 VWorld 용도지역 분류 기준
   [규제점수] canOperate + regulationGrade 기준
   [수익성]   경쟁 과밀 시 하향 보정
───────────────────────────────────────────────────────────── */
function computeRealScores(d, apiData) {
  if (!apiData || !apiData.success) return d;
  const { analysis, stores, landuse } = apiData;
  const nd = Object.assign({}, d, { _evidence: {}, _realDataApplied: true });

  // ── 1. 경쟁강도 (competitionScore) ──────────────────────
  // 높을수록 유리(경쟁 적음). 동종 업소 수 기반.
  const sameCount = stores.sameTypeCount ?? 0;
  const totalCount = stores.totalCount ?? 0;
  let cs, ce;
  if (sameCount > 0) {
    // 동종 업소 카테고리 코드 매핑 성공 → 정확한 경쟁도
    if      (sameCount >= 16) { cs = 8;  ce = `동종 ${sameCount}개 · 포화`; }
    else if (sameCount >= 10) { cs = 22; ce = `동종 ${sameCount}개 · 극심`; }
    else if (sameCount >= 6)  { cs = 38; ce = `동종 ${sameCount}개 · 과밀`; }
    else if (sameCount >= 3)  { cs = 56; ce = `동종 ${sameCount}개 · 보통`; }
    else if (sameCount >= 1)  { cs = 74; ce = `동종 ${sameCount}개 · 저경쟁`; }
    else                      { cs = 82; ce = `동종 0개 · 독점 가능`; }
  } else {
    // 카테고리 미매핑 → 전체 상가 수로 대체 추정
    if      (totalCount >= 100) { cs = 18; ce = `전체상가 ${totalCount}개 · 상권과밀`; }
    else if (totalCount >= 50)  { cs = 38; ce = `전체상가 ${totalCount}개 · 밀집`; }
    else if (totalCount >= 20)  { cs = 60; ce = `전체상가 ${totalCount}개 · 보통`; }
    else                        { cs = 78; ce = `전체상가 ${totalCount}개 · 저밀`; }
  }
  nd.competitionScore = cs;
  nd._evidence.competition = `소상공인진흥공단 API · ${ce}`;

  // ── 2. 입지점수 (locationScore) ──────────────────────────
  // 용도지역별 영업 적합도 (국토교통부 LURIS 분류 기준)
  const zone = landuse.zoneType || '';
  if (zone) {
    let ls, le;
    if (zone.includes('전용주거')) {
      ls = 12; le = `${zone} · 상가 영업 불가`; nd.regulationFail = true;
    } else if (zone.includes('일반상업') || zone.includes('근린상업') || zone.includes('유통상업')) {
      ls = 92; le = `${zone} · 대부분 업종 최적`;
    } else if (zone.includes('준주거') || zone.includes('준공업')) {
      ls = 78; le = `${zone} · 대부분 허용`;
    } else if (zone.includes('제3종')) {
      ls = 66; le = `${zone} · 일부 제한`;
    } else if (zone.includes('제2종')) {
      ls = 55; le = `${zone} · 소규모 조건부`;
    } else if (zone.includes('제1종')) {
      ls = 42; le = `${zone} · 업종 제한`;
    } else if (zone.includes('공업')) {
      ls = 18; le = `${zone} · 상업시설 제한`; nd.regulationFail = true;
    } else if (zone.includes('녹지') || zone.includes('관리') || zone.includes('농림')) {
      ls = 10; le = `${zone} · 상업 불가`; nd.regulationFail = true;
    } else {
      ls = 62; le = `${zone} · 추가 확인 필요`;
    }
    nd.locationScore = ls;
    nd._evidence.location = `VWorld API · ${le}`;
  }

  // ── 3. 규제점수 (regulationScore) ────────────────────────
  // canOperate + regulationGrade (불가/주의/양호/최적/확인필요)
  if (!analysis.canOperate) {
    nd.regulationScore = 8; nd.regulationFail = true;
    nd._evidence.regulation = `규제 API · 영업 불가: ${analysis.regulationWarning || '용도지역 위반'}`;
  } else {
    const grade = analysis.regulationGrade;
    const rs = grade === '최적' ? 93 : grade === '양호' ? 80 : grade === '주의' ? 55 : 64;
    nd.regulationScore = rs;
    nd._evidence.regulation = `LURIS API · 규제 적합도 "${grade}"`;
  }

  // ── 4. 수익성 보정 (경쟁 과밀 시 하향) ────────────────────
  // 동종 업소 과밀 → 매출 실현 어려움 → profitScore 감산
  const pa = cs <= 22 ? -15 : cs <= 38 ? -10 : cs <= 56 ? -5 : 0;
  nd.profitScore = Math.max(10, Math.min(100, d.profitScore + pa));
  nd._evidence.profit = pa < 0
    ? `경쟁 과밀 보정 ${pa}점 (경쟁강도 ${cs}점 기반)`
    : '소상공인진흥공단 업종별 평균 매출 기준';
  nd._evidence.revenue = '소상공인진흥공단 업종별 평균 매출 통계';

  return nd;
}

function applyRealDataToStep2(data) {
  if (!data || !data.success) return;
  realApiData = data;
  const { analysis, stores, landuse, tradeArea } = data;

  // ── 점수 재계산 후 UI 업데이트 ─────────────────────────
  if (selectedBizData) {
    selectedBizData = computeRealScores(selectedBizData, data);
    const d2 = selectedBizData;
    const ts2 = calculateRiskScore(d2);
    const gi2 = getGradeInfo(ts2, d2.regulationFail);
    const profitS2 = getProfitScore(d2);
    const feasibleS2 = getFeasibleScore(d2);
    const gap2 = profitS2 - feasibleS2;
    const ev = d2._evidence || {};

    // 수익성 / 실현가능성 카드
    const fCls = feasibleS2<50?'feasible-card':feasibleS2<65?'feasible-card-ok':'feasible-card-safe';
    document.getElementById('dualScoreGrid').innerHTML = `
      <div class="dual-score-card profit-card">
        <div class="ds-label">수익성 점수 <span style="font-size:9px;background:#34d399;color:#000;padding:1px 5px;border-radius:3px;font-weight:700;">실시간</span></div>
        <div class="ds-score">${profitS2}</div>
        <div class="ds-badge" style="background:var(--green);">매출 잠재력 ${profitS2>=70?'높음':'보통'}</div>
        ${ev.profit?`<div style="font-size:9px;color:var(--muted);margin-top:4px;">📊 ${ev.profit}</div>`:''}
      </div>
      <div class="dual-score-card ${fCls}">
        <div class="ds-label">실현 가능성 <span style="font-size:9px;background:#34d399;color:#000;padding:1px 5px;border-radius:3px;font-weight:700;">실시간</span></div>
        <div class="ds-score">${feasibleS2}</div>
        <div class="ds-badge" style="background:${feasibleS2<50?'var(--red)':feasibleS2<65?'var(--yellow)':'var(--green)'};">${feasibleS2<50?'법규·경쟁 리스크':feasibleS2<65?'일부 리스크':'실현 가능'}</div>
      </div>`;
    document.getElementById('dualScoreGapWarning').innerHTML = gap2>=20?`
      <div class="ds-gap-warning"><div class="ds-gap-icon">⚡</div>
      <div class="ds-gap-text"><strong>격차 경고 (${gap2}점):</strong> 수익성은 높지만 실현 가능성이 낮습니다. 계약 전 법규 검토 필수.</div></div>`:'';

    // 4대 지표 (근거 포함)
    const qd2 = [
      {l:'입지', s:d2.locationScore, f:false, ev:ev.location||''},
      {l:'경쟁 우위', s:d2.competitionScore, f:false, ev:ev.competition||''},
      {l:'규제 적합', s:d2.regulationScore, f:d2.regulationFail, ev:ev.regulation||''},
      {l:'수익 전망', s:d2.revenueScore, f:false, ev:ev.revenue||''}
    ];
    document.getElementById('quadScores').innerHTML = qd2.map(q => {
      const c = q.f?'var(--red)':q.s>=70?'var(--green)':q.s>=50?'var(--yellow)':'var(--red)';
      const g = q.f?'FAIL':q.s>=80?'우수':q.s>=60?'양호':q.s>=40?'보통':'미흡';
      return `<div class="quad-item${q.f?' fatal':''}">
        <div class="quad-label">${q.l} <span style="font-size:9px;background:#34d399;color:#000;padding:1px 4px;border-radius:3px;">실시간</span></div>
        <div class="quad-score" style="color:${c}">${q.f?'0':q.s}</div>
        <div class="quad-grade" style="color:${c}">${g}</div>
        ${q.ev?`<div style="font-size:9px;color:var(--muted);margin-top:3px;line-height:1.4;">📊 ${q.ev}</div>`:''}
        ${q.f?'<div class="fatal-badge">⛔ 허가 불가</div>':''}
      </div>`;
    }).join('');

    // 종합 점수
    const diff2 = ts2 - (d2.areaAvgScore||60);
    document.getElementById('totalScoreArea').innerHTML = `
      <div style="background:${gi2.cls==='safe'?'var(--green-light)':gi2.cls==='caution'?'var(--yellow-light)':'var(--red-light)'};border:2px solid ${gi2.cls==='safe'?'#86efac':gi2.cls==='caution'?'#fcd34d':'#fca5a5'};border-radius:var(--r-lg);text-align:center;padding:22px 20px;${gi2.cls==='danger'?'animation:dangerGlow 2s ease infinite':''}">
        <div style="font-size:11px;font-weight:700;color:var(--muted);margin-bottom:4px;">종합 창업 안전 점수 <span style="font-size:9px;background:#34d399;color:#000;padding:1px 6px;border-radius:4px;">실시간 반영</span></div>
        <div style="font-size:52px;font-weight:900;color:${gi2.cls==='safe'?'var(--green)':gi2.cls==='caution'?'var(--yellow)':'var(--red)'};line-height:1">${ts2}</div>
        <div class="ts-badge ${gi2.cls}" style="margin-top:8px">${gi2.emoji} ${gi2.grade}</div>
      </div>
      <div class="avg-compare-row">
        <span class="avg-compare-label">지역 평균 비교</span>
        <div class="avg-compare-items">
          <div class="avg-compare-item"><span class="avg-dot me"></span><span class="avg-compare-text">내 분석: ${ts2}점</span></div>
          <div class="avg-compare-item"><span class="avg-dot avg"></span><span class="avg-compare-text">${d2.areaName||'지역'} 평균: ${d2.areaAvgScore}점</span></div>
        </div>
        <span class="avg-compare-badge ${diff2>=0?'up':'down'}">${diff2>=0?'▲ 평균 초과':'▼ 평균 미달'}</span>
      </div>`;

    // regulationFail 배너
    if (d2.regulationFail) {
      const banner = document.getElementById('criticalBanner');
      if (banner) {
        banner.innerHTML = `<div class="critical-global-banner"><span class="cgb-icon">🚨</span><span class="cgb-text">${analysis.regulationWarning||'현재 위치: 영업 불가 용도지역 — 보증금 계약 전 반드시 확인'}</span></div>`;
        banner.style.display = 'block';
      }
    }
  }

  // ── 실시간 공공데이터 박스 ────────────────────────────────
  const realBox = document.getElementById('realDataBox');
  if (realBox) {
    const sameCount = stores.sameTypeCount ?? 0;
    const topCats = stores.topCategories.slice(0, 3).map(c =>
      `<span style="background:rgba(255,255,255,.1);border-radius:4px;padding:2px 8px;font-size:11px;font-weight:700;color:#fff;">${c.name} ${c.count}개</span>`
    ).join(' ');

    const compColor = analysis.competitionLevel==='높음'||analysis.competitionLevel==='매우높음' ? '#f87171' : '#34d399';
    const zoneColor = analysis.regulationGrade==='불가' ? '#f87171' : analysis.regulationGrade==='최적' ? '#34d399' : '#fbbf24';

    realBox.innerHTML = `
      <div style="background:#0f172a;border:1px solid rgba(52,211,153,0.3);border-radius:10px;padding:16px;margin-bottom:16px;">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:12px;">
          <span style="background:rgba(52,211,153,0.15);color:#34d399;font-size:10px;font-weight:800;padding:2px 8px;border-radius:4px;">🛰️ 실시간 공공데이터</span>
          <span style="font-size:11px;color:rgba(255,255,255,0.3);">소상공인진흥공단 + 국토교통부</span>
        </div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:10px;">
          <div style="text-align:center;padding:10px 6px;background:rgba(255,255,255,0.04);border-radius:8px;">
            <div style="font-size:22px;font-weight:900;color:#fff;">${stores.totalCount}<span style="font-size:11px;color:rgba(255,255,255,.4);">개</span></div>
            <div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:2px;">반경 500m 상가</div>
          </div>
          <div style="text-align:center;padding:10px 6px;background:rgba(255,255,255,0.04);border-radius:8px;">
            <div style="font-size:14px;font-weight:900;color:#fff;">${sameCount > 0 ? sameCount+'개' : '—'}</div>
            <div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:2px;">동종 업소</div>
          </div>
          <div style="text-align:center;padding:10px 6px;background:rgba(255,255,255,0.04);border-radius:8px;">
            <div style="font-size:14px;font-weight:900;color:${compColor}">${analysis.competitionLevel}</div>
            <div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:2px;">경쟁 강도</div>
          </div>
          <div style="text-align:center;padding:10px 6px;background:rgba(255,255,255,0.04);border-radius:8px;">
            <div style="font-size:12px;font-weight:900;color:${zoneColor}">${landuse.zoneType||'확인중'}</div>
            <div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:2px;">용도지역</div>
          </div>
        </div>
        ${topCats ? `<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px;">${topCats}</div>` : ''}
        ${tradeArea.tradeAreaName ? `<div style="font-size:11px;color:rgba(255,255,255,.4);">📍 ${tradeArea.tradeAreaName} 상권</div>` : ''}
        <div style="margin-top:8px;font-size:10px;color:rgba(255,255,255,.25);">※ 위 데이터 기반으로 위 점수들이 실시간 재계산되었습니다</div>
      </div>
    `;
    realBox.style.display = 'block';
  }
}

// 실제 위치 좌표 저장 (지도 선택 시)
let selectedCoords = null;

/* ── 카카오맵 모달 ── */
let kakaoMap = null;
let kakaoMarker = null;
let selectedLatLng = null;
let selectedAddrFull = '';
let mapCurrentMode = 'select'; // 'select' | 'commercial'

function openMapModal(mode) {
  mapCurrentMode = mode || 'select';
  const modal = document.getElementById('mapModal');
  const inner = document.getElementById('mapModalInner');
  const title = document.getElementById('mapModalTitle');
  const badge = document.getElementById('mapModalBadge');
  const confirmBtn = document.getElementById('confirmAddrBtn');
  const btns = document.getElementById('mapModalBtns');

  if (mapCurrentMode === 'commercial') {
    // 상권 지도 모드 — 전체화면에 가깝게
    title.textContent = '🗺️ 상권 지도';
    badge.style.display = 'inline';
    inner.style.width = 'min(1000px, 98vw)';
    inner.style.maxHeight = '96vh';
    document.getElementById('kakaoMapDiv').style.height = '560px';
    // 하단 버튼: 이 지역 분석하기
    btns.innerHTML = `
      <button onclick="analyzeFromMap()" style="background:#dc2626;color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">이 지역 분석하기 →</button>
    `;
    document.getElementById('selectedAddrText').textContent = '📍 지도를 클릭해 상권을 선택하세요';
  } else {
    // 지역 선택 모드 — 기존
    title.textContent = '🗺️ 지역 선택';
    badge.style.display = 'none';
    inner.style.width = 'min(640px, 96vw)';
    inner.style.maxHeight = '92vh';
    document.getElementById('kakaoMapDiv').style.height = '420px';
    btns.innerHTML = `
      <button id="confirmAddrBtn" onclick="confirmAddress()" disabled style="background:#dc2626;color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;opacity:0.5;transition:all .2s;">이 위치로 선택 →</button>
    `;
    document.getElementById('selectedAddrText').textContent = '📍 지도를 클릭하거나 장소를 검색하세요';
  }

  modal.style.display = 'flex';
  setTimeout(() => {
    if (!kakaoMap) {
      const center = new kakao.maps.LatLng(37.5665, 126.9780); // 서울 중심
      kakaoMap = new kakao.maps.Map(document.getElementById('kakaoMapDiv'), {
        center: center,
        level: 5
      });
      kakaoMarker = new kakao.maps.Marker({ position: center, map: kakaoMap });
      kakaoMarker.setVisible(false);

      // 지도 클릭 시 주소 변환
      kakao.maps.event.addListener(kakaoMap, 'click', function(mouseEvent) {
        const latlng = mouseEvent.latLng;
        selectedLatLng = latlng;
        if(selectedCoords === undefined) selectedCoords = null;
        selectedCoords = { lat: latlng.getLat(), lng: latlng.getLng() };
        kakaoMarker.setPosition(latlng);
        kakaoMarker.setVisible(true);
        const geocoder = new kakao.maps.services.Geocoder();
        geocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
          if (status === kakao.maps.services.Status.OK) {
            const addr = result[0].road_address
              ? result[0].road_address.address_name
              : result[0].address.address_name;
            selectedAddrFull = addr;
            // ✅ 검색창도 지도 클릭 주소로 업데이트
            document.getElementById('mapSearchInput').value = addr;
            document.getElementById('selectedAddrText').textContent = '📍 ' + addr;
            enableMapConfirm();
          }
        });
      });
    } else {
      kakaoMap.relayout();
    }
  }, 100);
}

function closeMapModal() {
  document.getElementById('mapModal').style.display = 'none';
}

function searchMapPlace() {
  const keyword = document.getElementById('mapSearchInput').value.trim();
  if (!keyword) { showToast('검색어를 입력해주세요'); return; }
  const ps = new kakao.maps.services.Places();
  ps.keywordSearch(keyword, function(data, status) {
    if (status === kakao.maps.services.Status.OK) {
      const first = data[0];
      const latlng = new kakao.maps.LatLng(first.y, first.x);
      kakaoMap.setCenter(latlng);
      kakaoMap.setLevel(4);
      selectedLatLng = latlng;
      kakaoMarker.setPosition(latlng);
      kakaoMarker.setVisible(true);
      selectedAddrFull = first.place_name || first.road_address_name || first.address_name || keyword;
      // ✅ 검색 결과도 장소명으로 검색창 업데이트
      document.getElementById('mapSearchInput').value = selectedAddrFull;
      document.getElementById('selectedAddrText').textContent = '📍 ' + first.place_name + (first.road_address_name ? ' — ' + first.road_address_name : '');
      enableMapConfirm();
    } else {
      showToast('검색 결과가 없습니다. 다른 키워드를 입력해보세요');
    }
  });
}

function confirmAddress() {
  // ✅ 항상 마지막으로 선택된 주소(selectedAddrFull) 사용
  const displayName = selectedAddrFull || document.getElementById('mapSearchInput').value.trim();
  if (!displayName) { showToast('먼저 지도에서 위치를 선택하거나 장소를 검색하세요'); return; }
  document.getElementById('areaInput').value = displayName;
  selectedArea = displayName;
  if (selectedLatLng) selectedCoords = { lat: selectedLatLng.getLat(), lng: selectedLatLng.getLng() };
  closeMapModal();
  showToast('📍 선택 완료: ' + displayName);
}

function analyzeFromMap() {
  const displayName = document.getElementById('mapSearchInput').value.trim() || selectedAddrFull;
  if (!displayName) { showToast('먼저 지도에서 위치를 선택해주세요'); return; }
  document.getElementById('areaInput').value = displayName;
  selectedArea = displayName;
  closeMapModal();
  showToast('📍 ' + displayName + ' — 분석을 시작합니다!');
  setTimeout(() => { runAnalysis(); }, 500);
}

function enableMapConfirm() {
  const btn = document.getElementById('confirmAddrBtn');
  if (btn) { btn.disabled = false; btn.style.opacity = '1'; }
}

document.getElementById('mapSearchInput') && document.getElementById('mapSearchInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') searchMapPlace();
});

// 페이지 로드 시 결제 결과 파라미터 처리
window.addEventListener('load', () => { handlePaymentResult(); });

/* ═══════════════════════════════════════════════
   핫트렌드
═══════════════════════════════════════════════ */
const TREND_DATA = {
  rising: [
    { icon:'🤖', name:'무인카페·무인매장', sub:'인건비 절감 + 24시간 운영', change:'+38%', bar:95, badge:'hot' },
    { icon:'💅', name:'네일샵',           sub:'SNS 바이럴 + 재방문율 높음',  change:'+22%', bar:72, badge:'hot' },
    { icon:'💪', name:'소형 PT 헬스장',   sub:'1인 운동 트렌드 급성장',       change:'+18%', bar:60, badge:'new' },
    { icon:'🥐', name:'베이커리 카페',    sub:'복합 공간 수요 증가',           change:'+15%', bar:52 },
    { icon:'🏪', name:'편의점',           sub:'점포 수 꾸준한 성장세',         change:'+12%', bar:45 },
    { icon:'🍱', name:'분식집',           sub:'혼밥·간편식 수요 증가',         change:'+9%',  bar:36 },
  ],
  falling: [
    { icon:'🎤', name:'노래방',   sub:'유흥 업종 전반 침체',    change:'-14%', bar:45 },
    { icon:'🖥', name:'PC방',    sub:'게임 플랫폼 다변화',     change:'-9%',  bar:30 },
    { icon:'🥢', name:'중국집',  sub:'배달 전문 전환 압박',     change:'-7%',  bar:22 },
    { icon:'🍺', name:'일반 술집',sub:'주류 소비 전반 감소세',  change:'-5%',  bar:16 },
  ],
  regions: [
    { name:'성수동', city:'서울', tags:['카페','베이커리','팝업스토어'], score:98 },
    { name:'광교',   city:'경기', tags:['헬스장','카페','네일샵'],       score:87 },
    { name:'해운대', city:'부산', tags:['카페','편의점','분식'],          score:82 },
    { name:'신흥동', city:'성남', tags:['무인매장','편의점','카페'],      score:76 },
    { name:'봉담',   city:'화성', tags:['헬스장','미용실','분식'],        score:71 },
    { name:'제주 시내',city:'제주',tags:['카페','편의점','베이커리'],     score:68 },
  ],
};

function openTrend() {
  document.getElementById('trendOverlay').classList.add('open');
  setNavActive('핫트렌드');
  renderTrend();
}
function closeTrend() {
  document.getElementById('trendOverlay').classList.remove('open');
  setNavActive('보증금 검증');
}
function setNavActive(label) {
  document.querySelectorAll('.nav-menu-item').forEach(el => {
    el.classList.toggle('active', el.textContent.trim() === label);
  });
}

function renderTrend() {
  const el = document.getElementById('trendBody');
  const updated = new Date().toLocaleDateString('ko-KR', { year:'numeric', month:'long', day:'numeric' });
  el.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:8px;">
      <div>
        <div style="font-size:20px;font-weight:900;color:var(--text);">📈 이달의 업종 트렌드</div>
        <div style="font-size:12px;color:var(--light);margin-top:3px;">소상공인진흥공단 · 네이버 검색 트렌드 · 공정거래위원회 기준 / ${updated}</div>
      </div>
      <span style="font-size:11px;background:var(--red-light);color:var(--red);border:1px solid #fecaca;padding:4px 10px;border-radius:100px;font-weight:700;">🔴 LIVE 업데이트</span>
    </div>

    <!-- 상승 트렌드 -->
    <div style="font-size:11px;font-weight:700;color:var(--light);letter-spacing:.8px;margin-bottom:12px;">▲ 상승 업종 TOP 6</div>
    <div class="trend-grid" style="margin-bottom:28px;">
      ${TREND_DATA.rising.map((t,i) => `
        <div class="trend-card">
          <div class="trend-rank ${i<3?'top3':''}">${i+1}</div>
          <div style="font-size:26px;line-height:1">${t.icon}</div>
          <div class="trend-info">
            <div class="trend-name">${t.name}${t.badge==='hot'?'<span class="hot-badge">HOT</span>':t.badge==='new'?'<span class="new-badge">NEW</span>':''}</div>
            <div class="trend-sub">${t.sub}</div>
            <div class="trend-bar-wrap"><div class="trend-bar" style="width:${t.bar}%;background:${i<3?'var(--red)':'var(--orange)'}"></div></div>
          </div>
          <div class="trend-change up">${t.change}</div>
        </div>`).join('')}
    </div>

    <!-- 하락 트렌드 -->
    <div style="font-size:11px;font-weight:700;color:var(--light);letter-spacing:.8px;margin-bottom:12px;">▼ 주의 업종</div>
    <div class="trend-grid" style="margin-bottom:28px;">
      ${TREND_DATA.falling.map((t,i) => `
        <div class="trend-card">
          <div class="trend-rank" style="color:var(--light)">${i+1}</div>
          <div style="font-size:26px;line-height:1">${t.icon}</div>
          <div class="trend-info">
            <div class="trend-name" style="color:var(--muted)">${t.name}</div>
            <div class="trend-sub">${t.sub}</div>
            <div class="trend-bar-wrap"><div class="trend-bar" style="width:${t.bar}%;background:var(--light)"></div></div>
          </div>
          <div class="trend-change down">${t.change}</div>
        </div>`).join('')}
    </div>

    <!-- 핫 지역 -->
    <div style="font-size:11px;font-weight:700;color:var(--light);letter-spacing:.8px;margin-bottom:12px;">🔥 급성장 상권</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
      ${TREND_DATA.regions.map(r => `
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-lg);padding:14px;text-align:center;transition:all .2s;cursor:default;" onmouseover="this.style.borderColor='var(--blue-light)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size:15px;font-weight:800;color:var(--text)">${r.name}</div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px">${r.city}</div>
          <div style="display:flex;flex-wrap:wrap;gap:4px;justify-content:center;margin-bottom:8px">${r.tags.map(t=>`<span style="font-size:10px;background:var(--blue-bg);color:var(--blue);border:1px solid var(--blue-light);padding:2px 7px;border-radius:100px;font-weight:600">${t}</span>`).join('')}</div>
          <div style="font-size:11px;font-weight:700;color:var(--blue)">${r.score}점</div>
        </div>`).join('')}
    </div>
    <div style="margin-top:20px;padding:14px 16px;background:var(--surface2);border-radius:var(--r);border:1px solid var(--border);font-size:12px;color:var(--light);line-height:1.7;">
      💡 트렌드 데이터는 소상공인진흥공단 상권분석 통계, 네이버 검색트렌드, 공정거래위원회 가맹사업 현황을 종합하여 매월 업데이트됩니다.
    </div>`;
}

/* ═══════════════════════════════════════════════
   정책 가이드
═══════════════════════════════════════════════ */
const POLICY_DATA = [
  {
    cat:'창업 지원금', catColor:'#2563eb', catBg:'#dbeafe',
    name:'소상공인 창업 패키지',
    org:'소상공인시장진흥공단',
    amount:'최대 1,000만 원',
    desc:'예비·초기 소상공인(창업 3년 이내)에게 사업화 자금, 멘토링, 교육을 패키지로 지원합니다.',
    tags:['예비창업자','초기창업','사업화 자금'],
    deadline:'상시 (연 2회 모집)',
    url:'https://www.sbiz.or.kr',
  },
  {
    cat:'창업 지원금', catColor:'#2563eb', catBg:'#dbeafe',
    name:'청년창업 특례보증',
    org:'신용보증기금',
    amount:'최대 1억 원',
    desc:'만 39세 이하 청년 창업자에게 보증료 면제 또는 감면 혜택과 함께 창업 초기 운전자금을 지원합니다.',
    tags:['만39세 이하','보증료 감면','운전자금'],
    deadline:'연중 접수',
    url:'https://www.kodit.co.kr',
  },
  {
    cat:'정책자금·대출', catColor:'#0d9488', catBg:'#ccfbf1',
    name:'소상공인 정책자금',
    org:'소상공인시장진흥공단',
    amount:'최대 7,000만 원 (금리 2~3%대)',
    desc:'일반·성장촉진·특별경영안정·긴급경영안정 등 목적에 따라 저금리로 운영자금과 시설자금을 지원합니다.',
    tags:['저금리','운전자금','시설자금'],
    deadline:'예산 소진 시 마감 (조기 신청 권장)',
    url:'https://ols.sbiz.or.kr',
  },
  {
    cat:'정책자금·대출', catColor:'#0d9488', catBg:'#ccfbf1',
    name:'지역신용보증재단 특례보증',
    org:'각 지역 신용보증재단',
    amount:'최대 5,000만 원',
    desc:'지역 소재 소상공인을 대상으로 신용보증서를 발급하여 금융기관 대출을 지원합니다. 보증료율 0.5~1.0%.',
    tags:['지역한정','신용보증','0.5~1.0%'],
    deadline:'연중 접수',
    url:'https://www.koreg.or.kr',
  },
  {
    cat:'교육·컨설팅', catColor:'#7c3aed', catBg:'#ede9fe',
    name:'소상공인 무료 컨설팅',
    org:'소상공인시장진흥공단',
    amount:'무료 (전문가 1:1 컨설팅)',
    desc:'경영·세무·마케팅·법무 분야 전문가가 1:1로 무료 상담을 제공합니다. 방문·온라인·현장 컨설팅 선택 가능.',
    tags:['무료','전문가 상담','현장 컨설팅'],
    deadline:'상시',
    url:'https://www.sbiz.or.kr/sup/manage/consult.do',
  },
  {
    cat:'교육·컨설팅', catColor:'#7c3aed', catBg:'#ede9fe',
    name:'창업넷 온라인 교육',
    org:'창업진흥원',
    amount:'무료 (300+ 강좌)',
    desc:'창업 기획부터 마케팅·세무·법률까지 300개 이상의 온라인 강좌를 무료로 수강할 수 있습니다.',
    tags:['온라인','무료','300개+ 강좌'],
    deadline:'상시',
    url:'https://www.k-startup.go.kr',
  },
  {
    cat:'세금·혜택', catColor:'#ea580c', catBg:'#fff7ed',
    name:'소상공인 세금 감면',
    org:'국세청',
    amount:'소득세 50~100% 감면',
    desc:'창업 중소기업·소상공인은 최초 창업 후 5년간 소득세 또는 법인세를 50~100% 감면받을 수 있습니다 (지역·업종 조건).',
    tags:['소득세 감면','5년','창업 중소기업'],
    deadline:'창업일로부터 5년 적용',
    url:'https://www.nts.go.kr',
  },
  {
    cat:'세금·혜택', catColor:'#ea580c', catBg:'#fff7ed',
    name:'간이과세자 혜택',
    org:'국세청',
    amount:'연 매출 8,000만 원 미만',
    desc:'연 매출 8,000만 원 미만 소상공인은 간이과세자로 등록해 부가세 납부 부담을 크게 줄일 수 있습니다.',
    tags:['부가세 절감','간이과세','신규 창업'],
    deadline:'창업 시 신청',
    url:'https://www.nts.go.kr',
  },
];

let activePolicyCat = '전체';

function openPolicy() {
  document.getElementById('policyOverlay').classList.add('open');
  setNavActive('정책 가이드');
  renderPolicy('전체');
}
function closePolicy() {
  document.getElementById('policyOverlay').classList.remove('open');
  setNavActive('보증금 검증');
}

function renderPolicy(cat) {
  activePolicyCat = cat;
  const cats = ['전체', '창업 지원금', '정책자금·대출', '교육·컨설팅', '세금·혜택'];
  const filtered = cat === '전체' ? POLICY_DATA : POLICY_DATA.filter(p => p.cat === cat);

  document.getElementById('policyBody').innerHTML = `
    <div style="margin-bottom:20px;">
      <div style="font-size:20px;font-weight:900;color:var(--text);margin-bottom:4px;">📋 창업 지원 정책 가이드</div>
      <div style="font-size:12px;color:var(--light);">정부·공공기관 지원 프로그램 총 ${POLICY_DATA.length}건 · 2025년 기준</div>
    </div>
    <div class="policy-tabs">
      ${cats.map(c => `<div class="policy-tab${c===cat?' active':''}" onclick="renderPolicy('${c}')">${c === '전체' ? '🗂 전체' : c}</div>`).join('')}
    </div>
    ${filtered.map(p => `
      <div class="policy-card">
        <div class="policy-card-header">
          <div style="flex:1">
            <span class="policy-badge" style="background:${p.catBg};color:${p.catColor};">${p.cat}</span>
            <div style="font-size:16px;font-weight:800;color:var(--text);margin-top:6px;">${p.name}</div>
            <div style="font-size:12px;color:var(--muted);margin-top:2px;">🏛 ${p.org}</div>
          </div>
          <div style="text-align:right;flex-shrink:0">
            <div class="policy-amount">${p.amount}</div>
            <div style="font-size:11px;color:var(--muted);">📅 ${p.deadline}</div>
          </div>
        </div>
        <div class="policy-desc">${p.desc}</div>
        <div class="policy-tags">${p.tags.map(t=>`<span class="policy-tag">${t}</span>`).join('')}</div>
        <a href="${p.url}" target="_blank" rel="noopener" class="policy-link">신청 바로가기 →</a>
      </div>`).join('')}
    <div style="padding:14px 16px;background:var(--surface2);border-radius:var(--r);border:1px solid var(--border);font-size:12px;color:var(--light);line-height:1.7;margin-top:4px;">
      ⚠️ 지원 정책은 예산 소진·조건 변경 등으로 수시 변경됩니다. 신청 전 반드시 해당 기관 공식 사이트에서 최신 정보를 확인하세요.
    </div>`;
}

/* ═══════════════════════════════════════════════
   Supabase Auth
═══════════════════════════════════════════════ */
const SUPABASE_URL = 'https://xrxfmaeesbvitryrlsgw.supabase.co';
const SUPABASE_KEY = 'sb_publishable_-ROHxUA1EwpwgD4l6eT-SQ_fFwPtlUp';
const _sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let currentUser = null;

// 앱 시작 시 세션 복원
(async () => {
  const { data: { session } } = await _sb.auth.getSession();
  if (session) { currentUser = session.user; updateAuthUI(true); }
})();

// 로그인 상태 변경 감지
_sb.auth.onAuthStateChange((event, session) => {
  currentUser = session?.user || null;
  updateAuthUI(!!currentUser);
  if (event === 'SIGNED_IN') {
    closeAuthModal();
    showToast(`👋 환영합니다, ${getNickname()}!`);
    syncLocalHistoryToSupabase();
  }
  if (event === 'SIGNED_OUT') showToast('👋 로그아웃되었습니다');
});

function getNickname() {
  return currentUser?.user_metadata?.nickname
    || currentUser?.email?.split('@')[0]
    || '사용자';
}

function updateAuthUI(loggedIn) {
  document.getElementById('authGuestBtns').style.display = loggedIn ? 'none' : 'flex';
  document.getElementById('authUserMenu').style.display  = loggedIn ? 'block' : 'none';
  document.getElementById('mypageNavBtn').style.display  = loggedIn ? 'none' : 'block';
  if (loggedIn) {
    document.getElementById('navNickname').textContent = getNickname();
  }
}

// Auth 모달 열기/닫기/탭 전환
function openAuthModal(tab) {
  document.getElementById('authOverlay').classList.add('open');
  showAuthTab(tab || 'login');
  setTimeout(() => {
    const el = document.getElementById(tab === 'signup' ? 'signupNick' : 'loginEmail');
    if (el) el.focus();
  }, 100);
}
function closeAuthModal() {
  document.getElementById('authOverlay').classList.remove('open');
  // 에러/값 초기화
  ['loginEmail','loginPw','signupNick','signupEmail','signupPw','signupPw2'].forEach(id => {
    const el = document.getElementById(id); if (el) el.value = ''; el?.classList.remove('error');
  });
  document.getElementById('loginError').classList.remove('show');
  document.getElementById('signupError').classList.remove('show');
}
function showAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.getElementById('authLoginPane').style.display  = tab === 'login'  ? 'block' : 'none';
  document.getElementById('authSignupPane').style.display = tab === 'signup' ? 'block' : 'none';
}

// 에러 표시 헬퍼
function showAuthError(pane, msg) {
  const el = document.getElementById(pane + 'Error');
  el.textContent = msg; el.classList.add('show');
}
function clearAuthError(pane) {
  document.getElementById(pane + 'Error').classList.remove('show');
}

// 로그인
async function handleSignIn() {
  const email = document.getElementById('loginEmail').value.trim();
  const pw    = document.getElementById('loginPw').value;
  clearAuthError('login');
  if (!email || !pw) { showAuthError('login', '이메일과 비밀번호를 입력해주세요.'); return; }
  const btn = document.getElementById('loginBtn');
  btn.disabled = true; btn.textContent = '로그인 중...';
  const { error } = await _sb.auth.signInWithPassword({ email, password: pw });
  btn.disabled = false; btn.textContent = '로그인';
  if (error) {
    const msg = error.message.includes('Invalid login') ? '이메일 또는 비밀번호가 올바르지 않습니다.'
              : error.message.includes('Email not confirmed') ? '이메일 인증 후 로그인해주세요.'
              : error.message;
    showAuthError('login', msg);
  }
}

// 회원가입
async function handleSignUp() {
  const nick  = document.getElementById('signupNick').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const pw    = document.getElementById('signupPw').value;
  const pw2   = document.getElementById('signupPw2').value;
  clearAuthError('signup');
  if (!nick)        { showAuthError('signup', '닉네임을 입력해주세요.'); return; }
  if (!email)       { showAuthError('signup', '이메일을 입력해주세요.'); return; }
  if (pw.length < 6){ showAuthError('signup', '비밀번호는 6자 이상이어야 합니다.'); return; }
  if (pw !== pw2)   { showAuthError('signup', '비밀번호가 일치하지 않습니다.'); return; }
  const btn = document.getElementById('signupBtn');
  btn.disabled = true; btn.textContent = '가입 중...';
  const { error } = await _sb.auth.signUp({
    email, password: pw,
    options: { data: { nickname: nick } }
  });
  btn.disabled = false; btn.textContent = '회원가입';
  if (error) {
    const msg = error.message.includes('already registered') ? '이미 사용 중인 이메일입니다.'
              : error.message;
    showAuthError('signup', msg);
  } else {
    // 이메일 확인 없이 바로 로그인 (Supabase 기본: 확인 메일 발송)
    closeAuthModal();
    showToast('✅ 가입 완료! 이메일 인증 후 로그인하세요.');
  }
}

// 로그아웃
async function handleSignOut() {
  closeUserMenu();
  await _sb.auth.signOut();
}

// 유저 드롭다운
function toggleUserMenu() {
  document.getElementById('userMenuDropdown').classList.toggle('open');
}
function closeUserMenu() {
  document.getElementById('userMenuDropdown').classList.remove('open');
}
// 외부 클릭 시 드롭다운 닫기
document.addEventListener('click', e => {
  if (!e.target.closest('.user-menu')) closeUserMenu();
});

// localStorage 분석 내역 → Supabase 동기화 (로그인 시 1회)
async function syncLocalHistoryToSupabase() {
  if (!currentUser) return;
  // 추후 Supabase DB 테이블 추가 시 확장
  // 현재는 로컬 유지
}

/* ═══════════════════════════════════════════════
   마이페이지
═══════════════════════════════════════════════ */
const MP_HISTORY_KEY = 'changup_history';
const MP_ACCOUNT_KEY = 'changup_account';

function openMypage() {
  document.getElementById('mypageOverlay').classList.add('open');
  showMpTab('history');
}
function closeMypage() {
  document.getElementById('mypageOverlay').classList.remove('open');
}
function showMpTab(tab) {
  document.querySelectorAll('.mp-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.querySelectorAll('.mp-pane').forEach(p => p.style.display = p.dataset.pane === tab ? 'block' : 'none');
  if (tab === 'history') renderMpHistory();
  if (tab === 'membership') renderMpMembership();
  if (tab === 'account') renderMpAccount();
}

// 분석 완료 시 호출 — renderStep2에서 자동 저장
function saveAnalysisToHistory(biz, area, score, grade) {
  if (!biz || !score) return;
  const history = JSON.parse(localStorage.getItem(MP_HISTORY_KEY) || '[]');
  const item = { id: Date.now(), biz, area: area || '지역 미지정', score, grade, date: new Date().toLocaleDateString('ko-KR'), icon: BIZ_DB[biz]?.icon || '🏪' };
  const deduped = history.filter(h => !(h.biz === biz && h.area === item.area && h.score === score));
  deduped.unshift(item);
  localStorage.setItem(MP_HISTORY_KEY, JSON.stringify(deduped.slice(0, 20)));
}

function renderMpHistory() {
  const history = JSON.parse(localStorage.getItem(MP_HISTORY_KEY) || '[]');
  const el = document.getElementById('mpHistoryPane');
  if (!history.length) {
    el.innerHTML = `<div class="mp-empty"><div class="mp-empty-icon">📊</div><div style="font-size:15px;font-weight:700;color:var(--muted);margin-bottom:6px;">분석 내역이 없습니다</div><div style="font-size:13px;color:var(--light);">업종 검증을 완료하면 여기에 자동으로 기록됩니다</div></div>`;
    return;
  }
  el.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;"><div class="mp-section-title">최근 분석 내역 (${history.length}건)</div><button onclick="clearMpHistory()" style="font-size:11px;color:var(--light);background:none;border:none;cursor:pointer;padding:4px 8px;border-radius:var(--r);transition:all .15s;" onmouseover="this.style.color='var(--red)'" onmouseout="this.style.color='var(--light)'">전체 삭제</button></div>` +
    history.map(h => {
      const cls = h.score >= 70 ? 'var(--green)' : h.score >= 50 ? 'var(--yellow)' : 'var(--red)';
      return `<div class="mp-analysis-item">
        <div style="font-size:30px;line-height:1;min-width:36px;text-align:center">${h.icon}</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:14px;font-weight:700;color:var(--text)">${h.biz}</div>
          <div style="font-size:12px;color:var(--muted);margin-top:2px;">📍 ${h.area} · ${h.date}</div>
        </div>
        <div style="text-align:right;flex-shrink:0;">
          <div style="font-size:22px;font-weight:900;color:${cls};line-height:1">${h.score}<span style="font-size:12px;">점</span></div>
          <div style="font-size:11px;font-weight:700;color:${cls};margin-top:2px;">${h.grade}</div>
        </div>
      </div>`;
    }).join('');
}

function clearMpHistory() {
  if (!confirm('분석 내역을 모두 삭제하시겠습니까?')) return;
  localStorage.removeItem(MP_HISTORY_KEY);
  renderMpHistory();
}

function renderMpMembership() {
  const freeFeatures = ['기본 업종 분석 (13종)', '지역별 리스크 등급', '무료 PDF 리포트', '상권 지도 열람'];
  const freeLocked = ['정밀 리포트 전체 공개', '무제한 분석 횟수', '실시간 경쟁 모니터링', '맞춤 컨설팅 매칭'];
  const premFeatures = ['무료 플랜 모든 기능', '정밀 리포트 전체 공개', '무제한 분석 횟수', '실시간 경쟁 모니터링', '맞춤 컨설팅 매칭', '우선 고객 지원'];
  const premium = isPremium();
  const membership = getMembership();
  const expiryStr = membership.expiry ? new Date(membership.expiry).toLocaleDateString('ko-KR') : null;

  document.getElementById('mpMembershipPane').innerHTML = `
    <div class="mp-section-title">플랜 비교</div>
    <div class="mp-plan-grid">
      <div class="mp-plan-card ${!premium ? 'active-plan' : ''}">
        ${!premium ? `<span class="mp-plan-badge" style="background:var(--blue-light);color:var(--blue);">현재 이용 중</span>` : `<span class="mp-plan-badge" style="background:var(--surface2);color:var(--muted);">무료</span>`}
        <div style="font-size:17px;font-weight:900;color:var(--navy);margin-bottom:6px;">무료 플랜</div>
        <div style="font-size:24px;font-weight:900;color:var(--text);margin-bottom:18px;">₩0<span style="font-size:13px;font-weight:500;color:var(--muted)">/월</span></div>
        <ul style="list-style:none;display:flex;flex-direction:column;gap:9px;">
          ${freeFeatures.map(f => `<li style="font-size:13px;color:var(--text2);display:flex;align-items:center;gap:8px;"><span style="color:var(--green);font-weight:700;font-size:15px;">✓</span>${f}</li>`).join('')}
          ${freeLocked.map(f => `<li style="font-size:13px;color:var(--light);display:flex;align-items:center;gap:8px;"><span style="font-size:13px;">🔒</span><span style="text-decoration:line-through">${f}</span></li>`).join('')}
        </ul>
      </div>
      <div class="mp-plan-card premium-plan ${premium ? 'active-plan' : ''}" style="${premium ? 'border-color:var(--yellow);background:var(--yellow-light);' : ''}">
        ${premium ? `<span class="mp-plan-badge" style="background:#fef9c3;color:#92400e;">현재 이용 중 ✓</span>` : `<span class="mp-plan-badge" style="background:#fef9c3;color:#92400e;">PREMIUM</span>`}
        <div style="font-size:17px;font-weight:900;color:var(--navy);margin-bottom:6px;">프리미엄 플랜</div>
        <div style="font-size:24px;font-weight:900;color:var(--text);margin-bottom:${premium?'8':'18'}px;">₩29,000<span style="font-size:13px;font-weight:500;color:var(--muted)">/월</span></div>
        ${premium && expiryStr ? `<div style="font-size:12px;color:var(--muted);margin-bottom:14px;background:rgba(202,138,4,.1);padding:6px 10px;border-radius:var(--r);">📅 ${expiryStr} 까지 이용 가능</div>` : ''}
        <ul style="list-style:none;display:flex;flex-direction:column;gap:9px;">
          ${premFeatures.map(f => `<li style="font-size:13px;color:var(--text2);display:flex;align-items:center;gap:8px;"><span style="color:var(--yellow);font-weight:700;font-size:15px;">✓</span>${f}</li>`).join('')}
        </ul>
        ${!premium ? `<button onclick="closeMypage();startPayment();" style="width:100%;margin-top:18px;background:linear-gradient(135deg,#ca8a04,#d97706);color:#fff;border:none;border-radius:var(--r);padding:13px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:0 2px 8px rgba(202,138,4,.3);">💳 카드결제로 업그레이드 →</button>` : `<div style="margin-top:18px;text-align:center;font-size:13px;color:var(--green);font-weight:700;">🎉 프리미엄 활성화 중</div>`}
      </div>
    </div>
    <div style="margin-top:16px;padding:12px 16px;background:var(--surface2);border-radius:var(--r);border:1px solid var(--border);">
      <div style="font-size:11px;color:var(--muted);font-weight:600;">💡 결제 안내</div>
      <div style="font-size:12px;color:var(--light);margin-top:4px;line-height:1.7;">토스페이먼츠 안전결제 · 언제든 해지 가능 · 현재 <strong style="color:var(--navy)">테스트 모드</strong>로 실제 금액이 청구되지 않습니다</div>
    </div>`;
}

function renderMpAccount() {
  const acc = JSON.parse(localStorage.getItem(MP_ACCOUNT_KEY) || '{}');
  const history = JSON.parse(localStorage.getItem(MP_HISTORY_KEY) || '[]');
  const scores = history.map(h => h.score);
  const bestScore = scores.length ? Math.max(...scores) : null;
  const bestBiz = history.find(h => h.score === bestScore)?.biz || '-';

  // Supabase 로그인 상태면 실제 유저 데이터 우선 사용
  const isLoggedIn = !!currentUser;
  const displayNick = isLoggedIn ? getNickname() : (acc.nickname || '');
  const displayEmail = isLoggedIn ? (currentUser.email || '') : (acc.email || '');
  const joinDate = isLoggedIn
    ? new Date(currentUser.created_at).toLocaleDateString('ko-KR')
    : (acc.joinDate || new Date().toLocaleDateString('ko-KR'));
  if (!acc.joinDate && !isLoggedIn) { acc.joinDate = joinDate; localStorage.setItem(MP_ACCOUNT_KEY, JSON.stringify(acc)); }

  document.getElementById('mpAccountPane').innerHTML = `
    ${isLoggedIn ? `<div style="display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--green-light);border:1px solid #86efac;border-radius:var(--r-lg);margin-bottom:20px;">
      <span style="font-size:22px;">✅</span>
      <div><div style="font-size:13px;font-weight:700;color:var(--green)">로그인됨</div><div style="font-size:12px;color:var(--muted)">${displayEmail}</div></div>
    </div>` : `<div style="display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--blue-bg);border:1px solid var(--blue-light);border-radius:var(--r-lg);margin-bottom:20px;cursor:pointer;" onclick="closeMypage();openAuthModal('login')">
      <span style="font-size:22px;">🔑</span>
      <div><div style="font-size:13px;font-weight:700;color:var(--blue)">로그인하면 분석 내역이 클라우드에 저장됩니다</div><div style="font-size:12px;color:var(--muted)">탭하여 로그인 →</div></div>
    </div>`}
    <div class="mp-stat-grid">
      <div class="mp-stat-box">
        <div style="font-size:26px;font-weight:900;color:var(--blue);line-height:1">${history.length}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;">총 분석 횟수</div>
      </div>
      <div class="mp-stat-box">
        <div style="font-size:22px;font-weight:900;color:var(--green);line-height:1">${bestScore !== null ? bestScore + '점' : '-'}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;">최고 점수</div>
      </div>
      <div class="mp-stat-box">
        <div style="font-size:16px;font-weight:700;color:var(--text);line-height:1.3">${bestBiz}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;">최고 점수 업종</div>
      </div>
    </div>
    <div class="mp-input-row">
      <label>닉네임</label>
      <input class="mp-input" id="mpNickname" value="${displayNick}" placeholder="닉네임을 입력하세요" ${isLoggedIn ? '' : ''}>
    </div>
    <div class="mp-input-row">
      <label>이메일</label>
      <input class="mp-input" id="mpEmail" type="email" value="${displayEmail}" placeholder="example@email.com" ${isLoggedIn ? 'readonly style="background:var(--surface2);color:var(--muted)"' : ''}>
    </div>
    <div style="font-size:12px;color:var(--light);margin-bottom:20px;">${isLoggedIn ? '가입일' : '최초 방문일'}: ${joinDate}</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button onclick="saveMpAccount()" style="background:var(--blue);color:#fff;border:none;border-radius:var(--r);padding:11px 28px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:0 2px 8px rgba(37,99,235,.25);">저장하기</button>
      ${isLoggedIn ? `<button onclick="handleSignOut()" style="background:none;color:var(--red);border:1.5px solid var(--red);border-radius:var(--r);padding:11px 20px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">로그아웃</button>` : ''}
    </div>`;
}

async function saveMpAccount() {
  const nickname = document.getElementById('mpNickname').value.trim();
  // localStorage 저장
  const acc = JSON.parse(localStorage.getItem(MP_ACCOUNT_KEY) || '{}');
  acc.nickname = nickname;
  if (!document.getElementById('mpEmail').readOnly) {
    acc.email = document.getElementById('mpEmail').value.trim();
  }
  localStorage.setItem(MP_ACCOUNT_KEY, JSON.stringify(acc));
  // Supabase 로그인 상태면 user_metadata도 업데이트
  if (currentUser && nickname) {
    await _sb.auth.updateUser({ data: { nickname } });
    document.getElementById('navNickname').textContent = nickname;
  }
  showToast('✅ 계정 정보가 저장되었습니다');
}

/* ═══════════════════════════════════════════════
   토스페이먼츠 결제 연동
   ★ 실서비스 전환 시 TOSS_CLIENT_KEY만 교체
═══════════════════════════════════════════════ */
// ★ 가입 후 실제 키로 교체: https://merchants.tosspayments.com → 개발자센터
const TOSS_CLIENT_KEY = 'test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq';
const PLAN_AMOUNT = 29000;
const PLAN_NAME = '창업지도 프리미엄 1개월';
const MP_MEMBERSHIP_KEY = 'changup_membership';

function getMembership() {
  return JSON.parse(localStorage.getItem(MP_MEMBERSHIP_KEY) || '{"tier":"free"}');
}
function isPremium() {
  const m = getMembership();
  if (m.tier !== 'premium') return false;
  // 만료일 체크
  if (m.expiry && new Date(m.expiry) < new Date()) { setFree(); return false; }
  return true;
}
function setFree() {
  localStorage.setItem(MP_MEMBERSHIP_KEY, JSON.stringify({ tier: 'free' }));
}
function setPremium(orderId) {
  const expiry = new Date();
  expiry.setMonth(expiry.getMonth() + 1);
  localStorage.setItem(MP_MEMBERSHIP_KEY, JSON.stringify({ tier: 'premium', orderId, expiry: expiry.toISOString(), activatedAt: new Date().toISOString() }));
}

async function startPayment() {
  if (typeof TossPayments === 'undefined') {
    showToast('⚠ 결제 모듈 로딩 중입니다. 잠시 후 다시 시도해주세요.'); return;
  }
  const acc = JSON.parse(localStorage.getItem(MP_ACCOUNT_KEY) || '{}');
  const orderId = 'CHANGUP_' + Date.now();
  // 결제 시도 전 orderId 저장 (성공 후 검증용)
  sessionStorage.setItem('pending_order', orderId);
  try {
    const tossPayments = TossPayments(TOSS_CLIENT_KEY);
    await tossPayments.requestPayment('카드', {
      amount: PLAN_AMOUNT,
      orderId,
      orderName: PLAN_NAME,
      customerName: acc.nickname || '창업자',
      customerEmail: acc.email || undefined,
      successUrl: window.location.origin + window.location.pathname + '?payment=success',
      failUrl: window.location.origin + window.location.pathname + '?payment=fail',
    });
  } catch (e) {
    if (e.code === 'USER_CANCEL') { showToast('결제가 취소되었습니다.'); }
    else { showToast('⚠ 결제 오류: ' + (e.message || '알 수 없는 오류')); console.error(e); }
    sessionStorage.removeItem('pending_order');
  }
}

// 결제 성공 콜백: successUrl 파라미터 처리
async function handlePaymentResult() {
  const params = new URLSearchParams(window.location.search);
  const status = params.get('payment');
  if (!status) return;

  // URL 파라미터 즉시 제거 (뒤로가기 방지)
  const cleanUrl = window.location.pathname;
  history.replaceState({}, '', cleanUrl);

  if (status === 'success') {
    const paymentKey = params.get('paymentKey');
    const orderId = params.get('orderId');
    const amount = parseInt(params.get('amount'), 10);

    if (!paymentKey || !orderId || amount !== PLAN_AMOUNT) {
      showPaymentResultModal(false, '결제 정보가 올바르지 않습니다.');
      return;
    }
    // 백엔드 검증
    try {
      const res = await fetch('/api/payment-verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ paymentKey, orderId, amount }),
      });
      const data = await res.json();
      if (data.success) {
        setPremium(orderId);
        updateMpBadgeToPremium();
        showPaymentResultModal(true);
      } else {
        showPaymentResultModal(false, data.message || '결제 검증에 실패했습니다.');
      }
    } catch (e) {
      // 네트워크 오류 시 임시로 로컬에 저장 (테스트 환경 fallback)
      console.warn('결제 검증 API 오류, 로컬 처리:', e);
      setPremium(orderId);
      updateMpBadgeToPremium();
      showPaymentResultModal(true);
    }
  } else if (status === 'fail') {
    const msg = params.get('message') || '결제가 실패했습니다.';
    showPaymentResultModal(false, msg);
  }
}

function showPaymentResultModal(success, msg) {
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;z-index:20000;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;padding:20px;';
  overlay.innerHTML = `
    <div style="background:#fff;border-radius:16px;padding:36px 32px;max-width:380px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.3);">
      <div style="font-size:52px;margin-bottom:16px">${success ? '🎉' : '😞'}</div>
      <div style="font-size:20px;font-weight:900;color:${success ? 'var(--green)' : 'var(--red)'};margin-bottom:8px">${success ? '결제 완료!' : '결제 실패'}</div>
      <div style="font-size:14px;color:var(--muted);margin-bottom:8px">${success ? '프리미엄 플랜이 활성화되었습니다.' : (msg || '결제가 실패했습니다.')}</div>
      ${success ? `<div style="font-size:12px;color:var(--light);margin-bottom:24px;">30일간 모든 프리미엄 기능을 이용하실 수 있습니다</div>` : '<div style="margin-bottom:24px;"></div>'}
      <button onclick="this.closest('[style*=fixed]').remove();${success ? 'openMypage();showMpTab(\'membership\');' : ''}" style="background:${success ? 'var(--blue)' : 'var(--navy)'};color:#fff;border:none;border-radius:var(--r);padding:12px 32px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;">${success ? '마이페이지 확인' : '닫기'}</button>
    </div>`;
  document.body.appendChild(overlay);
}

function updateMpBadgeToPremium() {
  // 네비게이션 마이페이지 버튼 및 모달 헤더 뱃지 업데이트
  document.querySelectorAll('.mp-header span[style*="93c5fd"]').forEach(el => {
    el.textContent = 'PREMIUM';
    el.style.background = 'rgba(202,138,4,.25)';
    el.style.color = '#fbbf24';
    el.style.borderColor = 'rgba(251,191,36,.3)';
  });
}
</script>

<!-- 핫트렌드 모달 -->
<div id="trendOverlay" class="page-overlay" onclick="if(event.target===this)closeTrend()">
  <div class="page-modal">
    <div class="page-modal-header" style="background:linear-gradient(135deg,#dc2626,#ea580c);">
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:20px;">📈</span>
        <span style="font-size:16px;font-weight:800;color:#fff;">핫트렌드</span>
        <span style="font-size:10px;font-weight:700;background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);padding:2px 8px;border-radius:100px;">이번 달</span>
      </div>
      <button class="page-close" onclick="closeTrend()">✕</button>
    </div>
    <div class="page-body" id="trendBody"></div>
  </div>
</div>

<!-- 정책 가이드 모달 -->
<div id="policyOverlay" class="page-overlay" onclick="if(event.target===this)closePolicy()">
  <div class="page-modal">
    <div class="page-modal-header" style="background:linear-gradient(135deg,#1b2a4a,#1e3a5f);">
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:20px;">📋</span>
        <span style="font-size:16px;font-weight:800;color:#fff;">정책 가이드</span>
        <span style="font-size:10px;font-weight:700;background:rgba(255,255,255,.15);color:#93c5fd;border:1px solid rgba(147,197,253,.3);padding:2px 8px;border-radius:100px;">8개 정책</span>
      </div>
      <button class="page-close" onclick="closePolicy()">✕</button>
    </div>
    <div class="page-body" id="policyBody"></div>
  </div>
</div>

<!-- 로그인/회원가입 모달 -->
<div id="authOverlay" class="auth-overlay" onclick="if(event.target===this)closeAuthModal()">
  <div class="auth-modal">
    <div class="auth-header">
      <div style="font-size:28px;margin-bottom:6px;">🧭</div>
      <div style="font-size:17px;font-weight:900;color:#fff;">창업지도</div>
      <div style="font-size:12px;color:rgba(255,255,255,.5);margin-top:3px;">계정으로 분석 내역을 저장하세요</div>
    </div>
    <div class="auth-tabs">
      <div class="auth-tab active" data-tab="login" onclick="showAuthTab('login')">로그인</div>
      <div class="auth-tab" data-tab="signup" onclick="showAuthTab('signup')">회원가입</div>
    </div>
    <div class="auth-body">
      <!-- 로그인 폼 -->
      <div id="authLoginPane">
        <div class="auth-field">
          <label>이메일</label>
          <input class="auth-input" id="loginEmail" type="email" placeholder="example@email.com" autocomplete="email">
        </div>
        <div class="auth-field">
          <label>비밀번호</label>
          <input class="auth-input" id="loginPw" type="password" placeholder="비밀번호 입력" autocomplete="current-password"
            onkeydown="if(event.key==='Enter')handleSignIn()">
        </div>
        <div class="auth-error" id="loginError"></div>
        <button class="auth-btn" id="loginBtn" onclick="handleSignIn()">로그인</button>
        <div style="text-align:center;margin-top:14px;font-size:12px;color:var(--muted);">
          계정이 없으신가요? <span style="color:var(--blue);font-weight:700;cursor:pointer;" onclick="showAuthTab('signup')">회원가입</span>
        </div>
      </div>
      <!-- 회원가입 폼 -->
      <div id="authSignupPane" style="display:none;">
        <div class="auth-field">
          <label>닉네임</label>
          <input class="auth-input" id="signupNick" type="text" placeholder="창업자123" autocomplete="nickname">
        </div>
        <div class="auth-field">
          <label>이메일</label>
          <input class="auth-input" id="signupEmail" type="email" placeholder="example@email.com" autocomplete="email">
        </div>
        <div class="auth-field">
          <label>비밀번호 <span style="font-size:11px;font-weight:500;color:var(--light);">(6자 이상)</span></label>
          <input class="auth-input" id="signupPw" type="password" placeholder="6자 이상 입력" autocomplete="new-password">
        </div>
        <div class="auth-field">
          <label>비밀번호 확인</label>
          <input class="auth-input" id="signupPw2" type="password" placeholder="비밀번호 재입력" autocomplete="new-password"
            onkeydown="if(event.key==='Enter')handleSignUp()">
        </div>
        <div class="auth-error" id="signupError"></div>
        <button class="auth-btn" id="signupBtn" onclick="handleSignUp()">회원가입</button>
        <div style="text-align:center;margin-top:14px;font-size:12px;color:var(--muted);">
          이미 계정이 있으신가요? <span style="color:var(--blue);font-weight:700;cursor:pointer;" onclick="showAuthTab('login')">로그인</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 마이페이지 모달 -->
<div id="mypageOverlay" class="mp-overlay" onclick="if(event.target===this)closeMypage()">
  <div class="mp-modal">
    <div class="mp-header">
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:20px;">👤</span>
        <span style="font-size:16px;font-weight:800;color:#fff;">마이페이지</span>
        <span style="font-size:10px;font-weight:700;background:rgba(37,99,235,.25);color:#93c5fd;border:1px solid rgba(147,197,253,.3);padding:2px 10px;border-radius:100px;letter-spacing:.3px;">무료 플랜</span>
      </div>
      <button class="mp-close" onclick="closeMypage()">✕</button>
    </div>
    <div class="mp-tabs">
      <div class="mp-tab active" data-tab="history" onclick="showMpTab('history')">📊 분석 내역</div>
      <div class="mp-tab" data-tab="membership" onclick="showMpTab('membership')">💎 멤버십</div>
      <div class="mp-tab" data-tab="account" onclick="showMpTab('account')">⚙️ 계정</div>
    </div>
    <div class="mp-body">
      <div class="mp-pane" data-pane="history" id="mpHistoryPane"></div>
      <div class="mp-pane" data-pane="membership" id="mpMembershipPane" style="display:none;"></div>
      <div class="mp-pane" data-pane="account" id="mpAccountPane" style="display:none;"></div>
    </div>
  </div>
</div>

<!-- 카카오맵 모달 -->
<div id="mapModal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;">
  <div id="mapModalInner" style="background:#fff;border-radius:16px;width:min(640px,96vw);max-height:92vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,0.3);transition:all .3s;">
    <!-- 헤더 -->
    <div style="padding:16px 20px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;justify-content:space-between;background:#1b2a4a;">
      <div style="display:flex;align-items:center;gap:10px;">
        <div id="mapModalTitle" style="font-size:16px;font-weight:800;color:#fff;">🗺️ 지역 선택</div>
        <span id="mapModalBadge" style="display:none;font-size:10px;font-weight:700;background:rgba(52,211,153,0.2);color:#34d399;border:1px solid rgba(52,211,153,0.3);padding:2px 8px;border-radius:100px;">LIVE</span>
      </div>
      <button onclick="closeMapModal()" style="background:rgba(255,255,255,0.15);border:none;color:#fff;width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;">✕</button>
    </div>
    <!-- 검색창 -->
    <div style="padding:12px 16px;border-bottom:1px solid #e2e8f0;display:flex;gap:8px;background:#f8fafc;">
      <input type="text" id="mapSearchInput" placeholder="장소 검색 (예: 강남역, 홍대입구, 성수동...)" style="flex:1;border:1.5px solid #e2e8f0;border-radius:8px;padding:10px 14px;font-size:14px;font-family:inherit;outline:none;" onfocus="this.style.borderColor='#2563eb'" onblur="this.style.borderColor='#e2e8f0'">
      <button onclick="searchMapPlace()" style="background:#2563eb;color:#fff;border:none;border-radius:8px;padding:10px 18px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;white-space:nowrap;">검색</button>
    </div>
    <!-- 지도 -->
    <div id="kakaoMapDiv" style="height:420px;width:100%;"></div>
    <!-- 하단 바 -->
    <div style="padding:14px 16px;border-top:1px solid #e2e8f0;display:flex;align-items:center;justify-content:space-between;gap:10px;background:#fff;">
      <span id="selectedAddrText" style="font-size:13px;color:#64748b;flex:1;">📍 지도를 클릭하거나 장소를 검색하세요</span>
      <div id="mapModalBtns" style="display:flex;gap:8px;">
        <button id="confirmAddrBtn" onclick="confirmAddress()" disabled style="background:#dc2626;color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;opacity:0.5;transition:all .2s;">이 위치로 선택 →</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>
